var GUI
!function(t){function e(){var e=window?window._userLogged:void 0
return e&&"object"==typeof e?e:{id:1,userName:"dew",currLogin:new Date,role:"admin",groups:[t.GRP_DEV],structures:[],email:"test@dew.org",mobile:"3491234567",tokenId:"KURJPghMTJ"}}function i(){var t=window?window._config:void 0
return t&&"object"==typeof t?t:{}}function n(){var t=e()
return null!=t&&t.locale?t.locale:WUX.WUtil.getString(i(),"locale","")}function a(){var t=window?window._userLogged:void 0
return!t||"object"!=typeof t}function s(){var t=e()
return!!t&&(!!(t.userName&&t.userName.indexOf("_oper")>=0)||!!(t.reference&&t.reference.toLowerCase().indexOf("oper")>=0))}function o(){var t=e()
return!!t&&(!!(t.userName&&t.userName.indexOf("_desk")>=0)||!!(t.reference&&t.reference.toLowerCase().indexOf("desk")>=0))}function r(t){return t||(t=new Date),Math.floor(WUX.WUtil.diffDays(t,new Date(2019,11,30))/7)+1}function l(e,i,n){if(!u.CHECK_USER_DESK)return void jrpc.execute(e,i,n)
t.__m=e,t.__p=i,t.__s=n,t.__d||(t.__d=new t.DlgCheckDesk("dlgckdesk"),t.__d.onHiddenModal(function(e){if(!t.__d.ok)return void WUX.showWarning("Operazione annullata.")
var i=t.__d.getState()
if(!i)return void WUX.showWarning("Password non corretta. Operazione annullata.")
var n=jrpc.executeSync("UTENTI_DESK.check",[i])
if(!n)return void WUX.showWarning("Password non valida. Operazione annullata.")
t.__p||(t.__p=[])
var a=t.__p.length?t.__p[0]:null
if("object"==typeof a&&null!==a?a[T.sUSERDESK]=n:null===a?t.__p[0]=n:t.__p.push(n),!t.__m)return void WUX.showWarning("Riferimento operazione assente.")
jrpc.execute(t.__m,t.__p,t.__s)})),t.__d.show()}var d=WUX.WUtil
t.URL_DEV="http://localhost:8080/bookme",t.GRP_DEV="3",t.getUserLogged=e,t.getConfig=i,t.getLocale=n,t.isDevMode=a
var c=function(){function i(){}return i.putUserInfo=function(i){var n=e()
return i?Array.isArray(i)?(i.push(n.userName),i.push(d.toNumber(d.getFirst(t.getUserLogged().groups,t.GRP_DEV))),i):(i._usr=n.userName,i._grp=d.toNumber(d.getFirst(t.getUserLogged().groups,t.GRP_DEV)),i):{_usr:n.userName,_grp:d.toNumber(d.getFirst(t.getUserLogged().groups,t.GRP_DEV))}},i.addUserInfo=function(i){var n=e()
return i?(i.push(n.userName),i.push(d.toNumber(d.getFirst(t.getUserLogged().groups,t.GRP_DEV))),i):[n.userName,d.toNumber(d.getFirst(t.getUserLogged().groups,t.GRP_DEV))]},i.getUserInfo=function(){return{_usr:e().userName,_grp:d.toNumber(d.getFirst(t.getUserLogged().groups,t.GRP_DEV))}},i.scontato=function(t,e,i,n,a,s){if(void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=0),void 0===s&&(s=0),!t||t<0)return 0
var o=t
return e&&(o=WUX.WUtil.round2(o*((100-e)/100))),i&&(o=WUX.WUtil.round2(o*((100-i)/100))),n&&(o=WUX.WUtil.round2(o*((100-n)/100))),a&&(o=WUX.WUtil.round2(o*((100-a)/100))),s&&(o=WUX.WUtil.round2(o*((100-s)/100))),o<0?0:o},i}()
t.CFUtil=c
var u=function(){function t(){}return t.CHECK_USER_DESK=!1,t}()
t.CFBookCfg=u
var h=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sCODICE="codice",t.sDESCRIZIONE="descrizione",t.sUBICAZIONE="ubicazione",t.sPRESTAZIONI="prestazioni",t}()
t.IAttrezzatura=h
var p=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sOGGETTO="oggetto",t.sMESSAGGIO="messaggio",t.sMEZZO="mezzo",t.sCODA="coda",t}()
t.IComunicazione=p
var b=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sDATA="data",t.sMESE_GIORNO="meseGiorno",t.sDESCRIZIONE="descrizione",t.sANNUALE="annuale",t}()
t.IChiusura=b
var I=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sNOME="nome",t.sCOLORE="colore",t.sORDINE="ordine",t.sPREN_ONLINE="prenOnLine",t.sVISIBILE="visibile",t.sPRESTAZIONI="prestazioni",t.sAGENDA="agenda",t.sVARIAZIONI="variazioni",t}()
t.ICollaboratore=I
var f=function(){function t(){}return t.sID="id",t.sCOGNOME="cognome",t.sNOME="nome",t.sSESSO="sesso",t.sDATA_NASCITA="dataNascita",t.sCODICE_FISCALE="codiceFiscale",t.sTELEFONO1="telefono1",t.sTELEFONO2="telefono2",t.sEMAIL="email",t.sNOTE="note",t.sPRENOTAZIONI="prenotazioni",t.sNOMINATIVO="nominativo",t.sREPUTAZIONE="reputazione",t.sETA_DA="etaDa",t.sETA_A="etaA",t.sOPZIONI="opzioni",t.sDIS_PREN_ONLINE="disPrenOnLine",t}()
t.ICliente=f
var S=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sCODICE="codice",t.sDESCRIZIONE="descrizione",t}()
t.IGruppoPrest=S
var g=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sCODCSF="codCsf",t.sCODICE="codice",t.sDESCRIZIONE="descrizione",t.sDURATA="durata",t.sTIPO_PREZZO="tipoPrezzo",t.sPREN_ONLINE="prenOnLine",t.sFLAG_POSA="flagPosa",t.sPREZZO_LISTINO="prezzoListino",t.sSCONTO_ASS="scontoAss",t.sSCONTO_PERC="scontoPerc",t.sPREZZO_FINALE="prezzoFinale",t.sAVVERTENZE="avvertenze",t.sINDICAZIONI="indicazioni",t.sGRUPPO="gruppo",t.sDESC_GRUPPO="descGruppo",t.sTIPO="tipo",t.sDESC_TIPO="descTipo",t.sATTREZZATURE="attrezzature",t.sCOLLABORATORI="collaboratori",t.sPUNTI_COLL="puntiColl",t}()
t.IPrestazione=g
var A=function(){function t(){}return t.sDATA="data",t.sID_FAR="id_far",t.sID_COLLABORATORE="id_collaboratore",t.sRIGENERA="rigenera",t.sAGGIORNA="aggiorna",t.sNO_APPUNTAMENTI="no_appts",t.sRISORSE="resources",t.sSLOTS="slots",t.sAPPUNTAMENTI="appts",t.sORARI="times",t.sCHECK_USER_DESK="ckUserDesk",t}()
t.ICalendario=A
var T=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sCOD_FAR="codFar",t.sID_COLL="idColl",t.sDESC_COLL="descColl",t.sCOLORE="colore",t.sID_CLIENTE="idCliente",t.sDESC_CLIENTE="descCliente",t.sTELEFONO1="tel1",t.sTELEFONO2="tel2",t.sEMAIL="email",t.sID_PREST="idPrest",t.sDESC_PREST="descPrest",t.sID_ATTR="idAttr",t.sDESC_ATTR="descAttr",t.sDATA_PREN="dataPren",t.sDATA_UPD="dataUpd",t.sDATA_APP="dataApp",t.sORA_APP="oraApp",t.sORA_FINE="oraFine",t.sDURATA="durata",t.sSTATO="stato",t.sTIPO="tipo",t.sPREZZO_FINALE="prezzoFinale",t.sALLA_DATA="allaData",t.sPREN_ONLINE="prenOnLine",t.sPAGATO="pagato",t.sNOTE="note",t.sNOTE_CLIENTE="noteCliente",t.sOVERBOOKING="overbooking",t.sTIPO_PAG="tipoPag",t.sPRESTAZIONI="prestazioni",t.sDURATE="durate",t.sMESSAGGIO="messaggio",t.sPREFERENZE="preferenze",t.sIMP_PAGATO="impPagato",t.sCOD_COUPON="codCoupon",t.sCAUSALE="causale",t.sUSERDESK="userDesk",t.sCHECK_USER_DESK="ckUserDesk",t.sCAMBIO_ID_COLL="cambioIdColl",t.sCAMBIO_DATA="cambioData",t.sCAMBIO_ORA="cambioOra",t.sCAMBIO_DAL="cambioDal",t.sCAMBIO_AL="cambioAl",t.sMATTINO="mattino",t.sPOMERIGGIO="pomeriggio",t.sIGNORE_CHECK="ignoreCheck",t}()
t.IPrenotazione=T
var C=function(){function t(){}return t.sID="id",t.sID_FAR="idFar",t.sUSERNAME="username",t.sPASSWORD="password",t.sNOTE="note",t.sABILITATO="abilitato",t}()
t.IUtenteDesk=C,t.isBookOper=s,t.isBookDesk=o,t.getWeek2020=r,t.chkExecute=l}(GUI||(GUI={})),WUX.global.locale=GUI.getLocale()
var jrpc=new JRPC("/bookme/rpc")
jrpc.setUserName(GUI.getUserLogged().userName),jrpc.setPassword(""+WUX.WUtil.getFirst(GUI.getUserLogged().groups,GUI.GRP_DEV))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){var e=i.call(this,t||"*","GUICabine")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.fpFilter.checkMandatory(!0,!0,!1)
if(a)return void WUX.showWarning("Specificare i seguenti campi: "+a)
var s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("ATTREZZATURE.find",[t.CFUtil.putUserInfo(i.fpFilter.getState())],function(n){if(i.tabResult.setState(n),i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.IAttrezzatura.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},100),i.selId=null}})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),i.status=i.iSTATUS_STARTUP}),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(n){i.tabResult.setState([]),i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),t.cp_prest=null
var a=e.toNumber(i.selFar.getState(),0)
jrpc.execute("PRESTAZIONI.getAll",[a],function(t){i.tabAll.setState(t)})}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IAttrezzatura.sID_FAR,"Struttura",this.selFar),this.fpFilter.addTextField(t.IAttrezzatura.sDESCRIZIONE,"Descrizione"),this.fpFilter.setMandatory(t.IAttrezzatura.sID_FAR),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.IAttrezzatura.sCODICE,"Codice"),this.fpDetail.addTextField(t.IAttrezzatura.sDESCRIZIONE,"Descrizione"),this.fpDetail.addTextField(t.IAttrezzatura.sUBICAZIONE,"Ubicazione"),this.fpDetail.addInternalField(t.IAttrezzatura.sID),this.fpDetail.enabled=!1,this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.btnDx.enabled=!0,i.btnSx.enabled=!0,i.btnPa.enabled=!0,i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,i.btnDx.enabled=!0,i.btnSx.enabled=!0,i.btnPa.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState()
o[t.IAttrezzatura.sID_FAR]=s,o[t.IAttrezzatura.sPRESTAZIONI]=i.tabSel.getState(),i.isNew?jrpc.execute("ATTREZZATURE.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=e[t.IAttrezzatura.sID],i.btnFind.trigger("click")}):jrpc.execute("ATTREZZATURE.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=e[t.IAttrezzatura.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?(i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter()):i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IAttrezzatura.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("ATTREZZATURE.delete",[s],function(t){i.btnFind.trigger("click")})})}}),this.btnOpen2=new WUX.WButton(this.subId("bo2"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen2.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen2.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen2.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,i.btnDx.enabled=!0,i.btnSx.enabled=!0,i.btnPa.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave2=new WUX.WButton(this.subId("bs2"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave2.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave2.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave2.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState()
o[t.IAttrezzatura.sID_FAR]=s,o[t.IAttrezzatura.sPRESTAZIONI]=i.tabSel.getState(),i.isNew?jrpc.execute("ATTREZZATURE.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=e[t.IAttrezzatura.sID],i.btnFind.trigger("click")}):jrpc.execute("ATTREZZATURE.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=e[t.IAttrezzatura.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel2=new WUX.WButton(this.subId("bc2"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel2.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel2.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?(i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter()):i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=null)})}),this.btnDelete2=new WUX.WButton(this.subId("bd2"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete2.on("click",function(n){if(i.selId=null,i.btnDelete2.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IAttrezzatura.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("ATTREZZATURE.delete",[s],function(t){i.btnFind.trigger("click")})})}})
var n=[["Codice",t.IAttrezzatura.sCODICE],["Descrizione",t.IAttrezzatura.sDESCRIZIONE]]
this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(n,0),e.col(n,1)),this.tabResult.css({h:220}),this.tabResult.widths=[100],this.tabResult.onSelectionChanged(function(t){i.onSelect()}),this.tabSel=new WUX.WDXTable(this.subId("tbs"),["Gruppo","Descrizione"],[t.IPrestazione.sDESC_GRUPPO,t.IPrestazione.sDESCRIZIONE]),this.tabSel.selectionMode="multiple",this.tabSel.css({h:250}),this.tabSel.widths=[100],this.tabSel.filter=!0,this.tabSel.onCellPrepared(function(e){e.column.dataField==t.IPrestazione.sDESC_GRUPPO&&e.cellElement.addClass("clickable")}),this.tabSel.onCellClick(function(e){var n=e.row
if(null!=n&&"data"==n.rowType){if(e.column.dataField==t.IPrestazione.sDESC_GRUPPO){for(var a=[],s=i.tabSel.getState(),o=0;o<s.length;o++){s[o][t.IPrestazione.sDESC_GRUPPO]==e.value&&a.push(o)}if(!a||!a.length)return
i.tabSel.setState(s),setTimeout(function(){i.tabSel.select(a)},200)}}}),this.tabAll=new WUX.WDXTable(this.subId("tba"),["Gruppo","Descrizione"],[t.IPrestazione.sDESC_GRUPPO,t.IPrestazione.sDESCRIZIONE]),this.tabAll.selectionMode="multiple",this.tabAll.css({h:250}),this.tabAll.widths=[100],this.tabAll.filter=!0,this.tabAll.onCellPrepared(function(e){e.column.dataField==t.IPrestazione.sDESC_GRUPPO&&e.cellElement.addClass("clickable")}),this.tabAll.onCellClick(function(e){var n=e.row
if(null!=n&&"data"==n.rowType){if(e.column.dataField==t.IPrestazione.sDESC_GRUPPO){for(var a=[],s=i.tabAll.getState(),o=0;o<s.length;o++){s[o][t.IPrestazione.sDESC_GRUPPO]==e.value&&a.push(o)}if(!a||!a.length)return
i.tabAll.setState(s),setTimeout(function(){i.tabAll.select(a)},200)}}}),this.btnSx=new WUX.WButton(this.subId("bba"),"",t.ICO.LEFT,WUX.BTN.PRIMARY,{p:"1px 6px 1px 6px"}),this.btnSx.tooltip="Aggiungi trattamenti",this.btnSx.enabled=!1,this.btnSx.on("click",function(e){var n=i.tabSel.getState()
n||(n=[])
var a=i.tabAll.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare uno o pi&ugrave; trattamenti dal catalogo.")
for(var s=!1,o=0;o<a.length;o++){for(var r=a[o],l=r[t.IPrestazione.sID],d=!1,c=0;c<n.length;c++){if(n[c][t.IPrestazione.sID]==l){d=!0
break}}d||(n.push(r),s=!0)}i.tabSel.setState(n),s&&setTimeout(function(){i.tabSel.scrollTo(999999)},250)}),this.btnDx=new WUX.WButton(this.subId("bbd"),"",t.ICO.DELETE,WUX.BTN.DANGER,{p:"1px 7px 1px 7px"}),this.btnDx.tooltip="Rimuovi trattamenti",this.btnDx.enabled=!1,this.btnDx.on("click",function(e){var n=i.tabSel.getState()
n||(n=[])
var a=i.tabSel.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare uno o pi&ugrave; trattamenti dall'elenco degli assegnati.")
for(var s=[],o=0;o<n.length;o++){for(var r=n[o],l=r[t.IPrestazione.sID],d=!1,c=0;c<a.length;c++){if(a[c][t.IPrestazione.sID]==l){d=!0
break}}d||s.push(r)}i.tabSel.setState(s)}),this.btnCp=new WUX.WButton(this.subId("bbc"),"",t.ICO.COPY,WUX.BTN.SECONDARY,{p:"1px 7px 1px 7px"}),this.btnCp.tooltip="Copia trattamenti",this.btnCp.on("click",function(e){var n=i.tabSel.getState()
if(!n||!n.length)return void WUX.showSuccess("Nessun elemento selezionato")
t.cp_prest=n,WUX.showSuccess("Trattamenti copiati nella clipboard")}),this.btnPa=new WUX.WButton(this.subId("bbp"),"",t.ICO.PASTE,WUX.BTN.WARNING,{p:"1px 7px 1px 7px"}),this.btnPa.tooltip="Incolla trattamenti",this.btnPa.enabled=!1,this.btnPa.on("click",function(e){if(!t.cp_prest)return void WUX.showWarning("Non vi sono trattamenti nella clipboard")
i.tabSel.setState(t.cp_prest)})
var a=new WUX.WContainer(this.subId("ct0"),"")
return a.addRow().addCol("11",{p:0}).add(this.tabSel).addCol("1",{p:0}).addStack(WUX.CSS.STACK_BTNS,this.btnSx,this.btnDx,this.btnCp,this.btnPa),this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew),this.cntActions2=new t.CFTableActions("ta2"),this.cntActions2.left.add(this.btnOpen2),this.cntActions2.left.add(this.btnDelete2),this.cntActions2.left.add(this.btnSave2),this.cntActions2.left.add(this.btnCancel2),this.tagsFilter=new WUX.WTags("tf"),this.tcoDetail=new WUX.WTab("tcod"),this.tcoDetail.addTab("Attributi",WUX.WIcon.ADDRESS_CARD).addRow().addCol("12",{h:300}).add(this.fpDetail),this.tcoDetail.addTab("Trattamenti",WUX.WIcon.COG).addRow().addCol("6").section("Assegnati",{h:300}).add(a).addCol("6").section("Catalogo",{h:300}).add(this.tabAll),this.tcoDetail.on("statechange",function(t){switch(i.tcoDetail.getState()){case 0:break
case 1:i.tabSel.repaint(),i.tabAll.repaint()}}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult,this.cntActions2).end().addRow().addCol("12").section("Dettaglio").add(this.tcoDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.onSelect=function(){var i=this,n=e.getItem(this.tabResult.getSelectedRowsData(),0)
if(n){var a=e.getNumber(n,t.IAttrezzatura.sID)
a&&(this.fpDetail.clear(),this.tabSel.setState([]),this.tabAll.clearSelection(),this.tabAll.clearFilter(),this.status==this.iSTATUS_EDITING&&(WUX.showWarning("Modifiche annullate"),this.fpDetail.enabled=!1,this.btnDx.enabled=!1,this.btnSx.enabled=!1,this.btnPa.enabled=!1),jrpc.execute("ATTREZZATURE.read",[a],function(n){i.fpDetail.setState(n),i.tabSel.setState(e.getArray(n,t.IAttrezzatura.sPRESTAZIONI)),i.status=i.iSTATUS_VIEW}))}},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUICabine=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(n){var a=i.call(this,n||"*","GUICalendario")||this
return a.dlgOrariPers=new t.DlgOrariPers(a.subId("dlgop")),a.dlgOrariPers.onHiddenModal(function(i){if(a.planning.resumeSync(),a.dlgOrariPers.ok){var n=e.getObject(a.dlgOrariPers.getState(),t.ICalendario.sORARI),s=a.navCal.getState()
s||(s=new Date)
var o=a.navCal.getProps()
t.chkExecute("CALENDARIO.saveVariazioni",[o,s,n],function(t){a.planning.autoScroll=!0,a.planning.setState(t),a.txtSrc.focus()})}}),a.winBack=new WUX.WWindow(a.subId("wb")),a.winBack.width=160,a.winBack.gap=16,a.winBack.background="rgba(0,0,0,.8)",a.winBack.color="#ffffff",a.winBack.body.add('<div style="padding:14px 14px 14px 14px;font-weight:bold;cursor:pointer;">'+WUX.buildIcon(WUX.WIcon.ARROW_LEFT)+" Torna ad oggi</div>"),a.winBack.on("click",function(t){a.navCal.setState(new Date),a.winBack.hide()}),a}return __extends(n,i),n.prototype.render=function(){var i=this
return this.navCal=new t.CFNavCalendar(this.subId("cal")),this.navCal.onClickPrev(function(e){var n=i.navCal.getState(),a=i.navCal.getProps()
i.navCal.isToday()?i.winBack.hide():i.winBack.show()
var s={}
s[t.ICalendario.sDATA]=n,s[t.ICalendario.sID_FAR]=a,jrpc.execute("CALENDARIO.getPlanning",[s],function(t){i.planning.autoScroll=!0,i.planning.setState(t),i.txtSrc.focus()})}),this.navCal.onClickNext(function(e){var n=i.navCal.getState(),a=i.navCal.getProps()
i.navCal.isToday()?i.winBack.hide():i.winBack.show()
var s={}
s[t.ICalendario.sDATA]=n,s[t.ICalendario.sID_FAR]=a,jrpc.execute("CALENDARIO.getPlanning",[s],function(t){i.planning.autoScroll=!0,i.planning.setState(t),i.txtSrc.focus()})}),this.navCal.on("statechange",function(e){var n=i.navCal.getState(),a=i.navCal.getProps()
i.navCal.isToday()?i.winBack.hide():i.winBack.show()
var s={}
s[t.ICalendario.sDATA]=n,s[t.ICalendario.sID_FAR]=a,jrpc.execute("CALENDARIO.getPlanning",[s],function(t){i.planning.autoScroll=!0,i.planning.setState(t),i.txtSrc.focus()})}),this.navCal.on("propschange",function(e){var n=i.navCal.getState(),a=i.navCal.getProps()
i.navCal.isToday()?i.winBack.hide():i.winBack.show()
var s={}
s[t.ICalendario.sDATA]=n,s[t.ICalendario.sID_FAR]=a,jrpc.execute("CALENDARIO.getPlanning",[s],function(t){i.planning.autoScroll=!0,i.planning.setState(t),i.txtSrc.focus()})}),this.txtSrc=new WUX.WInput("ts",WUX.WInputType.Text),this.txtSrc.css({f:10,w:50}),this.txtSrc.tooltip="Ricerca veloce",this.txtSrc.placeHolder="Cerca",this.txtSrc.onEnterPressed(function(e){var n=i.txtSrc.getState()
if(n=n?n.trim():"",i.txtSrc.setState(""),""==n||"?"==n||"#"==n||"#?"==n||"@"==n||"@?"==n){var a=i.navCal.getState(),s=i.navCal.getProps()
i.navCal.isToday()?i.winBack.hide():i.winBack.show()
var o={}
switch(o[t.ICalendario.sDATA]=a,o[t.ICalendario.sID_FAR]=s,n){case"?":o[t.ICalendario.sNO_APPUNTAMENTI]=!0
break
case"#":o[t.ICalendario.sRIGENERA]=!0
break
case"#?":o[t.ICalendario.sRIGENERA]=!0,o[t.ICalendario.sNO_APPUNTAMENTI]=!0
break
case"@":o[t.ICalendario.sAGGIORNA]=!0
break
case"@?":o[t.ICalendario.sAGGIORNA]=!0,o[t.ICalendario.sNO_APPUNTAMENTI]=!0}return void jrpc.execute("CALENDARIO.getPlanning",[o],function(t){i.planning.autoScroll=!0,i.planning.setState(t),i.txtSrc.focus()})}var r=i.planning.mark(n)
if(r&&r.length){for(var l="",d=0;d<r.length;d++)l+="<strong>"+r[d].descCliente+"</strong> alle ore <strong>"+r[d].oraApp+"</strong><br>"
WUX.showSuccess("Prenotazioni trovate:<br>"+l)}else WUX.showWarning("Nessuna prenotazione trovata.")}),this.lnkPrn=new WUX.WLink(this.subId("lpr"),"Prenotazioni",WUX.WIcon.FILE_TEXT_O),this.lnkPrn.on("click",function(n){t.isDevMode()?WUX.openURL("index.html?c=GUIPrenotazioni&d="+e.toNumber(i.navCal.getState())+"&f="+i.navCal.getProps(),!0,!0):WUX.openURL("prenotazioni?d="+e.toNumber(i.navCal.getState())+"&f="+i.navCal.getProps(),!0,!0)}),this.lnkTms=new WUX.WLink(this.subId("lts"),"Orari",WUX.WIcon.CLOCK_O),this.lnkTms.on("click",function(e){var n=i.navCal.getState()
i.navCal.isToday()||i.winBack.show()
var a=i.navCal.getProps()
i.planning.stopSync()
var s={}
s[t.ICalendario.sDATA]=n,s[t.ICalendario.sID_FAR]=a,jrpc.execute("CALENDARIO.getTimeTable",[s],function(t){i.dlgOrariPers.setProps(n),i.dlgOrariPers.setState(t),i.dlgOrariPers.show()})}),this.lnkNew=new WUX.WLink(this.subId("ltn"),"Nuovo",WUX.WIcon.CALENDAR),this.lnkNew.on("click",function(t){i.planning.newApp()}),this.planning=new t.CFPlanning(this.subId("pln")),this.planning.navCal=this.navCal,this.container=new WUX.WContainer,this.container.addRow().addCol("2",{bg:"white",a:"center",pt:10,pb:7}).add(this.txtSrc).addSpan(16).add(this.lnkPrn).addCol("8").add(this.navCal).addCol("2",{bg:"white",a:"center",pt:10,pb:10}).add(t.isBookDesk()?"":this.lnkTms).addSpan(16).add(this.lnkNew).addRow().add(this.planning),this.container},n.prototype.componentDidMount=function(){var e=this,i=this.navCal.getState()
i||(i=new Date)
var n=this.navCal.getProps(),a={}
a[t.ICalendario.sDATA]=i,a[t.ICalendario.sID_FAR]=n,jrpc.execute("CALENDARIO.getPlanning",[a],function(t){e.planning.autoScroll=!0,e.planning.setState(t),e.txtSrc.focus(),e.planning.startSync()})},n}(WUX.WComponent)
t.GUICalendario=i
var n=function(i){function n(t){var e=i.call(this,t||"*","GUIChiusure")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.fpFilter.checkMandatory(!0,!0,!1)
if(a)return void WUX.showWarning("Specificare i seguenti campi: "+a)
var s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("CHIUSURE.find",[t.CFUtil.putUserInfo(i.fpFilter.getState())],function(n){if(i.tabResult.setState(n),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.IChiusura.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},100),i.selId=null}})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP}),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.tabResult.setState([]),i.fpDetail.clear()}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IChiusura.sID_FAR,"Struttura",this.selFar),this.fpFilter.addTextField(t.IChiusura.sDESCRIZIONE,"Descrizione"),this.fpFilter.setMandatory(t.IChiusura.sID_FAR),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addDateField(t.IChiusura.sDATA,"Data"),this.fpDetail.addTextField(t.IChiusura.sDESCRIZIONE,"Descrizione"),this.fpDetail.addBooleanField(t.IChiusura.sANNUALE,"Annuale"),this.fpDetail.addInternalField(t.IChiusura.sID),this.fpDetail.enabled=!1,this.fpDetail.setSpanField(t.IChiusura.sDESCRIZIONE,2),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState()
o[t.IChiusura.sID_FAR]=s,i.isNew?jrpc.execute("CHIUSURE.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IChiusura.sID],i.btnFind.trigger("click")}):jrpc.execute("CHIUSURE.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IChiusura.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?i.fpDetail.clear():i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IChiusura.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("CHIUSURE.delete",[s],function(t){i.btnFind.trigger("click")})})}}),this.btnOpen2=new WUX.WButton(this.subId("bo2"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen2.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen2.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen2.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave2=new WUX.WButton(this.subId("bs2"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave2.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave2.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave2.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState()
o[t.IChiusura.sID_FAR]=s,i.isNew?jrpc.execute("CHIUSURE.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IChiusura.sID],i.btnFind.trigger("click")}):jrpc.execute("CHIUSURE.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IChiusura.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel2=new WUX.WButton(this.subId("bc2"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel2.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel2.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?i.fpDetail.clear():i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.btnDelete2=new WUX.WButton(this.subId("bd2"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete2.on("click",function(n){if(i.selId=null,i.btnDelete2.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IChiusura.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("CHIUSURE.delete",[s],function(t){i.btnFind.trigger("click")})})}})
var n=[["Data chiusura",t.IChiusura.sDATA,"d"],["Descrizione",t.IChiusura.sDESCRIZIONE,"s"],["Annuale",t.IChiusura.sANNUALE,"b"]]
return this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(n,0),e.col(n,1)),this.tabResult.types=e.col(n,2),this.tabResult.css({h:220}),this.tabResult.widths=[150],this.tabResult.onSelectionChanged(function(t){i.onSelect()}),this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew),this.cntActions2=new t.CFTableActions("ta2"),this.cntActions2.left.add(this.btnOpen2),this.cntActions2.left.add(this.btnDelete2),this.cntActions2.left.add(this.btnSave2),this.cntActions2.left.add(this.btnCancel2),this.tagsFilter=new WUX.WTags("tf"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult,this.cntActions2).end().addRow().addCol("12").section("Dettaglio").add(this.fpDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.onSelect=function(){var i=this,n=e.getItem(this.tabResult.getSelectedRowsData(),0)
if(n){var a=e.getNumber(n,t.IChiusura.sID)
a&&(this.fpDetail.clear(),this.status==this.iSTATUS_EDITING&&(WUX.showWarning("Modifiche annullate"),this.fpDetail.enabled=!1),jrpc.execute("CHIUSURE.read",[a],function(t){i.fpDetail.setState(t),i.status=i.iSTATUS_VIEW}))}},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUIChiusure=n}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(n){var a=i.call(this,n||"*","GUIClienti")||this
return a.iSTATUS_STARTUP=0,a.iSTATUS_VIEW=1,a.iSTATUS_EDITING=2,a.status=a.iSTATUS_STARTUP,a.dataRif=e.toNumber(new Date),a.dlgMrgC=new t.DlgClienti(a.subId("dlgm")),a.dlgMrgC.onHiddenModal(function(i){if(a.dlgMrgC.ok){var n=a.dlgMrgC.getState()
if(!n||!n[t.ICliente.sID])return void WUX.showWarning("Cliente non selezionato dalla finestra di dialogo.")
if(!a.itemMrg||!a.itemMrg[t.ICliente.sID])return void WUX.showWarning("Cliente non selezionato.")
if(a.itemMrg[t.ICliente.sID]==n[t.ICliente.sID])return void WUX.showWarning("Il cliente selezionato &egrave; lo stesso di quello che si vuole accorpare.")
var s=e.getNumber(a.itemMrg,t.ICliente.sID),o=e.getString(a.itemMrg,t.ICliente.sCOGNOME),r=e.getString(a.itemMrg,t.ICliente.sNOME),l=e.getString(a.itemMrg,t.ICliente.sTELEFONO1),d=o
r&&(d+=" "+r),l&&(d+=" ("+l+")")
var c=e.getNumber(n,t.ICliente.sID),u=e.getString(n,t.ICliente.sCOGNOME),h=e.getString(n,t.ICliente.sNOME),p=e.getString(n,t.ICliente.sTELEFONO1),b=u
h&&(b+=" "+h),p&&(b+=" ("+p+")")
var I="Il cliente "+d+" sara' rimosso e le sue prenotazioni passeranno a "+b+". "
I+="L'operazione sara' irreversibile. Si vuole procedere con l'accorpamento?",WUX.confirm(I,function(t){t&&jrpc.execute("CLIENTI.merge",[s,c],function(t){t?(WUX.showSuccess("Cliente accorpato con successo."),a.btnFind.trigger("click")):WUX.showSuccess("Operazione NON eseguita.")})})}}),a.dlgPren=new t.DlgPrenotazione(a.subId("dlgp")),a.dlgText=new t.DlgSMSText(a.subId("dlgs")),a.dlgText.onHiddenModal(function(i){if(a.dlgText.ok){var n=a.dlgText.getState(),s=a.tabResult.getSelectedRowsData()
if(!s||!s.length)return void WUX.showWarning("Cliente non selezionato.")
var o=e.getInt(s[0],t.ICliente.sID)
jrpc.execute("CLIENTI.sendSMS",[o,n],function(t){t?WUX.showSuccess("Messaggio inviato con successo."):WUX.showSuccess("Messaggio NON inviato.")})}}),a.dlgComm=new t.DlgComunicazione(a.subId("dlgc")),a.dlgComm.onHiddenModal(function(i){if(a.dlgComm.ok){var n=a.dlgComm.getProps()
if(!n||!n.id)return void WUX.showWarning("Comunicazione non selezionata.")
var s=a.tabResult.getState()
if(!s||!s.length)return void WUX.showWarning("Effettuare una ricerca per l'invio di una comunicazione")
for(var o=[],r=0;r<s.length;r++)o[r]=e.getNumber(s[r],t.ICliente.sID)
jrpc.execute("COMUNICAZIONI.add",[n.id,o],function(t){t?WUX.showSuccess(t+" clienti inseriti nella lista di comunicazione."):WUX.showSuccess("Nessun cliente inserito nella lista di comunicazione.")})}}),a}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status!=i.iSTATUS_EDITING){var a=WUX.getComponent("boxFilter")
a instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),a.collapse()),jrpc.execute("CLIENTI.find",[i.fpFilter.getState()],function(n){if(i.itemMrg=null,i.tabResult.setState(n),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.ICliente.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},100),i.selId=null}})}}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.status!=i.iSTATUS_EDITING&&(i.itemMrg=null,i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP)}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addTextField(t.ICliente.sCOGNOME,"Cognome"),this.fpFilter.addTextField(t.ICliente.sNOME,"Nome"),this.fpFilter.addOptionsField(t.ICliente.sSESSO,"Sesso",[{id:"",text:""},{id:"M",text:"Maschio"},{id:"F",text:"Femmina"}]),this.fpFilter.addComponent(t.ICliente.sOPZIONI,"Opzioni",new t.CFSelOpzClienti),this.fpFilter.addRow(),this.fpFilter.addTextField(t.ICliente.sTELEFONO1,"Telefono"),this.fpFilter.addTextField(t.ICliente.sEMAIL,"Email"),this.fpFilter.addIntegerField(t.ICliente.sETA_DA,"Et&agrave; da"),this.fpFilter.addIntegerField(t.ICliente.sETA_A,"Et&agrave; a"),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.ICliente.sCOGNOME,"Cognome"),this.fpDetail.addTextField(t.ICliente.sNOME,"Nome"),this.fpDetail.addTextField(t.ICliente.sTELEFONO1,"Telefono"),this.fpDetail.addTextField(t.ICliente.sEMAIL,"Email"),this.fpDetail.addRow(),this.fpDetail.addDateField(t.ICliente.sDATA_NASCITA,"Data di nascita"),this.fpDetail.addOptionsField(t.ICliente.sSESSO,"Sesso",[{id:"",text:""},{id:"M",text:"Maschio"},{id:"F",text:"Femmina"}]),this.fpDetail.addBooleanField(t.ICliente.sDIS_PREN_ONLINE,"Disab. Pren. OnLine"),this.fpDetail.addBlankField(),this.fpDetail.addRow(),this.fpDetail.addTextField(t.ICliente.sNOTE,"Note"),this.fpDetail.addInternalField(t.ICliente.sID),this.fpDetail.enabled=!1
var n=[["Data App.",t.IPrenotazione.sDATA_APP,"d"],["Ora App.",t.IPrenotazione.sORA_APP,"s"],["Durata",t.IPrenotazione.sDURATA,"i"],["Stato",t.IPrenotazione.sSTATO,"s"],["Collaboratore",t.IPrenotazione.sDESC_COLL,"s"],["Trattamento",t.IPrenotazione.sDESC_PREST,"s"],["Cabina",t.IPrenotazione.sDESC_ATTR,"s"],["Data Pren.",t.IPrenotazione.sDATA_PREN,"d"],["Data Agg.",t.IPrenotazione.sDATA_UPD,"t"],["Struttura",t.IPrenotazione.sCOD_FAR,"s"],["Note",t.IPrenotazione.sNOTE,"s"],["Coupon",t.IPrenotazione.sCOD_COUPON,"s"],["Forzatura",t.IPrenotazione.sOVERBOOKING,"b"],["On Line",t.IPrenotazione.sPREN_ONLINE,"b"]]
this.tabStorico=new WUX.WDXTable(this.subId("tps"),e.col(n,0),e.col(n,1)),this.tabStorico.types=e.col(n,2),this.tabStorico.css({h:200,f:10}),this.tabStorico.onRowPrepared(function(n){if(n.data){var a=e.getString(n.data,t.IPrenotazione.sSTATO,"C"),s=e.getInt(n.data,t.IPrenotazione.sDATA_APP)
switch(a){case"F":WUX.setCss(n.rowElement,WUX.CSS.WARNING)
break
case"E":WUX.setCss(n.rowElement,WUX.CSS.SUCCESS)
break
case"N":WUX.setCss(n.rowElement,WUX.CSS.ERROR)
break
case"A":WUX.setCss(n.rowElement,WUX.CSS.COMPLETED)}s==i.dataRif&&n.rowElement.css("font-weight","bold")}}),this.tabStorico.onDoubleClick(function(n){var a=i.tabStorico.getSelectedRowsData()
if(a&&a.length){var s=e.getString(a[0],t.IPrenotazione.sID)
jrpc.execute("PRENOTAZIONI.read",[s],function(n){if(!n)return void WUX.showWarning("Prenotazione "+s+" non disponibile.")
var a=e.getDate(n,t.IPrenotazione.sDATA_APP)
a&&(n[t.IPrenotazione.sDATA_APP]=WUX.formatDate(a,!0))
var o=e.getDate(n,t.IPrenotazione.sDATA_PREN)
o&&(n[t.IPrenotazione.sDATA_PREN]=WUX.formatDateTime(o,!1,!0)),i.dlgPren.setState(n),i.dlgPren.show()})}}),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return void i.btnSave.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+a)
var s=i.fpDetail.getState()
i.isNew?jrpc.execute("CLIENTI.insert",[t.CFUtil.putUserInfo(s)],function(n){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=n[t.ICliente.sID],i.fpFilter.isBlank(t.ICliente.sCOGNOME)&&i.fpFilter.setValue(t.ICliente.sCOGNOME,e.getString(n,t.ICliente.sCOGNOME)),i.btnFind.trigger("click")}):jrpc.execute("CLIENTI.update",[t.CFUtil.putUserInfo(s)],function(n){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=n[t.ICliente.sID]
var a=i.tabResult.getSelectedRows()
if(a&&a.length){var s=a[0]
i.tabResult.getState()[s]=n,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([s])},100)}else i.fpFilter.isBlank(t.ICliente.sCOGNOME)&&i.fpFilter.setValue(t.ICliente.sCOGNOME,e.getString(n,t.ICliente.sCOGNOME)),i.btnFind.trigger("click")})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?i.fpDetail.clear():i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.ICliente.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("CLIENTI.delete",[s],function(t){i.btnFind.trigger("click")})})}}),this.btnMerge=new WUX.WButton(this.subId("bm"),"Accorpa",t.ICO.COPY,WUX.BTN.ACT_OUTLINE_DANGER),this.btnMerge.on("click",function(n){if(i.selId=null,i.itemMrg=null,i.btnMerge.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){i.itemMrg=a[0]
var s=e.getNumber(i.itemMrg,t.ICliente.sID),o=e.getString(i.itemMrg,t.ICliente.sCOGNOME),r=e.getString(i.itemMrg,t.ICliente.sNOME),l=e.getString(i.itemMrg,t.ICliente.sTELEFONO1),d=o
r&&(d+=" "+r),l&&(d+=" ("+l+")")
var c="Il cliente "+d+" sara' rimosso e le sue prenotazioni "
c+="passeranno al cliente che sara' selezionato nel prossimo passaggio. ",c+="In questo modo le due posizioni anagrafiche saranno accorpate. Proseguire?",WUX.confirm(c,function(t){t&&(i.dlgMrgC.setProps(s),i.fpFilter.transferTo(i.dlgMrgC.fpFilter),i.dlgMrgC.show())})}}),this.btnSMS=new WUX.WButton(this.subId("bx"),"Invia SMS",WUX.WIcon.ENVELOPE_O,WUX.BTN.ACT_OUTLINE_INFO),this.btnSMS.on("click",function(t){var e=i.tabResult.getSelectedRowsData()
if(!e||!e.length)return void WUX.showWarning("Selezionare un cliente per inviare un SMS")
i.dlgText.setState(""),i.dlgText.show()}),this.btnComm=new WUX.WButton(this.subId("by"),"Comunicazione",WUX.WIcon.SEND,WUX.BTN.ACT_OUTLINE_INFO),this.btnComm.on("click",function(e){var n=i.tabResult.getState()
return n&&n.length?t.strutture&&t.strutture.length?void jrpc.execute("COMUNICAZIONI.getAll",[t.strutture[0].id],function(t){i.dlgComm.setState(t),i.dlgComm.show()}):void WUX.showWarning("Strutture non caricate"):void WUX.showWarning("Effettuare una ricerca per l'invio di una comunicazione")})
var a=[["Cognome",t.ICliente.sCOGNOME,"s"],["Nome",t.ICliente.sNOME,"s"],["Telefono",t.ICliente.sTELEFONO1,"s"],["Email",t.ICliente.sEMAIL,"s"],["Sesso",t.ICliente.sSESSO,"s"],["Data Nascita",t.ICliente.sDATA_NASCITA,"d"]]
return this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(a,0),e.col(a,1)),this.tabResult.exportFile="clienti",this.tabResult.types=e.col(a,2),this.tabResult.css({h:250}),this.tabResult.widths=[100],this.tabResult.onSelectionChanged(function(t){i.onSelect()}),this.tabResult.onRowPrepared(function(e){e.data&&e.data[t.ICliente.sREPUTAZIONE]&&WUX.setCss(e.rowElement,WUX.CSS.ERROR)}),this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.left.add(this.btnMerge),this.cntActions.left.add(this.btnSMS),this.cntActions.left.add(this.btnComm),this.cntActions.right.add(this.btnNew),this.tagsFilter=new WUX.WTags("tf"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").section("Dettaglio").add(this.fpDetail).addRow().addCol("12").section("Storico Prenotazioni").add(this.tabStorico),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.onSelect=function(){var i=this,n=e.getItem(this.tabResult.getSelectedRowsData(),0)
if(n){var a=e.getNumber(n,t.ICliente.sID)
a&&(this.status==this.iSTATUS_EDITING&&(WUX.showWarning("Modifiche annullate"),this.fpDetail.enabled=!1),this.fpDetail.clear(),jrpc.execute("CLIENTI.read",[a],function(n){i.fpDetail.setState(n),i.tabStorico.setState(e.getArray(n,t.ICliente.sPRENOTAZIONI)),i.status=i.iSTATUS_VIEW}))}},n}(WUX.WComponent)
t.GUIClienti=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(n){var a=i.call(this,n||"*","GUICollaboratori")||this
return a.iSTATUS_STARTUP=0,a.iSTATUS_VIEW=1,a.iSTATUS_EDITING=2,a.status=a.iSTATUS_STARTUP,a.dlgOrariPers=new t.DlgOrariPers(a.subId("dlgop")),a.dlgOrariPers.onHiddenModal(function(i){if(a.dlgOrariPers.ok){var n=e.toNumber(a.selFar.getState()),s=a.dlgOrariPers.getProps(),o=e.getObject(a.dlgOrariPers.getState(),t.ICalendario.sORARI)
if(!s)return void WUX.showWarning("Data variazione non presente.")
t.chkExecute("CALENDARIO.saveVariazioni",[n,s,o],function(t){WUX.showSuccess("Variazione salvata con successo.")})}}),a.dlgAgenda=new t.DlgAgenda(a.subId("dlga")),a.dlgAgenda.onHiddenModal(function(i){if(a.dlgAgenda.ok){var n=a.dlgAgenda.getState()
if(!n)return void WUX.showWarning("Informazioni agenda assenti")
var s=e.getItem(a.tabResult.getSelectedRowsData(),0)
if(s){var o=e.getNumber(s,t.ICollaboratore.sID)
if(!o)return void WUX.showWarning("Collaboratore non selezionato.")
var r=n.id,l=e.toBoolean(a.fpDetail.getValue(t.ICollaboratore.sPREN_ONLINE))
t.chkExecute("COLLABORATORI.addAgenda",[o,l,n],function(t){if(!t)return void WUX.showWarning("Piano NON inserito")
WUX.showSuccess("Piano inserito con successo."),n.id=t
var i=a.tabVar.getState()
if(i||(i=[]),r){var s=e.indexOf(i,"id",r)
s>=0&&i.splice(s,1)}i.push(n),a.tabVar.setState(i)})}}}),a.dlgAssenze=new t.DlgAssenze(a.subId("dlgx")),a.dlgAssenze.onHiddenModal(function(i){if(a.dlgAssenze.ok){var n=a.dlgAssenze.getState()
if(!(null==n||n.length<2)){var s=e.getItem(a.tabResult.getSelectedRowsData(),0)
if(s){var o=e.getNumber(s,t.ICollaboratore.sID)
if(!o)return void WUX.showWarning("Collaboratore non selezionato.")
t.chkExecute("COLLABORATORI.addAssenze",[o,n[0],n[1]],function(t){if(!t||!t.length)return void WUX.showWarning("Assenze NON inserite")
WUX.showSuccess(t.length+" variazioni giornaliere inserite")
var e=a.tabVar.getState()
e||(e=[])
for(var i=0;i<t.length;i++)e.push(t[i])
a.tabVar.setState(e)})}}}}),a}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.fpFilter.checkMandatory(!0,!0,!1)
if(a)return void WUX.showWarning("Specificare i seguenti campi: "+a)
var s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("COLLABORATORI.find",[i.fpFilter.getState()],function(n){if(i.tabResult.setState(n),i.fpDetail.clear(),i.cmpAgenda.clear(),i.tabVar.setState([]),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),i.btnVisible.setText("Visibile",WUX.WIcon.THUMBS_O_UP),i.btnVisible2.setText("Visibile",WUX.WIcon.THUMBS_O_UP),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.ICollaboratore.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},200),i.selId=null}})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.cmpAgenda.clear(),i.tabVar.setState([]),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),i.btnVisible.setText("Visibile",WUX.WIcon.THUMBS_O_UP),i.btnVisible2.setText("Visibile",WUX.WIcon.THUMBS_O_UP),i.status=i.iSTATUS_STARTUP}),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(n){i.tabResult.setState([]),i.fpDetail.clear(),i.cmpAgenda.clear(),i.tabVar.setState([]),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),t.cp_prest=null
var a=e.toNumber(i.selFar.getState(),0)
jrpc.execute("PRESTAZIONI.getAll",[a],function(t){i.tabAll.setState(t)})}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.ICollaboratore.sID_FAR,"Struttura",this.selFar),this.fpFilter.addTextField(t.ICollaboratore.sNOME,"Nome"),this.fpFilter.setMandatory(t.ICollaboratore.sID_FAR),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.ICollaboratore.sNOME,"Nome"),this.fpDetail.addBlankField(),this.fpDetail.addBlankField(),this.fpDetail.addRow(),this.fpDetail.addBooleanField(t.ICollaboratore.sPREN_ONLINE,"Prenotabile On Line"),this.fpDetail.addBlankField(),this.fpDetail.addBlankField(),this.fpDetail.addRow(),this.fpDetail.addComponent(t.ICollaboratore.sCOLORE,"Colore",new t.CFSelectColore),this.fpDetail.addBlankField(),this.fpDetail.addBlankField(),this.fpDetail.addRow(),this.fpDetail.addIntegerField(t.ICollaboratore.sORDINE,"Ordine nel planning"),this.fpDetail.addBooleanField(t.ICollaboratore.sVISIBILE,"Visibile nel planning"),this.fpDetail.addBlankField(),this.fpDetail.addInternalField(t.ICollaboratore.sID),this.fpDetail.enabled=!1,this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.cmpAgenda.enabled=!0,i.btnDx.enabled=!0,i.btnSx.enabled=!0,i.btnPa.enabled=!0,i.fpDetail.clear(),i.cmpAgenda.clear(),i.tabVar.setState([]),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter(),i.tcoDetail.setState(0),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,i.cmpAgenda.enabled=!0,i.btnDx.enabled=!0,i.btnSx.enabled=!0,i.btnPa.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
i.cmpAgenda.isBlank()||i.cmpAgenda.isActivated()||WUX.showWarning("Planning non generato poich&aacute; orario non attivato.")
var o=i.fpDetail.getState()
o[t.ICollaboratore.sID_FAR]=s,o[t.ICollaboratore.sPRESTAZIONI]=i.tabSel.getState(),o[t.ICollaboratore.sAGENDA]=i.cmpAgenda.getState(),i.isNew?jrpc.execute("COLLABORATORI.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.cmpAgenda.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,WUX.showSuccess("Collaboratore inserito con successo."),i.selId=e[t.ICollaboratore.sID],i.btnFind.trigger("click")}):jrpc.execute("COLLABORATORI.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.cmpAgenda.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,WUX.showSuccess("Collaboratore aggiornato con successo."),i.selId=e[t.ICollaboratore.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?(i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter()):i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.cmpAgenda.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezione l'elemento da eliminare")
var s=e.getInt(a[0],t.ICollaboratore.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("COLLABORATORI.delete",[s],function(t){i.btnFind.trigger("click")})})}),this.btnVisible=new WUX.WButton(this.subId("bv"),"Visibile",WUX.WIcon.THUMBS_O_UP,WUX.BTN.ACT_OUTLINE_DANGER),this.btnVisible.on("click",function(n){i.btnVisible.blur()
var a=i.tabResult.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezione l'elemento da aggiornare")
var s=e.getInt(a[0],t.ICollaboratore.sID),o=!e.getBoolean(a[0],t.ICollaboratore.sVISIBILE)
jrpc.execute("COLLABORATORI.setVisible",[s,o],function(e){if(e){WUX.showSuccess("Aggiornamento eseguito con successo."),i.selId=e[t.ICollaboratore.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0],s=i.tabResult.getState()
s[a]&&(s[a][t.ICollaboratore.sVISIBILE]=o,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100),o?(i.btnVisible.setText("Non visibile",WUX.WIcon.THUMBS_O_DOWN),i.btnVisible2.setText("Non visibile",WUX.WIcon.THUMBS_O_DOWN)):(i.btnVisible.setText("Visibile",WUX.WIcon.THUMBS_O_UP),i.btnVisible2.setText("Visibile",WUX.WIcon.THUMBS_O_UP)))}else i.btnFind.trigger("click")}})}),this.btnOpen2=new WUX.WButton(this.subId("bo2"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen2.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen2.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen2.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,i.cmpAgenda.enabled=!0,i.btnDx.enabled=!0,i.btnSx.enabled=!0,i.btnPa.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave2=new WUX.WButton(this.subId("bs2"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave2.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave2.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave2.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
i.cmpAgenda.isBlank()||i.cmpAgenda.isActivated()||WUX.showWarning("Planning non generato poich&aacute; orario non attivato.")
var o=i.fpDetail.getState()
o[t.ICollaboratore.sID_FAR]=s,o[t.ICollaboratore.sPRESTAZIONI]=i.tabSel.getState(),o[t.ICollaboratore.sAGENDA]=i.cmpAgenda.getState(),i.isNew?jrpc.execute("COLLABORATORI.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.cmpAgenda.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,WUX.showSuccess("Collaboratore inserito con successo."),i.selId=e[t.ICollaboratore.sID],i.btnFind.trigger("click")}):jrpc.execute("COLLABORATORI.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.cmpAgenda.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,WUX.showSuccess("Collaboratore aggiornato con successo."),i.selId=e[t.ICollaboratore.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel2=new WUX.WButton(this.subId("bc2"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel2.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel2.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?(i.fpDetail.clear(),i.tabSel.setState([]),i.tabAll.clearSelection(),i.tabAll.clearFilter()):i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.cmpAgenda.enabled=!1,i.btnDx.enabled=!1,i.btnSx.enabled=!1,i.btnPa.enabled=!1,i.selId=null)})}),this.btnDelete2=new WUX.WButton(this.subId("bd2"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete2.on("click",function(n){if(i.selId=null,i.btnDelete2.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezione l'elemento da eliminare")
var s=e.getInt(a[0],t.ICollaboratore.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("COLLABORATORI.delete",[s],function(t){i.btnFind.trigger("click")})})}),this.btnVisible2=new WUX.WButton(this.subId("bv2"),"Visibile",WUX.WIcon.THUMBS_O_UP,WUX.BTN.ACT_OUTLINE_DANGER),this.btnVisible2.on("click",function(n){i.btnVisible2.blur()
var a=i.tabResult.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezione l'elemento da aggiornare")
var s=e.getInt(a[0],t.ICollaboratore.sID),o=!e.getBoolean(a[0],t.ICollaboratore.sVISIBILE)
jrpc.execute("COLLABORATORI.setVisible",[s,o],function(e){if(e){WUX.showSuccess("Aggiornamento eseguito con successo."),i.selId=e[t.ICollaboratore.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0],s=i.tabResult.getState()
s[a]&&(s[a][t.ICollaboratore.sVISIBILE]=o,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100),o?(i.btnVisible.setText("Non visibile",WUX.WIcon.THUMBS_O_DOWN),i.btnVisible2.setText("Non visibile",WUX.WIcon.THUMBS_O_DOWN)):(i.btnVisible.setText("Visibile",WUX.WIcon.THUMBS_O_UP),i.btnVisible2.setText("Visibile",WUX.WIcon.THUMBS_O_UP)))}else i.btnFind.trigger("click")}})})
var n=[["Colore",t.ICollaboratore.sCOLORE,"s"],["Nome",t.ICollaboratore.sNOME,"s"],["Ordine",t.ICollaboratore.sORDINE,"i"],["Pren. On Line",t.ICollaboratore.sPREN_ONLINE,"b"],["Visibile",t.ICollaboratore.sVISIBILE,"b"]]
this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(n,0),e.col(n,1)),this.tabResult.css({h:220}),this.tabResult.widths=[50,300],this.tabResult.types=e.col(n,2),this.tabResult.onSelectionChanged(function(t){i.onSelect()}),this.tabResult.onCellPrepared(function(e){if("header"!=e.rowType){e.cellElement.css("padding","4px 0px 4px 8px")
e.column.dataField==t.ICollaboratore.sCOLORE&&e.cellElement.html('<div style="width:30px;height:30px;border-radius:50%;background-color:#'+e.value+';"></div>')}}),this.lblVar=new WUX.WLabel(this.subId("lba"),"Non occorre cliccare su Modifica o Salva: le modifiche fatte in questa sezione sono immediate.",WUX.WIcon.WARNING),this.lblVar.css({f:14,fw:"bold"},WUX.CSS.LABEL_NOTICE),this.tabVar=new WUX.WDXTable(this.subId("tbv"),["Inizio Val.","Fine Val.","Descrizione"],["inizioValidita","fineValidita","descrizione"]),this.tabVar.selectionMode="single",this.tabVar.css({h:250}),this.tabVar.widths=[120,120],this.tabVar.onDoubleClick(function(n){var a=i.tabVar.getSelectedRowsData()
if(a&&a.length){var s=e.getNumber(a[0],"id")
if(!s)return void WUX.showWarning("Riferimento alla variazione assente")
if(s<0){var o=e.getDate(a[0],"inizioValidita")
if(!o)return void WUX.showWarning("Data variazione assente")
var r={}
r[t.ICalendario.sDATA]=o,r[t.ICalendario.sID_COLLABORATORE]=i.fpDetail.getValue(t.ICollaboratore.sID),jrpc.execute("CALENDARIO.getTimeTable",[r],function(t){i.dlgOrariPers.setProps(o),i.dlgOrariPers.setState(t),i.dlgOrariPers.show()})}else jrpc.execute("COLLABORATORI.readAgenda",[s],function(t){i.dlgAgenda.setState(t),i.dlgAgenda.show()})}}),this.btnAddVar=new WUX.WButton(this.subId("bav"),t.TXT.ADD,"",WUX.BTN.SM_PRIMARY),this.btnAddVar.on("click",function(t){i.dlgAgenda.setState(null),i.dlgAgenda.show()}),this.btnAddAss=new WUX.WButton(this.subId("bac"),"Assenze","",WUX.BTN.SM_INFO),this.btnAddAss.on("click",function(t){i.dlgAssenze.show()}),this.btnRemVar=new WUX.WButton(this.subId("brv"),t.TXT.REMOVE,"",WUX.BTN.SM_DANGER),this.btnRemVar.on("click",function(n){var a=e.getItem(i.tabResult.getSelectedRowsData(),0)
if(a){var s=e.getNumber(a,t.ICollaboratore.sID)
if(!s)return void WUX.showWarning("Collaboratore non selezionato.")
var o=i.tabVar.getSelectedRows(),r=i.tabVar.getSelectedRowsData()
if(!r||!r.length)return void WUX.showWarning("Selezionare la variazione da rimuovere")
var l=e.getNumber(r[0],"id")
if(!l)return void WUX.showWarning("Riferimento alla variazione assente")
var d=e.getDate(r[0],"inizioValidita")
WUX.confirm("Si vuole rimuovere la variazione selezionata?",function(e){e&&(l<0?t.chkExecute("CALENDARIO.deleteVariazioni",[s,d],function(t){if(!t)return void WUX.showWarning("Variazione NON eliminata.")
WUX.showSuccess("Variazione eliminata con successo.")
var e=i.tabVar.getState()
e.splice(o[0],1),i.tabVar.setState(e)}):l>0&&t.chkExecute("COLLABORATORI.deleteAgenda",[l],function(t){if(!t)return void WUX.showWarning("Piano NON eliminato.")
WUX.showSuccess("Piano eliminato con successo.")
var e=i.tabVar.getState()
e.splice(o[0],1),i.tabVar.setState(e)}))})}}),this.tabSel=new WUX.WDXTable(this.subId("tbs"),["Gruppo","Descrizione"],[t.IPrestazione.sDESC_GRUPPO,t.IPrestazione.sDESCRIZIONE]),this.tabSel.selectionMode="multiple",this.tabSel.css({h:250}),this.tabSel.widths=[100],this.tabSel.filter=!0,this.tabSel.onCellPrepared(function(e){e.column.dataField==t.IPrestazione.sDESC_GRUPPO&&e.cellElement.addClass("clickable")}),this.tabSel.onCellClick(function(e){var n=e.row
if(null!=n&&"data"==n.rowType){if(e.column.dataField==t.IPrestazione.sDESC_GRUPPO){for(var a=[],s=i.tabSel.getState(),o=0;o<s.length;o++){s[o][t.IPrestazione.sDESC_GRUPPO]==e.value&&a.push(o)}if(!a||!a.length)return
i.tabSel.setState(s),setTimeout(function(){i.tabSel.select(a)},200)}}}),this.tabAll=new WUX.WDXTable(this.subId("tba"),["Gruppo","Descrizione"],[t.IPrestazione.sDESC_GRUPPO,t.IPrestazione.sDESCRIZIONE]),this.tabAll.selectionMode="multiple",this.tabAll.css({h:250}),this.tabAll.widths=[100],this.tabAll.filter=!0,this.tabAll.onCellPrepared(function(e){e.column.dataField==t.IPrestazione.sDESC_GRUPPO&&e.cellElement.addClass("clickable")}),this.tabAll.onCellClick(function(e){var n=e.row
if(null!=n&&"data"==n.rowType){if(e.column.dataField==t.IPrestazione.sDESC_GRUPPO){for(var a=[],s=i.tabAll.getState(),o=0;o<s.length;o++){s[o][t.IPrestazione.sDESC_GRUPPO]==e.value&&a.push(o)}if(!a||!a.length)return
i.tabAll.setState(s),setTimeout(function(){i.tabAll.select(a)},200)}}}),this.btnSx=new WUX.WButton(this.subId("bba"),"",t.ICO.LEFT,WUX.BTN.PRIMARY,{p:"1px 6px 1px 6px"}),this.btnSx.tooltip="Aggiungi trattamenti",this.btnSx.enabled=!1,this.btnSx.on("click",function(e){var n=i.tabSel.getState()
n||(n=[])
var a=i.tabAll.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare uno o pi&ugrave; trattamenti dal catalogo.")
for(var s=!1,o=0;o<a.length;o++){for(var r=a[o],l=r[t.IPrestazione.sID],d=!1,c=0;c<n.length;c++){if(n[c][t.IPrestazione.sID]==l){d=!0
break}}d||(n.push(r),s=!0)}i.tabSel.setState(n),s&&setTimeout(function(){i.tabSel.scrollTo(999999)},250)}),this.btnDx=new WUX.WButton(this.subId("bbd"),"",t.ICO.DELETE,WUX.BTN.DANGER,{p:"1px 7px 1px 7px"}),this.btnDx.tooltip="Rimuovi trattamenti",this.btnDx.enabled=!1,this.btnDx.on("click",function(e){var n=i.tabSel.getState()
n||(n=[])
var a=i.tabSel.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare uno o pi&ugrave; trattamenti dall'elenco degli assegnati.")
for(var s=[],o=0;o<n.length;o++){for(var r=n[o],l=r[t.IPrestazione.sID],d=!1,c=0;c<a.length;c++){if(a[c][t.IPrestazione.sID]==l){d=!0
break}}d||s.push(r)}i.tabSel.setState(s)}),this.btnCp=new WUX.WButton(this.subId("bbc"),"",t.ICO.COPY,WUX.BTN.SECONDARY,{p:"1px 7px 1px 7px"}),this.btnCp.tooltip="Copia trattamenti",this.btnCp.on("click",function(e){var n=i.tabSel.getState()
if(!n||!n.length)return void WUX.showSuccess("Nessun elemento selezionato")
t.cp_prest=n,WUX.showSuccess("Trattamenti copiati nella clipboard")}),this.btnPa=new WUX.WButton(this.subId("bbp"),"",t.ICO.PASTE,WUX.BTN.WARNING,{p:"1px 7px 1px 7px"}),this.btnPa.tooltip="Incolla trattamenti",this.btnPa.enabled=!1,this.btnPa.on("click",function(e){if(!t.cp_prest)return void WUX.showWarning("Non vi sono trattamenti nella clipboard")
i.tabSel.setState(t.cp_prest)})
var a=new WUX.WContainer(this.subId("ct0"),"")
return a.addRow().addCol("11",{p:0}).add(this.tabSel).addCol("1",{p:0}).addStack(WUX.CSS.STACK_BTNS,this.btnSx,this.btnDx,this.btnCp,this.btnPa),this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.left.add(this.btnVisible),this.cntActions.right.add(this.btnNew),this.cntActions2=new t.CFTableActions("ta2"),this.cntActions2.left.add(this.btnOpen2),this.cntActions2.left.add(this.btnDelete2),this.cntActions2.left.add(this.btnSave2),this.cntActions2.left.add(this.btnCancel2),this.cntActions2.left.add(this.btnVisible2),this.tagsFilter=new WUX.WTags("tf"),this.cmpAgenda=new t.CFAgenda(this.subId("age")),this.tcoDetail=new WUX.WTab("tcod"),this.tcoDetail.addTab("Anagrafica",WUX.WIcon.ADDRESS_CARD).addRow().addCol("12",{h:300}).add(this.fpDetail),this.tcoDetail.addTab("Orari",WUX.WIcon.CLOCK_O).add(this.cmpAgenda),this.tcoDetail.addTab("Variazioni",WUX.WIcon.CALENDAR).addRow().addCol("12").add(this.lblVar).addDiv(8).addRow().addCol("11",{h:300}).add(this.tabVar).addCol("1",{h:300}).addStack(WUX.CSS.STACK_BTNS,this.btnAddVar,this.btnAddAss,this.btnRemVar),this.tcoDetail.addTab("Trattamenti",WUX.WIcon.COG).addRow().addCol("6").section("Assegnati",{h:300}).add(a).addCol("6").section("Catalogo",{h:300}).add(this.tabAll),this.tcoDetail.on("statechange",function(t){switch(i.tcoDetail.getState()){case 0:case 1:break
case 2:i.tabVar.repaint()
break
case 3:i.tabSel.repaint(),i.tabAll.repaint()}}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult,this.cntActions2).end().addRow().addCol("12").section("Dettaglio").add(this.tcoDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.onSelect=function(){var i=this,n=e.getItem(this.tabResult.getSelectedRowsData(),0)
if(n){var a=e.getNumber(n,t.ICollaboratore.sID)
a&&(this.fpDetail.clear(),this.cmpAgenda.clear(),this.tabVar.setState([]),this.tabSel.setState([]),this.tabAll.clearSelection(),this.tabAll.clearFilter(),this.status==this.iSTATUS_EDITING&&(WUX.showWarning("Modifiche annullate"),this.fpDetail.enabled=!1,this.cmpAgenda.enabled=!1,this.btnDx.enabled=!1,this.btnSx.enabled=!1,this.btnPa.enabled=!1),jrpc.execute("COLLABORATORI.read",[a],function(n){i.fpDetail.setState(n),i.cmpAgenda.setState(e.getObject(n,t.ICollaboratore.sAGENDA)),i.tabVar.setState(e.getArray(n,t.ICollaboratore.sVARIAZIONI)),i.tabSel.setState(e.getArray(n,t.ICollaboratore.sPRESTAZIONI)),i.status=i.iSTATUS_VIEW,t.CFBookCfg.CHECK_USER_DESK=e.getBoolean(n,t.ICalendario.sCHECK_USER_DESK),e.getBoolean(n,t.ICollaboratore.sVISIBILE)?(i.btnVisible.setText("Non visibile",WUX.WIcon.THUMBS_O_DOWN),i.btnVisible2.setText("Non visibile",WUX.WIcon.THUMBS_O_DOWN)):(i.btnVisible.setText("Visibile",WUX.WIcon.THUMBS_O_UP),i.btnVisible2.setText("Visibile",WUX.WIcon.THUMBS_O_UP))}))}},n.prototype.componentDidMount=function(){var i=this,n=e.toInt(e.getParam(t.ICollaboratore.sID_FAR),0)
n||t.strutture&&t.strutture.length&&(n=t.strutture[0].id),n&&this.selFar.setState(n),this.cmpAgenda.clear(),this.cmpAgenda.setDateRef(new Date),this.cmpAgenda.enabled=!1
var a=e.toInt(e.getParam(t.ICollaboratore.sID),0),s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(this.tagsFilter.setState(this.fpFilter.getValues(!0)),s.collapse())
var o={}
o[t.ICollaboratore.sID]=a,o[t.ICollaboratore.sID_FAR]=n,this.selId=a,jrpc.execute("COLLABORATORI.find",[o],function(t){i.tabResult.setState(t),t&&1==t.length&&setTimeout(function(){i.tabResult.select([0])},200)})},n}(WUX.WComponent)
t.GUICollaboratori=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(t){function e(e){var i=t.call(this,e,"CFTableActions",null,"table-actions-wrapper")||this
return i.left=new WUX.WContainer(i.subId("l"),"left-actions"),i.right=new WUX.WContainer(i.subId("r"),"right-actions"),i}return __extends(e,t),e.prototype.componentDidMount=function(){var t=$('<div class="table-actions clearfix" data-b2x-sticky-element="1" data-b2x-sticky-element-z-index="3"></div>')
this.root.append(t),this.left.mount(t),this.right.mount(t)},e.prototype.setLeftVisible=function(t){this.left.visible=t},e.prototype.setRightVisible=function(t){this.right.visible=t},e}(WUX.WComponent)
t.CFTableActions=i
var n=function(t){function e(e,i,n){void 0===i&&(i=12),void 0===n&&(n=0)
var a=t.call(this,e)||this
a.multiple=!1,a.name="CFSelectMesi",a.options=[]
var s=new Date,o=s.getMonth()+1,r=s.getFullYear()
n>0&&(o+=n)>12&&(o-=12,o>12&&(o=1),r++)
for(var l=0;l<i;l++){var d=100*r+o
a.options.push({id:d,text:WUX.formatMonth(o,!0,r)}),o--,0==o&&(o=12,r--)}return a}return __extends(e,t),e}(WUX.WSelect2)
t.CFSelectMesi=n
var a=function(i){function n(t,e){var n=i.call(this,t)||this
return n.multiple=e,n.name="CFSelectStruture",n.openOnFocus=!1,n}return __extends(n,i),n.prototype.componentDidMount=function(){if(this.items=[],t.strutture){this.items=t.strutture
var i={data:this.items,placeholder:"",allowClear:!0}
return void this.init(i)}var n=t.getUserLogged(),a=0
n&&n.structures&&n.structures.length&&(a=e.toNumber(n.structures[0]))
var s=jrpc.executeSync("STRUTTURE.getFarmacie",[a])
s||(s=[])
for(var o=0;o<s.length;o++){var r=s[o]
this.items.push({id:r.i,text:r.c+" - "+r.d})}t.strutture=this.items
var l={data:this.items,placeholder:"",allowClear:!0}
this.init(l)},n}(WUX.WSelect2)
t.CFSelectStruture=a
var s=function(i){function n(t,e){var n=i.call(this,t)||this
return n.multiple=e,n.name="CFSelOpzClienti",n.openOnFocus=!1,n}return __extends(n,i),n.prototype.componentDidMount=function(){this.items=[],this.strts=[],this.items.push({id:"M",text:"inseriti dall'operatore corrente"})
var i=t.getUserLogged(),n=0
i&&i.structures&&i.structures.length&&(n=e.toNumber(i.structures[0]))
var a=jrpc.executeSync("STRUTTURE.getFarmacie",[n])
a||(a=[])
for(var s=0;s<a.length;s++){var o=a[s]
this.items.push({id:o.i,text:"prenotati in "+o.d}),this.strts.push({id:o.i,text:o.c+" - "+o.d})}t.strutture=this.strts
var r={data:this.items,placeholder:"",allowClear:!0}
this.init(r)},n}(WUX.WSelect2)
t.CFSelOpzClienti=s
var o=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectTipoPrezzo",n.options=[{id:"",text:""},{id:"F",text:"Fisso"},{id:"A",text:"A partire da"}],n}return __extends(e,t),e}(WUX.WSelect2)
t.CFSelectTipoPrezzo=o
var r=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectLav",n.options=[{id:"",text:""},{id:"L",text:"Lavora"},{id:"N",text:"Non lavora"}],n}return __extends(e,t),e}(WUX.WSelect2)
t.CFSelectLav=r
var l=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectStatiPren",n.options=[{id:"",text:""},{id:"C",text:"Confermata"},{id:"E",text:"Eseguita"},{id:"N",text:"Non presentato"},{id:"F",text:"Fuori uscita"},{id:"A",text:"Annullata"},{id:"*",text:"Compreso Annullata"}],n}return __extends(e,t),e}(WUX.WSelect2)
t.CFSelectStatiPren=l
var d=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectTipoCom",n.options=[{id:"",text:""},{id:"S",text:"SMS"},{id:"N",text:"Notifica"},{id:"M",text:"Misto (SMS/Notifica)"}],n}return __extends(e,t),e}(WUX.WSelect2)
t.CFSelectTipoCom=d
var c=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectAppTipoPag",n.options=[{id:"",text:""},{id:"CPN",text:"Coupon"},{id:"CON",text:"Contanti"},{id:"CAR",text:"Carta di credito"},{id:"BAN",text:"Bancomat"},{id:"ASS",text:"Assegno"},{id:"BON",text:"Bonifico"},{id:"OMA",text:"Omaggio"},{id:"NES",text:"Nessuno"}],n}return __extends(e,t),e}(WUX.WSelect2)
t.CFSelectAppTipoPag=c
var u=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectTipoApp",n.options=[{id:"",text:""},{id:"F",text:"Fidelity"},{id:"O",text:"Omaggio"}],n}return __extends(e,t),e.prototype.close=function(){this.root&&this.root.select2("close")},e}(WUX.WSelect2)
t.CFSelectTipoApp=u
var h=function(t){function e(e,i){var n=t.call(this,e)||this
n.multiple=i,n.name="CFSelectOrario",n.options=[],n.allSlots=[]
for(var a=0;a<24;a++)for(var s=a<10?"0"+a:""+a,o=0;o<60;o+=10){var r=o<10?"0"+o:""+o,l=100*a+o
n.options.push({id:l,text:s+":"+r}),n.allSlots.push({id:l,text:s+":"+r})}return n}return __extends(e,t),e.prototype.setAppts=function(t){if(!t||!t.length)return this.setOptions([]),this
for(var e=[],i=0;i<t.length;i++)e.push({id:t[i],text:WUX.formatTime(t[i])})
return this.setOptions(e),this},e.prototype.setAllSlots=function(){return this.setOptions(this.allSlots),this},e}(WUX.WSelect2)
t.CFSelectOrario=h
var p=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectGruppiPre",n}return __extends(e,t),e.prototype.componentDidMount=function(){var t=this
jrpc.execute("PRESTAZIONI.lookupGruppi",[{}],function(e){for(var i=[],n=0;n<e.length;n++){var a=e[n],s={id:a[0],text:a[1]}
i.push(s)}var o={data:i,placeholder:"",allowClear:!0}
t.init(o)})},e}(WUX.WSelect2)
t.CFSelectGruppiPre=p
var b=function(t){function e(e,i){var n=t.call(this,e)||this
return n.multiple=i,n.name="CFSelectGruppiPre",n}return __extends(e,t),e.prototype.componentDidMount=function(){var t=this
jrpc.execute("PRESTAZIONI.lookupTipi",[{}],function(e){for(var i=[],n=0;n<e.length;n++){var a=e[n],s={id:a[0],text:a[1]}
i.push(s)}var o={data:i,placeholder:"",allowClear:!0}
t.init(o)})},e}(WUX.WSelect2)
t.CFSelectTipiPre=b
var I=function(e){function i(t,i){var n=e.call(this,t)||this
return n.multiple=i,n.name="CFSelectCabine",n.idFar=0,n.openOnFocus=!1,n}return __extends(i,e),i.prototype.setIdFar=function(e,i){var n=this
if(!e){this.idFar=0
var a={data:[],placeholder:"",allowClear:!0}
return this.init(a),this}return this.idFar==e?void(i&&this.setState(i)):(this.idFar=e,jrpc.execute("ATTREZZATURE.getAll",[this.idFar],function(e){for(var a=[],s=0;s<e.length;s++){var o=e[s],r={id:o[t.IAttrezzatura.sID],text:o[t.IAttrezzatura.sDESCRIZIONE]}
a.push(r)}var l={data:a,placeholder:"",allowClear:!0}
n.init(l),i&&setTimeout(function(){n.setState(i)},100)}),this)},i.prototype.componentDidMount=function(){var t=this.idFar
this.idFar=0,this.setIdFar(t)},i}(WUX.WSelect2)
t.CFSelectCabine=I
var f=function(e){function i(t,i){var n=e.call(this,t)||this
return n.multiple=i,n.name="CFSelectCollab",n.idFar=0,n.openOnFocus=!1,n.onlyVis=!0,n}return __extends(i,e),i.prototype.setIdFar=function(e,i){var n=this
if(!e){this.idFar=0
var a={data:[],placeholder:"",allowClear:!0}
return this.init(a),this}if(this.idFar==e)return void(i&&this.setState(i))
this.idFar=e
var s=this.onlyVis?[this.idFar]:[this.idFar,this.onlyVis]
return jrpc.execute("COLLABORATORI.getAll",s,function(e){for(var a=[],s=0;s<e.length;s++){var o=e[s],r={id:o[t.ICollaboratore.sID],text:o[t.ICollaboratore.sNOME]}
a.push(r)}var l={data:a,placeholder:"",allowClear:!0}
n.init(l),i&&setTimeout(function(){n.setState(i)},100)}),this},i.prototype.componentDidMount=function(){var t=this.idFar
this.idFar=0,this.setIdFar(t)},i}(WUX.WSelect2)
t.CFSelectCollab=f
var S=function(t){function e(e,i){var n=t.call(this,e,[],i)||this
return n.name="CFSelectClienti",n}return __extends(e,t),e.prototype.componentDidMount=function(){var t={ajax:{dataType:"json",delay:400,processResults:function(t,e){return{results:t}},transport:function(t,e,i){jrpc.execute("CLIENTI.lookup",[t.data],e)}},placeholder:"",allowClear:!0,minimumInputLength:3}
this.init(t)},e}(WUX.WSelect2)
t.CFSelectClienti=S
var g=function(t){function e(e,i,n,a){var s=t.call(this,e||"*","CFSelectColore",null,i,n,a)||this
return s.colors=["7bd148","5484ed","a4bdfc","46d6db","7ae7bf","51b749","fbd75b","ffb878","ff887c","dc2127","dbadff","e1e1e1"],s.items=[],s}return __extends(e,t),e.prototype.updateState=function(e){t.prototype.updateState.call(this,e),this.state&&"#"==this.state[0]&&(this.state=this.state.substring(1)),this.mounted&&this.updateView()},e.prototype.clear=function(){this.setState("")},e.prototype.componentDidMount=function(){var t=this
this.items=[]
for(var e=0;e<this.colors.length;e++){var i=$('<span style="display:inline-block;width:25px;height:25px;cursor:pointer;border-radius:50%;background-color:#'+this.colors[e]+';"></span>')
this.items.push(i),this.root.append(i),this.root.append("&nbsp;"),i.on("click",function(e){if(t._enabled&&e.target){var i=$(e.target),n=t.rgb2hex(i.css("background-color"))
t.setState(n)}})}},e.prototype.updateView=function(){for(var t=0;t<this.items.length;t++){var e=this.items[t],i=this.rgb2hex(e.css("background-color"))
this.state&&i=="#"+this.state?e.css("border","2px solid rgba(0,0,0,.5)"):e.css("border","none")}},e.prototype.rgb2hex=function(t){if(!t)return""
var e=t.replace(/\s/g,"").match(/^rgba?\((\d+),(\d+),(\d+)/i)
return e&&4===e.length?"#"+("0"+parseInt(e[1],10).toString(16)).slice(-2)+("0"+parseInt(e[2],10).toString(16)).slice(-2)+("0"+parseInt(e[3],10).toString(16)).slice(-2):t},e}(WUX.WComponent)
t.CFSelectColore=g
var A=function(i){function n(t,e,n,a){var s=i.call(this,t||"*","CFOrariSett",null,e,n,a)||this
return s.title="orario",s}return __extends(n,i),Object.defineProperty(n.prototype,"enabled",{set:function(t){if(this._enabled=t,this.fp&&(this.fp.enabled=t,t))for(var e=this.fp.getValues(),i=1;i<=7;i++){var n="L"==e["l"+i]
n||(this.fp.setEnabled("a"+i,!1),this.fp.setEnabled("s"+i,!1),this.fp.setEnabled("p"+i,!1),this.fp.setEnabled("r"+i,!1))}},enumerable:!1,configurable:!0}),n.prototype.updateState=function(t){if(i.prototype.updateState.call(this,t),this.mounted){if(!this.state)return void this.fp.clear()
for(var e=!0,n=0,a=!1,s={},o=0;o<=this.state.length;o++){var r=this.state[o]
if(r){var l=r.giorno
l&&(this.evenWeek&&!r.settPari||this.oddWeek&&!r.settDispari||(a=!1,n==l&&(a=!0),n=l,r.attivo?(e=!1,s["l"+l]="L"):s["l"+l]="N",a?(s["p"+l]=s["s"+l],s["s"+l]=r.oraFine,s["r"+l]=r.oraInizio):(s["a"+l]=r.oraInizio,s["s"+l]=r.oraFine)))}}this.ck.checked=!e,this.fp.setState(s)}},n.prototype.getState=function(){if(this.state=[],!this.mounted)return this.state
for(var t=this.fp.getValues(),i=this.ck.checked,n=1;n<=7;n++){var a="L"==t["l"+n]
if(a){var s=e.toInt(t["a"+n]),o=e.toInt(t["s"+n]),r=e.toInt(t["p"+n]),l=e.toInt(t["r"+n])
if(!(o<=s))if(r>s&&l>r){var d={settPari:this.evenWeek,settDispari:this.oddWeek,giorno:n,oraInizio:s,oraFine:r,attivo:i&&a},c={settPari:this.evenWeek,settDispari:this.oddWeek,giorno:n,oraInizio:l,oraFine:o,attivo:i&&a}
this.state.push(d),this.state.push(c)}else{var u={settPari:this.evenWeek,settDispari:this.oddWeek,giorno:n,oraInizio:s,oraFine:o,attivo:i&&a}
this.state.push(u)}}}return this.state},n.prototype.clear=function(){return this.fp&&this.fp.clear(),this},n.prototype.setDefaults=function(){if(!this.fp)return this
for(var t={},e=1;e<=7;e++)t["l"+e]=1==e||7==e?"N":"L",t["a"+e]=900,t["s"+e]=1800,t["p"+e]=null,t["r"+e]=null
return this.fp.setState(t),this},n.prototype.isBlank=function(){if(!this.fp)return!0
for(var t=this.fp.getValues(),e=1;e<=7;e++)if(t["l"+e])return!1
return!0},n.prototype.isActivated=function(){return!!this.ck&&this.ck.checked},n.prototype.render=function(){var e=this
null==this.title&&(this.title=""),this.ck=new WUX.WCheck("","Attiva "+this.title),this.ck.on("statechange",function(t){e.ck.checked&&e.isBlank()&&e.setDefaults()}),this.lc=new WUX.WLink(this.subId("l_c"),"Copia",t.ICO.COPY),this.lc.on("click",function(i){var n=e.getState()
if(n){for(var a=0;a<n.length;a++)n[a].settDispari=!0,n[a].settPari=!0
t.cp_orari=n,WUX.showSuccess("Orari copiati nella clipboard")}}),this.lp=new WUX.WLink(this.subId("l_p"),"Incolla",t.ICO.PASTE),this.lp.on("click",function(i){if(!t.cp_orari)return void WUX.showWarning("Non vi sono orari nella clipboard")
e.clear(),e.setState(t.cp_orari)})
var i=new WUX.WContainer("*","",{pt:10,a:"right"})
i.add(this.lc).addSpan(12).add(this.lp),this.fp=new WUX.WFormPanel(this.subId("f")),this.fp.addRow(),this.fp.addComponent("a","",this.ck.getWrapper()),this.fp.addBlankField(),this.fp.addComponent("_c","",i),this.fp.addRow(),this.fp.addCaption("Giorni","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Lavorativi?","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Attacco","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Stacco","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Pausa","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Rientro","","",WUX.CSS.LABEL_INFO),this.fp.addRow(),this.fp.addCaption("&nbsp;")
for(var n=1;n<=7;n++){var a=this.descDay(n)
this.fp.addRow(),7==n?this.fp.addCaption(a,"","",WUX.CSS.LABEL_NOTICE):this.fp.addCaption(a,"","",{fw:"bold"})
var s=new r
s.data=n,s.on("statechange",function(t){var i=t.component
if(i&&i.enabled){var n=i.getState(),a=i.data
n&&"N"!=n?(e.fp.setEnabled("a"+a,!0),e.fp.setEnabled("s"+a,!0),e.fp.setEnabled("p"+a,!0),e.fp.setEnabled("r"+a,!0)):(e.fp.setEnabled("a"+a,!1),e.fp.setEnabled("s"+a,!1),e.fp.setEnabled("p"+a,!1),e.fp.setEnabled("r"+a,!1))}}),this.fp.addComponent("l"+n,"",s),this.fp.addComponent("a"+n,"",new h),this.fp.addComponent("s"+n,"",new h),this.fp.addComponent("p"+n,"",new h),this.fp.addComponent("r"+n,"",new h)}return this.fp},n.prototype.descDay=function(t){switch(t){case 1:return"Luned&igrave;"
case 2:return"Marted&igrave;"
case 3:return"Mercoled&igrave;"
case 4:return"Gioved&igrave;"
case 5:return"Venerd&igrave;"
case 6:return"Sabato"
case 7:return"Domenica"}return""},n}(WUX.WComponent)
t.CFOrariSett=A
var T=function(t){function i(e,i,n,a){var s=t.call(this,e||"*","CFOrariPers",null,i,n,a)||this
return s.title="orario",s.resources=[],s.forceOnChange=!0,s}return __extends(i,t),i.prototype.updateState=function(e){if(t.prototype.updateState.call(this,e),this.mounted){if(!this.state||!this.resources)return void this.fp.clear()
for(var i={},n=0;n<this.resources.length;n++){var a=this.resources[n]
if(a&&a.id){var s=this.state[""+a.id]
s&&s.length&&(4==s.length?(i["v"+a.id]=s[3],i["l"+a.id]=s[2]?"L":"N",i["a"+a.id]=s[0],i["s"+a.id]=s[1]):8==s.length&&(s[3]||s[7]?i["v"+a.id]=1:i["v"+a.id]=0,i["l"+a.id]=s[2]?"L":"N",i["a"+a.id]=s[0],i["s"+a.id]=s[5],i["p"+a.id]=s[1],i["r"+a.id]=s[4]))}}this.values=i,this.fp.clear(),this.fp.setState(i)}},i.prototype.getState=function(){if(this.state={},!this.mounted)return this.state
this.resources||(this.resources=[])
for(var t=this.fp.getValues(),i=0;i<this.resources.length;i++){var n=this.resources[i]
if(n&&n.id){var a=e.toInt(t["v"+n.id]),s="L"==e.toString(t["l"+n.id])?1:0,o=e.toInt(t["a"+n.id]),r=e.toInt(t["s"+n.id]),l=e.toInt(t["p"+n.id]),d=e.toInt(t["r"+n.id])
this.state[""+n.id]=l>o&&d>l?[o,l,s,a,d,r,s,a]:[o,r,s,a]}}return this.state},i.prototype.clear=function(){return this.fp&&this.fp.clear(),this},i.prototype.refresh=function(){return this.fp&&(this.fp.clear(),this.fp.setState(this.values)),this},i.prototype.render=function(){var t=this
null==this.title&&(this.title=""),this.resources||(this.resources=[]),this.fp=new WUX.WFormPanel(this.subId("f")),this.fp.addRow(),this.fp.addCaption("Collaboratore","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Lavorativi?","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Attacco","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Stacco","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Pausa","","",WUX.CSS.LABEL_INFO),this.fp.addCaption("Rientro","","",WUX.CSS.LABEL_INFO)
for(var e=0;e<this.resources.length;e++){var i=this.resources[e]
if(i&&i.id){var n=new r
n.data=i.id,n.on("statechange",function(e){var i=e.component
if(i&&i.enabled){var n=i.getState(),a=i.data
n&&"N"!=n?(t.fp.setEnabled("a"+a,!0),t.fp.setEnabled("s"+a,!0),t.fp.setEnabled("p"+a,!0),t.fp.setEnabled("r"+a,!0)):(t.fp.setEnabled("a"+a,!1),t.fp.setEnabled("s"+a,!1),t.fp.setEnabled("p"+a,!1),t.fp.setEnabled("r"+a,!1))}})
var a=new WUX.WCheck("",i.text,1),s=!1
if(this.state){var o=this.state[""+i.id]
o&&4==o.length?o[3]&&(s=!0):o&&8==o.length&&(o[3]||o[7])&&(s=!0)}this.fp.addRow(),s?this.fp.addComponent("v"+i.id,"",a.getWrapper({mt:4,mb:0,c:"blue"})):this.fp.addComponent("v"+i.id,"",a.getWrapper({mt:4,mb:0})),this.fp.addComponent("l"+i.id,"",n),this.fp.addComponent("a"+i.id,"",new h),this.fp.addComponent("s"+i.id,"",new h),this.fp.addComponent("p"+i.id,"",new h),this.fp.addComponent("r"+i.id,"",new h)}}return this.fp},i}(WUX.WComponent)
t.CFOrariPers=T
var C=function(i){function n(t,e,n,a){var s=i.call(this,t||"*","CFAgenda",null,e,n,a)||this
return s.dateRif=new Date,s}return __extends(n,i),Object.defineProperty(n.prototype,"enabled",{set:function(t){this._enabled=t,this.cmpSx&&(this.cmpSx.enabled=t),this.cmpDx&&(this.cmpDx.enabled=t)},enumerable:!1,configurable:!0}),n.prototype.clear=function(){return this.cmpSx&&this.cmpSx.clear(),this.cmpDx&&this.cmpDx.clear(),this},n.prototype.isBlank=function(){return!(this.cmpSx&&!this.cmpSx.isBlank())&&!(this.cmpDx&&!this.cmpDx.isBlank())},n.prototype.isActivated=function(){return this.cmpSx&&this.cmpSx.isActivated()},n.prototype.updateState=function(e){if(i.prototype.updateState.call(this,e),this.mounted){if(!this.state)return this.cmpSx.clear(),void this.cmpDx.clear()
var n=this.state.fasceOrarie
if(!n||!n.length)return this.cmpSx.clear(),void this.cmpDx.clear()
if(this.state.settimaneAlt){for(var a=t.getWeek2020(this.dateRif),s=[],o=[],r=0;r<n.length;r++){var l=n[r]
l.settDispari&&l.settPari?s.push(l):l.settDispari&&!l.settPari?a%2==0?o.push(l):s.push(l):!l.settDispari&&l.settPari&&(a%2==0?s.push(l):o.push(l))}this.cmpSx.setState(s),this.cmpDx.setState(o)}else this.cmpSx.setState(n)}},n.prototype.getState=function(){if(this.state=null,!this.mounted)return this.state
this.state={id:0}
var t=this.cmpDx&&this.cmpDx.isActivated(),e=[]
if(this.cmpSx){var i=this.cmpSx.getState()
if(i&&i.length)for(var n=0;n<i.length;n++){var a=i[n]
a.oraInizio>=a.oraFine||(t||(a.settPari=!0,a.settDispari=!0),e.push(a))}}if(this.cmpDx&&this.cmpDx.isActivated()){var s=this.cmpDx.getState()
if(s&&s.length)for(var n=0;n<s.length;n++){var a=s[n]
a.oraInizio>=a.oraFine||e.push(a)}}return this.state.settimaneAlt=t,this.state.fasceOrarie=e,this.state},n.prototype.setDateRef=function(i){if(this.dateRif=e.toDate(i),this.mounted){t.getWeek2020(this.dateRif)%2==0?(this.cmpSx.evenWeek=!0,this.cmpSx.oddWeek=!1,this.cmpDx.evenWeek=!1,this.cmpDx.oddWeek=!0):(this.cmpSx.evenWeek=!1,this.cmpSx.oddWeek=!0,this.cmpDx.evenWeek=!0,this.cmpDx.oddWeek=!1)}},n.prototype.render=function(){return this.cmpSx=new A(this.subId("osc")),this.cmpSx.title="settimana corrente",this.cmpDx=new A(this.subId("osa")),this.cmpDx.title="settimana successiva",t.getWeek2020()%2==0?(this.cmpSx.evenWeek=!0,this.cmpSx.oddWeek=!1,this.cmpDx.evenWeek=!1,this.cmpDx.oddWeek=!0):(this.cmpSx.evenWeek=!1,this.cmpSx.oddWeek=!0,this.cmpDx.evenWeek=!0,this.cmpDx.oddWeek=!1),this.container=new WUX.WContainer,this.container.addRow().addCol("col-md-6 b-r").add(this.cmpSx).addCol("col-md-6").add(this.cmpDx),this.container},n}(WUX.WComponent)
t.CFAgenda=C}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){var e=i.call(this,t||"*","GUIComunicazioni")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.fpFilter.checkMandatory(!0,!0,!1)
if(a)return void WUX.showWarning("Specificare i seguenti campi: "+a)
var s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("COMUNICAZIONI.find",[t.CFUtil.putUserInfo(i.fpFilter.getState())],function(n){if(i.tabResult.setState(n),i.fpDetail.clear(),i.tabList.setState([]),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.IComunicazione.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},100),i.selId=null}})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.tabList.setState([]),i.status=i.iSTATUS_STARTUP}),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.tabResult.setState([]),i.fpDetail.clear()}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IComunicazione.sID_FAR,"Struttura",this.selFar),this.fpFilter.addTextField(t.IComunicazione.sOGGETTO,"Oggetto"),this.fpFilter.setMandatory(t.IComunicazione.sID_FAR),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.IComunicazione.sOGGETTO,"Oggetto"),this.fpDetail.addComponent(t.IComunicazione.sMEZZO,"Mezzo",new t.CFSelectTipoCom),this.fpDetail.addRow(),this.fpDetail.addComponent(t.IComunicazione.sMESSAGGIO,"Messaggio",new WUX.WTextArea),this.fpDetail.addInternalField(t.IComunicazione.sID),this.fpDetail.enabled=!1,this.fpDetail.setSpanField(t.IComunicazione.sOGGETTO,3),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),i.tabList.setState([]),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState(),r=e.getString(o,t.IComunicazione.sMESSAGGIO)
return r&&r.length?r.length>160?void WUX.showWarning("Il messaggio ha "+r.length+" caratteri (massimo consentito 160)."):(o[t.IComunicazione.sID_FAR]=s,void(i.isNew?jrpc.execute("COMUNICAZIONI.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IComunicazione.sID],i.btnFind.trigger("click")}):jrpc.execute("COMUNICAZIONI.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IComunicazione.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")}))):void WUX.showWarning("Messaggio non specificato.")}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?i.fpDetail.clear():i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IComunicazione.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("COMUNICAZIONI.delete",[s],function(t){i.btnFind.trigger("click")})})}})
var n=[["Oggetto",t.IComunicazione.sOGGETTO]]
return this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(n,0),e.col(n,1)),this.tabResult.css({h:180}),this.tabResult.onSelectionChanged(function(t){i.onSelect()}),this.tabList=new WUX.WDXTable(this.subId("tbv"),["Prog.","Cognome","Nome","Telefono"],[t.ICliente.sREPUTAZIONE,t.ICliente.sCOGNOME,t.ICliente.sNOME,t.ICliente.sTELEFONO1]),this.tabList.selectionMode="single",this.tabList.css({h:250}),this.btnRemOne=new WUX.WButton(this.subId("bro"),t.TXT.REMOVE,"",WUX.BTN.SM_DANGER),this.btnRemOne.on("click",function(n){var a=e.getItem(i.tabResult.getSelectedRowsData(),0)
if(a){var s=e.getNumber(a,t.ICollaboratore.sID)
if(!s)return void WUX.showWarning("Comunicazione non selezionata.")
var o=i.tabList.getSelectedRows(),r=i.tabList.getSelectedRowsData()
if(!r||!r.length)return void WUX.showWarning("Selezionare il cliente da rimuovere dalla lista di comunicazione")
var l=e.getNumber(r[0],"id")
if(!l)return void WUX.showWarning("Riferimento al cliente assente")
jrpc.execute("COMUNICAZIONI.remove",[s,l],function(t){if(!t)return void WUX.showWarning("Cliente NON rimosso dalla lista di comunicazione.")
WUX.showSuccess("Cliente rimosso dalla lista di comunicazione.")
var e=i.tabList.getState()
e.splice(o[0],1),i.tabList.setState(e)})}}),this.btnRemAll=new WUX.WButton(this.subId("bra"),t.TXT.REMOVE_ALL,"",WUX.BTN.SM_DANGER),this.btnRemAll.on("click",function(n){var a=e.getItem(i.tabResult.getSelectedRowsData(),0)
if(a){var s=e.getNumber(a,t.ICollaboratore.sID)
if(!s)return void WUX.showWarning("Comunicazione non selezionata.")
WUX.confirm("Si vuole eliminare tutta la lista di comunicazione?",function(t){t&&jrpc.execute("COMUNICAZIONI.removeAll",[s],function(t){if(!t)return void WUX.showWarning("Lista di comunicazione non aggiornata.")
WUX.showSuccess("Lista di comunicazione svuotata."),i.tabList.setState([])})})}}),this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew),this.tcoDetail=new WUX.WTab("tcod"),this.tcoDetail.addTab("Comunicazione",WUX.WIcon.ADDRESS_CARD).addRow().addCol("12",{h:300}).add(this.fpDetail),this.tcoDetail.addTab("Lista clienti",WUX.WIcon.USERS).addRow().addCol("11",{h:300}).add(this.tabList).addCol("1",{h:300}).addStack(WUX.CSS.STACK_BTNS,this.btnRemOne,this.btnRemAll),this.tcoDetail.on("statechange",function(t){switch(i.tcoDetail.getState()){case 0:break
case 1:i.tabList.repaint()}}),this.tagsFilter=new WUX.WTags("tf"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").section("Dettaglio").add(this.tcoDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.onSelect=function(){var i=this,n=e.getItem(this.tabResult.getSelectedRowsData(),0)
if(n){var a=e.getNumber(n,t.IComunicazione.sID)
a&&(this.fpDetail.clear(),this.fpDetail.setState(n),this.status==this.iSTATUS_EDITING&&(WUX.showWarning("Modifiche annullate"),this.fpDetail.enabled=!1),jrpc.execute("COMUNICAZIONI.read",[a],function(n){i.fpDetail.setState(n),i.tabList.setState(e.getArray(n,t.IComunicazione.sCODA)),i.status=i.iSTATUS_VIEW}))}},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUIComunicazioni=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(t){function i(i){var n=t.call(this,i,"DlgDataCal")||this
return n.title="Calendario",n.cal=new WUX.WDXCalendar(n.subId("cal")),n.cal.on("statechange",function(t){var i=n.cal.getState()
e.isSameDate(i,n.state)||setTimeout(function(){n.btnOK&&n.btnOK.trigger("click")},100)}),n.cal.style="margin:auto;",n.body.addRow().addCol("12",{a:"center"}).add(n.cal),n}return __extends(i,t),i.prototype.updateState=function(e){t.prototype.updateState.call(this,e),this.cal.setState(this.state)},i.prototype.getState=function(){if(this.cal){var t=this.cal.getState()
t&&(this.state=t)}return this.state},i.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this)
var e=this.cal.getRoot().width()
e<400&&(e=400),this.cntMain.css({w:e})},i}(WUX.WDialog)
t.DlgDataCal=i
var n=function(t){function e(e){var i=t.call(this,e,"DlgSMSText")||this
return i.title="Testo SMS",i.tarea=new WUX.WTextArea(i.subId("ta"),5),i.body.addRow().addCol("12",{a:"center"}).add(i.tarea),i}return __extends(e,t),e.prototype.updateState=function(e){t.prototype.updateState.call(this,e),this.tarea&&this.tarea.setState(this.state)},e.prototype.getState=function(){return this.tarea&&(this.state=this.tarea.getState()),this.state},e.prototype.onClickOk=function(){var t=this.tarea.getState()
return t?(t=t.trim(),t.length<2?(WUX.showWarning("Testo non significativo."),!1):!(t.length>160)||(WUX.showWarning("Il testo supera 160 caratteri."),!1)):(WUX.showWarning("Testo del messaggio non valido."),!1)},e.prototype.onShown=function(){this.tarea.focus()},e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this),this.tarea&&this.tarea.setState(this.state),this.cntMain.css({w:400})},e}(WUX.WDialog)
t.DlgSMSText=n
var a=function(t){function e(e){var i=t.call(this,e,"DlgCheckDesk")||this
return i.title="Controllo Desk",i.inp=new WUX.WInput(i.subId("icud"),WUX.WInputType.Password),i.inp.css({w:"100%"}),i.inp.onEnterPressed(function(t){i.onClickOk()&&(i.ok=!0,i.cancel=!1,i.root.modal("hide"))}),i.body.addRow().addCol("12").add(i.inp),i}return __extends(e,t),e.prototype.updateState=function(e){t.prototype.updateState.call(this,e),this.inp&&this.inp.setState(this.state)},e.prototype.getState=function(){return this.inp&&(this.state=this.inp.getState()),this.state},e.prototype.onClickOk=function(){return!!this.inp.getState()||(WUX.showWarning("Password non valida."),!1)},e.prototype.onShown=function(){this.inp.setState(""),this.inp.focus()},e.prototype.componentDidMount=function(){t.prototype.componentDidMount.call(this),this.inp&&this.inp.setState(this.state),this.cntMain.css({w:400})},e}(WUX.WDialog)
t.DlgCheckDesk=a
var s=function(i){function n(n){var a=i.call(this,n,"DlgAppPag")||this
a.title="Registrazione pagamento"
var s=[["Trattamento",t.IPrenotazione.sDESC_PREST,"s"],["Collaboratore",t.IPrenotazione.sDESC_COLL,"s"],["Note",t.IPrenotazione.sNOTE,"s"],["Causale",t.IPrenotazione.sCAUSALE,"s"],["Coupon",t.IPrenotazione.sCOD_COUPON,"s"],["Pagato",t.IPrenotazione.sPAGATO,"b"],["Prezzo",t.IPrenotazione.sPREZZO_FINALE,"c"]]
a.table=new WUX.WDXTable(a.subId("tap"),e.col(s,0),e.col(s,1)),a.table.selectionMode="multiple",a.table.types=e.col(s,2),a.table.css({h:200,f:10}),a.table.onSelectionChanged(function(i){var n=a.table.getSelectedRowsData()
n||(n=[])
for(var s=0,o="",r=0;r<n.length;r++){s+=e.getNumber(n[r],t.IPrenotazione.sPREZZO_FINALE)
var l=e.getString(n[r],t.IPrenotazione.sCOD_COUPON)
l&&(o+=o?","+l:l)}a.fp.setValue(t.IPrenotazione.sPREZZO_FINALE,s),a.impPag?a.fp.isBlank(t.IPrenotazione.sIMP_PAGATO)?a.fp.setValue(t.IPrenotazione.sIMP_PAGATO,s):a.fp.setValue(t.IPrenotazione.sIMP_PAGATO,a.impPag):a.fp.setValue(t.IPrenotazione.sIMP_PAGATO,s),o&&a.fp.setValue(t.IPrenotazione.sCOD_COUPON,o),setTimeout(function(){a.fp.focusOn(t.IPrenotazione.sIMP_PAGATO)},200)}),a.selPag=new t.CFSelectAppTipoPag
var o=new WUX.WLabel("")
return o.css({f:14,fw:"bold",d:"block",pt:8,pb:8},WUX.CSS.LABEL_NOTICE),a.fp=new WUX.WFormPanel(a.subId("fp")),a.fp.addRow(),a.fp.addComponent(t.IPrenotazione.sNOTE_CLIENTE,"Note cliente",o),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sCOD_COUPON,"Codici Coupon <small>(separare con spazio o virgola)</small>"),a.fp.addComponent(t.IPrenotazione.sTIPO_PAG,"Tipo pagamento",a.selPag),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sCAUSALE,"Causale"),a.fp.addCurrencyField(t.IPrenotazione.sPREZZO_FINALE,"Totale &euro;",!0),a.fp.addCurrencyField(t.IPrenotazione.sIMP_PAGATO,"Pagato &euro;"),a.fp.setSpanField(t.IPrenotazione.sCAUSALE,2),a.fp.setMandatory(t.IPrenotazione.sTIPO_PAG,t.IPrenotazione.sIMP_PAGATO),a.fp.onEnterPressed(function(i){if(i.data==t.IPrenotazione.sCOD_COUPON)if(a.fp.isBlank(t.IPrenotazione.sCOD_COUPON)){var n=a.table.getSelectedRowsData()
n||(n=[])
for(var s="",o=0;o<n.length;o++){var r=e.getString(n[o],t.IPrenotazione.sCOD_COUPON)
r&&(s+=s?","+r:r)}s?(a.fp.setValue(t.IPrenotazione.sCOD_COUPON,s),a.fp.setValue(t.IPrenotazione.sTIPO_PAG,"CPN"),a.fp.focusOn(t.IPrenotazione.sIMP_PAGATO)):a.fp.focusOn(t.IPrenotazione.sTIPO_PAG)}else a.fp.setValue(t.IPrenotazione.sTIPO_PAG,"CPN"),a.fp.focusOn(t.IPrenotazione.sIMP_PAGATO)
if(a.fp.isBlank(t.IPrenotazione.sIMP_PAGATO)){var n=a.table.getSelectedRowsData()
n||(n=[])
for(var l=0,o=0;o<n.length;o++)l+=e.getNumber(n[o],t.IPrenotazione.sPREZZO_FINALE)
a.fp.setValue(t.IPrenotazione.sIMP_PAGATO,l),a.impPag=0}}),a.body.addRow().addCol("12").section("Appuntamenti da pagare").add(a.table).addRow().addCol("12").add(a.fp),a}return __extends(n,i),n.prototype.onShown=function(){var e=this
this.selPag.getState()||this.selPag.setState("CON"),setTimeout(function(){e.table.repaint(),e.table.selectAll(),e.fp.focusOn(t.IPrenotazione.sIMP_PAGATO)},200)},n.prototype.updateProps=function(t){i.prototype.updateProps.call(this,t),this.table&&this.table.setState(this.props)},n.prototype.getProps=function(){return this.table&&(this.props=this.table.getSelectedRowsData()),this.props},n.prototype.updateState=function(n){i.prototype.updateState.call(this,n),this.impPag=e.getNumber(this.state,t.IPrenotazione.sIMP_PAGATO),this.fp&&(this.fp.setValue(t.IPrenotazione.sPREZZO_FINALE,this.impPag),this.fp.setValue(t.IPrenotazione.sIMP_PAGATO,this.impPag),this.fp.setValue(t.IPrenotazione.sCOD_COUPON,e.getString(this.state,t.IPrenotazione.sCOD_COUPON)),this.fp.setValue(t.IPrenotazione.sTIPO_PAG,e.getString(this.state,t.IPrenotazione.sTIPO_PAG)),this.fp.setValue(t.IPrenotazione.sNOTE_CLIENTE,e.getString(this.state,t.IPrenotazione.sNOTE_CLIENTE)),this.fp.setValue(t.IPrenotazione.sCAUSALE,e.getString(this.state,t.IPrenotazione.sCAUSALE)))},n.prototype.getState=function(){return this.state={},this.selPag&&(this.state[t.IPrenotazione.sTIPO_PAG]=e.toString(this.selPag.getState())),this.fp&&(this.state[t.IPrenotazione.sCOD_COUPON]=e.toString(this.fp.getValue(t.IPrenotazione.sCOD_COUPON)),this.state[t.IPrenotazione.sIMP_PAGATO]=e.toNumber(this.fp.getValue(t.IPrenotazione.sIMP_PAGATO)),this.state[t.IPrenotazione.sCAUSALE]=e.toString(this.fp.getValue(t.IPrenotazione.sCAUSALE))),this.state},n.prototype.onClickOk=function(){var i=this.fp.checkMandatory(!0)
if(i)return WUX.showWarning("Specificare: "+i),!1
var n=this.fp.getValues()
if(!e.getNumber(n,t.IPrenotazione.sIMP_PAGATO)&&!e.getString(n,t.IPrenotazione.sCAUSALE))return WUX.showWarning("Con pagato 0 riportare una causale"),this.fp.focusOn(t.IPrenotazione.sCAUSALE),!1
return!0},n}(WUX.WDialog)
t.DlgAppPag=s
var o=function(i){function n(n){var a=i.call(this,n,"DlgPrenotazione",!1,!1)||this
a.title="Appuntamento",a.idFar=0,a.idPren=0,a.idCliente=0,a.dataPren=null,a.refPlan=!1,a._sdate=!1,a._idcol=0,a._efind=!1
var o=t.isBookOper()
a.dlgCAtt=new f(a.subId("dca")),a.dlgCAtt.onHiddenModal(function(i){if(a.dlgCAtt.ok){var n=a.dlgCAtt.getProps()
if(!n)return void WUX.showWarning("Nessuna cabina selezionata")
var s=a.fp.getValues()
s[t.IPrenotazione.sDATA_APP]=e.toDate(s[t.IPrenotazione.sDATA_APP]),s[t.IPrenotazione.sDATA_PREN]=e.toDate(s[t.IPrenotazione.sDATA_PREN]),t.chkExecute("PRENOTAZIONI.changeAttr",[s,n.id],function(e){e?(WUX.showSuccess("Cambio cabina avvenuto con successo."),a.fp.setValue(t.IPrenotazione.sID_ATTR,n.id),a.fp.setValue(t.IPrenotazione.sDESC_ATTR,n.text)):WUX.showWarning("Cambio cabina NON avvenuto.")})}}),a.dlgCPre=new S(a.subId("dcp")),a.dlgCPre.onHiddenModal(function(i){if(a.dlgCPre.ok){var n=a.dlgCPre.getProps()
if(!n)return void WUX.showWarning("Nessuna prestazione selezionata")
var s=a.fp.getValues()
s[t.IPrenotazione.sDATA_APP]=e.toDate(s[t.IPrenotazione.sDATA_APP]),s[t.IPrenotazione.sDATA_PREN]=e.toDate(s[t.IPrenotazione.sDATA_PREN]),t.chkExecute("PRENOTAZIONI.changePrest",[s,n.id],function(e){e?(WUX.showSuccess("Cambio trattamento avvenuto con successo."),a.fp.setValue(t.IPrenotazione.sID_PREST,n.id),a.fp.setValue(t.IPrenotazione.sDESC_PREST,n.text),n.value&&a.fp.setValue(t.IPrenotazione.sPREZZO_FINALE,WUX.formatCurr(n.value)),a.refPlan=!0):WUX.showWarning("Cambio trattamento NON avvenuto.")})}}),a.dlgSApp=new p(a.subId("dsa")),a.dlgPApp=new s(a.subId("dpa")),a.dlgPApp.onHiddenModal(function(i){if(a.dlgPApp.ok){var n=a.dlgPApp.getProps()
if(!n||!n.length)return void WUX.showWarning("Nessuna prenotazione selezionata")
for(var s=[],o=0;o<n.length;o++)s.push(e.getNumber(n[o],t.IPrenotazione.sID))
var r=a.dlgPApp.getState()
r||WUX.showWarning("Dati pagamenti non disponibili.")
var l=e.getString(r,t.IPrenotazione.sTIPO_PAG)
if(!l)return void WUX.showWarning("Tipo pagamento non specificato.")
var d=e.getNumber(r,t.IPrenotazione.sIMP_PAGATO),c=e.getString(r,t.IPrenotazione.sCOD_COUPON),u=e.getString(r,t.IPrenotazione.sCAUSALE)
jrpc.execute("PRENOTAZIONI.updatePag",[s,l,d,c,u],function(e){e?(WUX.showSuccess("Pagamento registrato con successo."),a.fp.setValue(t.IPrenotazione.sTIPO_PAG,l),a.fp.setValue(t.IPrenotazione.sIMP_PAGATO,d),a.fp.setValue(t.IPrenotazione.sCOD_COUPON,c),a.fp.setValue(t.IPrenotazione.sCAUSALE,u)):WUX.showWarning("Pagamento NON registrato.")})}}),a.selOra=new t.CFSelectOrario,a.selCol=new t.CFSelectCollab,a.selCol.on("statechange",function(t){if(a.selCol.count&&a._efind){var i=e.toNumber(a.selCol.getState())
console.log("selCol statechange _idcol="+a._idcol+",idColl="+i),a._idcol&&i!=a._idcol&&a.doFind()}}),a.selTip=new t.CFSelectTipoApp,a.selTip.on("statechange",function(e){if(a.isShown){a.selTip.getState()||setTimeout(function(){a.selTip.close()},100),WUX.showWarning("Riportare eventualmente una nota e premere invio per aggiornare."),setTimeout(function(){a.fp.focusOn(t.IPrenotazione.sNOTE)},100)}}),a.btnSrc=new WUX.WButton(a.subId("btc"),"Cerca",t.ICO.FIND,WUX.BTN.SECONDARY),a.btnSrc.tooltip="Cerca appuntamenti disponibili",a.btnSrc.on("click",function(t){a.doFind()}),o||(a.btnRic=new WUX.WButton(a.subId("btr"),"Ricolloca",t.ICO.TOOL,WUX.BTN.PRIMARY),a.btnRic.on("click",function(i){WUX.confirm("Si vuole ricollocare l'appuntamento?",function(i){if(i){var n=a.fp.getValues()
n[t.IPrenotazione.sDATA_APP]=e.toDate(n[t.IPrenotazione.sDATA_APP]),n[t.IPrenotazione.sDATA_PREN]=e.toDate(n[t.IPrenotazione.sDATA_PREN]),t.chkExecute("PRENOTAZIONI.relocate",[n],function(i){if(!i)return void WUX.showWarning("Ricollocazione appuntamento NON eseguita.")
var n=e.getString(i,t.IPrenotazione.sMESSAGGIO)
if(n)return void WUX.showWarning(n)
a.idPren=e.getNumber(i,t.IPrenotazione.sID),a.dataPren=e.getDate(i,t.IPrenotazione.sDATA_APP),WUX.showSuccess("Ricollocazione eseguita con successo."),a.ok=!0,a.cancel=!1,a.root.modal("hide")})}})})),a.btnMov=new WUX.WButton(a.subId("bts"),"Sposta",t.ICO.CALENDAR,WUX.BTN.INFO),a.btnMov.tooltip="Sposta appuntamento",a.btnMov.on("click",function(i){if(a.fp.isBlank(t.IPrenotazione.sCAMBIO_DATA)&&a.fp.isBlank(t.IPrenotazione.sCAMBIO_ORA))a.doFind()
else{if(a.fp.isBlank(t.IPrenotazione.sCAMBIO_DATA)){var n=e.toString(a.fp.getValue(t.IPrenotazione.sDATA_APP))
if(!n)return void WUX.showWarning("Selezionare la data del nuovo appuntamento.")
var s=n.indexOf(",")
s>=0&&(n=n.substring(s+1).trim()),a.fp.setValue(t.IPrenotazione.sCAMBIO_DATA,n)}if(a.fp.isBlank(t.IPrenotazione.sCAMBIO_ORA))return WUX.showWarning("Selezionare l'ora del nuovo appuntamento."),void a.fp.focusOn(t.IPrenotazione.sCAMBIO_ORA)
WUX.confirm("Si vuole spostare l'appuntamento?",function(i){if(i){var n=a.fp.getValues()
n[t.IPrenotazione.sDATA_APP]=e.toDate(n[t.IPrenotazione.sDATA_APP]),n[t.IPrenotazione.sDATA_PREN]=e.toDate(n[t.IPrenotazione.sDATA_PREN]),a.idFar&&(n[t.IPrenotazione.sID_FAR]=a.idFar),t.chkExecute("PRENOTAZIONI.move",[n],function(i){if(!i)return void WUX.showWarning("Spostamento della prenotazione NON eseguito.")
var n=e.getString(i,t.IPrenotazione.sMESSAGGIO)
if(n)return void WUX.showWarning(n)
a.idPren=e.getNumber(i,t.IPrenotazione.sID),a.dataPren=e.getDate(i,t.IPrenotazione.sDATA_APP),WUX.showSuccess("Spostamento eseguito con successo."),a.ok=!0,a.cancel=!1,a.root.modal("hide")})}})}}),a.btnRev=new WUX.WButton(a.subId("btd"),"Disdici",t.ICO.DELETE,WUX.BTN.DANGER),a.btnRev.tooltip="Annulla appuntamento",a.btnRev.on("click",function(i){var n=a.fp.getValues()
n[t.IPrenotazione.sDATA_APP]=e.toDate(n[t.IPrenotazione.sDATA_APP]),t.chkExecute("PRENOTAZIONI.revoke",[n],function(i){if(!i)return void WUX.showWarning("Annullamento della prenotazione non eseguito.")
var n=e.getString(i,t.IPrenotazione.sMESSAGGIO)
if(n)return void WUX.showWarning(n)
a.idPren=0,WUX.showSuccess("Prenotazione annullata con successo."),a.ok=!0,a.cancel=!1,a.root.modal("hide")})}),a.btnAbs=new WUX.WButton(a.subId("btn"),"Non Pres.",t.ICO.CANCEL,WUX.BTN.WARNING),a.btnAbs.tooltip="Registra non presentato",a.btnAbs.on("click",function(i){var n=a.fp.getValues()
n[t.IPrenotazione.sDATA_APP]=e.toDate(n[t.IPrenotazione.sDATA_APP]),n[t.IPrenotazione.sSTATO]="N",jrpc.execute("PRENOTAZIONI.update",[n],function(i){if(!i)return void WUX.showWarning("Aggiornamento della prenotazione non eseguito.")
var n=e.getString(i,t.IPrenotazione.sMESSAGGIO)
if(n)return void WUX.showWarning(n)
WUX.showSuccess("Aggiornamento eseguito con successo."),a.ok=!0,a.cancel=!1,a.root.modal("hide")})}),a.btnPag=new WUX.WButton(a.subId("btp"),"Pagam.",t.ICO.OK,WUX.BTN.SUCCESS),a.btnPag.tooltip="Registra pagamento",a.btnPag.on("click",function(i){return a.idCliente?a.idFar?a.dataPren?void jrpc.execute("PRENOTAZIONI.history",[a.idCliente,a.idFar,a.dataPren],function(i){if(!i||!i.length)return void WUX.showWarning("Appuntamenti da pagare non disponibili")
if(a.idPren){var n=e.find(i,t.IPrenotazione.sID,a.idPren)
if(e.getBoolean(n,t.IPrenotazione.sPAGATO))return void WUX.showWarning("Prenotazione pagata.")}var s={}
s[t.IPrenotazione.sTIPO_PAG]=e.toString(a.fp.getValue(t.IPrenotazione.sTIPO_PAG)),s[t.IPrenotazione.sIMP_PAGATO]=e.toNumber(a.fp.getValue(t.IPrenotazione.sIMP_PAGATO)),s[t.IPrenotazione.sCOD_COUPON]=e.toString(a.fp.getValue(t.IPrenotazione.sCOD_COUPON)),s[t.IPrenotazione.sNOTE_CLIENTE]=e.toString(a.fp.getValue(t.IPrenotazione.sNOTE_CLIENTE)),s[t.IPrenotazione.sCAUSALE]=e.toString(a.fp.getValue(t.IPrenotazione.sCAUSALE)),a.dlgPApp.setProps(i),a.dlgPApp.setState(s),a.dlgPApp.show(a)}):void WUX.showWarning("Data appuntamento non disponibile"):void WUX.showWarning("Riferimento alla struttura assente"):void WUX.showWarning("Riferimento al cliente assente")}),a.buttons||(a.buttons=[]),a.buttons.push(a.btnSrc),o||a.buttons.push(a.btnRic),a.buttons.push(a.btnMov),a.buttons.push(a.btnRev),a.buttons.push(a.btnPag),a.buttons.push(a.btnAbs)
var r=new WUX.WLabel("")
r.css({f:14,fw:"bold",d:"block",pt:8,pb:8},WUX.CSS.LABEL_INFO)
var l=new WUX.WLabel("")
return l.css({f:14,fw:"bold",d:"block",pt:8,pb:8},WUX.CSS.LABEL_NOTICE),a.chkOvr=new WUX.WCheck("","Ignora controlli"),a.chkMat=new WUX.WCheck("","fino alle 14:00"),a.chkPom=new WUX.WCheck("","dalle 14:00"),a.fp=new WUX.WFormPanel(a.subId("fp")),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sDESC_CLIENTE,"Cliente",!0),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sTELEFONO1,"Telefono",!0),a.fp.addComponent(t.IPrenotazione.sID_FAR,"Struttura",new t.CFSelectStruture,!0),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sDATA_APP,"Data Appuntamento",!0),a.fp.addDateField(t.IPrenotazione.sCAMBIO_DATA,"Cambio data"),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sORA_APP,"Dalle ore",!0),a.fp.addTextField(t.IPrenotazione.sORA_FINE,"alle ore",!0),a.fp.addComponent(t.IPrenotazione.sCAMBIO_ORA,"Cambio ora",a.selOra),o?a.fp.addBlankField():a.fp.addComponent(t.IPrenotazione.sOVERBOOKING,"Forzatura",a.chkOvr.getWrapper({mt:4})),a.fp.addRow(),a.fp.addComponent(t.IPrenotazione.sDESC_PREST,"Trattamento",r),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sDESC_COLL,"Collaboratore",!0),a.fp.addComponent(t.IPrenotazione.sCAMBIO_ID_COLL,"Cambio Coll.",a.selCol),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sDESC_ATTR,"Cabina",!0),a.fp.addComponent(t.IPrenotazione.sMATTINO,"Mattino",a.chkMat.getWrapper({mt:4})),a.fp.addComponent(t.IPrenotazione.sPOMERIGGIO,"Pomeriggio",a.chkPom.getWrapper({mt:4})),a.fp.addRow(),a.fp.addIntegerField(t.IPrenotazione.sDURATA,"Durata"),a.fp.addTextField(t.IPrenotazione.sPREZZO_FINALE,"Importo",!0),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sDATA_PREN,"Prenotato il",!0),a.fp.addComponent(t.IPrenotazione.sTIPO,"Tipo",a.selTip),a.fp.addRow(),a.fp.addComponent(t.IPrenotazione.sNOTE_CLIENTE,"Note Cliente",l),a.fp.addRow(),a.fp.addTextField(t.IPrenotazione.sNOTE,"Note Prenotazione (premere invio per aggiornarle)"),a.fp.addInternalField(t.IPrenotazione.sID),a.fp.addInternalField(t.IPrenotazione.sID_CLIENTE),a.fp.addInternalField(t.IPrenotazione.sID_COLL),a.fp.addInternalField(t.IPrenotazione.sID_ATTR),a.fp.addInternalField(t.IPrenotazione.sID_PREST),a.fp.addInternalField(t.IPrenotazione.sSTATO),a.fp.addInternalField(t.IPrenotazione.sTIPO_PAG),a.fp.addInternalField(t.IPrenotazione.sIMP_PAGATO),a.fp.addInternalField(t.IPrenotazione.sCOD_COUPON),a.fp.addInternalField(t.IPrenotazione.sCAUSALE),o&&a.fp.addInternalField(t.IPrenotazione.sOVERBOOKING),a.fp.setSpanField(t.IPrenotazione.sDESC_ATTR,2),a.lnkSApp=new WUX.WLink(a.subId("lsa"),"Storico",WUX.WIcon.FOLDER_OPEN_O),a.lnkSApp.on("click",function(i){var n=e.toNumber(a.fp.getValue(t.IPrenotazione.sID_CLIENTE))
n&&jrpc.execute("CLIENTI.read",[n],function(i){if(!i)return void WUX.showWarning("Dati cliente "+n+" non disponibili.")
a.dlgSApp.setState(e.getArray(i,t.ICliente.sPRENOTAZIONI)),a.dlgSApp.show(a)})}),a.fp.setLabelLinks(t.IPrenotazione.sDESC_CLIENTE,[a.lnkSApp]),a.lnkCPre=new WUX.WLink(a.subId("lcp"),"Cambio",WUX.WIcon.RECYCLE),a.lnkCPre.on("click",function(i){var n=a.fp.getValues(),s=e.getNumber(n,t.IPrenotazione.sID_FAR),o=e.getNumber(n,t.IPrenotazione.sID_COLL)
jrpc.execute("PRESTAZIONI.getAll",[s,o],function(i){a.dlgCPre.setState(i),a.dlgCPre.durata=e.getNumber(n,t.IPrenotazione.sDURATA),a.dlgCPre.show(a)})}),a.fp.setLabelLinks(t.IPrenotazione.sDESC_PREST,[a.lnkCPre]),a.lnkCAtt=new WUX.WLink(a.subId("lcc"),"Cambio",WUX.WIcon.RECYCLE),a.lnkCAtt.on("click",function(i){var n=a.fp.getValues()
n[t.IPrenotazione.sDATA_APP]=e.toDate(n[t.IPrenotazione.sDATA_APP]),n[t.IPrenotazione.sDATA_PREN]=e.toDate(n[t.IPrenotazione.sDATA_PREN]),jrpc.execute("ATTREZZATURE.getCollegate",[n],function(i){a.dlgCAtt.setProps({id:e.getNumber(n,t.IPrenotazione.sID_ATTR)}),a.dlgCAtt.setState(i),a.dlgCAtt.show(a)})}),a.fp.setLabelLinks(t.IPrenotazione.sDESC_ATTR,[a.lnkCAtt]),a.fp.onEnterPressed(function(i){if(i.data==t.IPrenotazione.sNOTE){var n=a.fp.getValues()
n[t.IPrenotazione.sDATA_APP]=e.toDate(n[t.IPrenotazione.sDATA_APP]),n[t.IPrenotazione.sSTATO]="",n[t.IPrenotazione.sTIPO]=a.fp.getValue(t.IPrenotazione.sTIPO),jrpc.execute("PRENOTAZIONI.update",[n],function(i){if(!i)return void WUX.showWarning("Aggiornamento prenotazione NON eseguito.")
var n=e.getString(i,t.IPrenotazione.sMESSAGGIO)
if(n)return void WUX.showWarning(n)
WUX.showSuccess("Aggiornamento prenotazione eseguito con successo."),a.ok=!0,a.cancel=!1,a.root.modal("hide")})}}),a.lnkPrev=new WUX.WLink(a.subId("lnkp"),"",t.ICO.LEFT),a.lnkPrev.tooltip="Data precedente",a.lnkPrev.on("click",function(i){a._efind=!1
var n=e.toDate(a.fp.getValue(t.IPrenotazione.sCAMBIO_DATA))
return n?a._idcol?void a.doFind(null,n):void WUX.showWarning("Interrogare le disponibilit&agrave;."):void WUX.showWarning("Data non selezionata.")}),a.lnkNext=new WUX.WLink(a.subId("lnkn"),"",t.ICO.RIGHT),a.lnkNext.tooltip="Data successiva",a.lnkNext.on("click",function(i){a._efind=!1
var n=e.toDate(a.fp.getValue(t.IPrenotazione.sCAMBIO_DATA))
return n?a._idcol?(n.setDate(n.getDate()+1),void a.doFind(n)):void WUX.showWarning("Interrogare le disponibilit&agrave;."):void WUX.showWarning("Data non selezionata.")}),a.fp.setLabelLinks(t.IPrenotazione.sCAMBIO_DATA,[a.lnkPrev,a.lnkNext]),a.fp.onChangeDate(function(e){if(WUX.lastSub($(e.target))==t.IPrenotazione.sCAMBIO_DATA){if(a._sdate)return void(a._sdate=!1)
if(a.fp.isBlank(t.IPrenotazione.sCAMBIO_DATA))return
if(!a._efind)return
a.doFind()}}),a.body.addRow().addCol("12").add(a.fp),a}return __extends(n,i),n.prototype.doFind=function(i,n){var a=this
console.log("doFind fromDate="+WUX.formatDate(i)+",toDate="+WUX.formatDate(n)),this._efind=!1
var s=this.fp.getValues()
return s[t.IPrenotazione.sPREFERENZE]="",s[t.IPrenotazione.sMATTINO]&&!s[t.IPrenotazione.sPOMERIGGIO]?s[t.IPrenotazione.sPREFERENZE]="M":!s[t.IPrenotazione.sMATTINO]&&s[t.IPrenotazione.sPOMERIGGIO]&&(s[t.IPrenotazione.sPREFERENZE]="P"),s[t.IPrenotazione.sID_COLL]=this.fp.getValue(t.IPrenotazione.sCAMBIO_ID_COLL),delete s[t.IPrenotazione.sDATA_APP],delete s[t.IPrenotazione.sCAMBIO_DATA],i?s[t.IPrenotazione.sCAMBIO_DAL]=i:n?s[t.IPrenotazione.sCAMBIO_AL]=n:this.fp.isBlank(t.IPrenotazione.sCAMBIO_DATA)?s[t.IPrenotazione.sCAMBIO_DAL]=e.toDate(this.fp.getValue(t.IPrenotazione.sDATA_APP)):(s[t.IPrenotazione.sCAMBIO_DATA]=e.toDate(this.fp.getValue(t.IPrenotazione.sCAMBIO_DATA)),s[t.IPrenotazione.sCAMBIO_DAL]=null),s[t.IPrenotazione.sPREN_ONLINE]=!1,this.idFar&&(s[t.IPrenotazione.sID_FAR]=this.idFar),jrpc.execute("CALENDARIO.getAvailabilities",[s],function(e){var i=[]
if(!e||!e.length)return a._idcol=-1,a.fp.setValue(t.IPrenotazione.sCAMBIO_ORA,null),a.selOra.setAllSlots(),WUX.showWarning("Non vi sono appuntamenti disponibili."),void(a._efind=!0)
var n=e[0]
n.data&&(WUX.showSuccess("Primo appuntamento disponibile:<br><strong>"+WUX.formatDate(n.data,!0)+"</strong> alle ore <strong>"+WUX.formatTime(n.oraInizio)+"</strong><br>con <strong>"+n.nomeCollab+"</strong>"),a._sdate=!0,a.fp.setValue(t.IPrenotazione.sCAMBIO_DATA,n.data),a.fp.setValue(t.IPrenotazione.sCAMBIO_ORA,n.oraInizio),a._idcol=n.idCollaboratore,a.fp.setValue(t.IPrenotazione.sCAMBIO_ID_COLL,a._idcol))
for(var s=0;s<e.length;s++){var o=e[s].oraInizio
i.indexOf(o)<0&&i.push(o)}i.sort(function(t,e){return t-e}),a.selOra.setAppts(i),a._efind=!0}),this},n.prototype.updateState=function(n){var a=this
i.prototype.updateState.call(this,n)
var s=e.getBoolean(this.state,t.IPrenotazione.sCHECK_USER_DESK)
s&&(t.CFBookCfg.CHECK_USER_DESK=s),this.idFar=e.getNumber(this.state,t.IPrenotazione.sID_FAR),this.idPren=e.getNumber(this.state,t.IPrenotazione.sID),this.idCliente=e.getNumber(this.state,t.IPrenotazione.sID_CLIENTE),this.dataPren=e.getDate(this.state,t.IPrenotazione.sDATA_APP),this.oraPren=this.state?e.toIntTime(this.state[t.IPrenotazione.sORA_APP]):0,this.refPlan=!1,this._sdate=!1,this._idcol=0,this._efind=!1,this.selOra&&this.selOra.setAllSlots(),this.fp&&(this.fp.clear(),delete this.state[t.IPrenotazione.sCAMBIO_ID_COLL],this.fp.setState(this.state),this._idcol=e.getNumber(this.state,t.IPrenotazione.sID_COLL),setTimeout(function(){a.selCol.setIdFar(a.idFar,a._idcol)},100))},n.prototype.getState=function(){return this.fp&&(this.state=this.fp.getState()),this.state},n.prototype.componentDidMount=function(){i.prototype.componentDidMount.call(this),this.cntMain.css({w:650})},n}(WUX.WDialog)
t.DlgPrenotazione=o
var r=function(i){function n(e){var n=i.call(this,e,"DlgOrariPers")||this
return n.title="Personalizza orari",n.cfOrariPers=new t.CFOrariPers(n.subId("op")),n.body.addRow().addCol("12").add(n.cfOrariPers),n}return __extends(n,i),n.prototype.updateState=function(i){if(this.state={},this.state[t.ICalendario.sORARI]=e.getObject(i,t.ICalendario.sORARI),this.cfOrariPers){var n=e.getDate(i,t.ICalendario.sDATA)
this.title=n?"Personalizza orari di "+WUX.formatDate(n,!0,!1):"Personalizza orari",this.cfOrariPers.resources=e.getArray(i,t.ICalendario.sRISORSE),this.cfOrariPers.setState(e.getObject(i,t.ICalendario.sORARI))}},n.prototype.getState=function(){return this.state||(this.state={}),this.cfOrariPers&&(this.state[t.ICalendario.sORARI]=this.cfOrariPers.getState()),this.state},n.prototype.refresh=function(){return this.cfOrariPers||this.cfOrariPers.refresh(),this},n.prototype.onShown=function(){this.cfOrariPers.refresh()},n}(WUX.WDialog)
t.DlgOrariPers=r
var l=function(t){function i(e){var i=t.call(this,e,"DlgAssenze")||this
return i.title="Assenze",i.fp=new WUX.WFormPanel(i.subId("fp")),i.fp.addRow(),i.fp.addDateField("ad","Dal"),i.fp.addDateField("aa","al"),i.fp.setMandatory("ad","aa"),i.body.addRow().addCol("12").add(i.fp),i}return __extends(i,t),i.prototype.getState=function(){return this.fp&&(this.state=[],this.state[0]=e.toDate(this.fp.getValue("ad")),this.state[1]=e.toDate(this.fp.getValue("aa"))),this.state},i.prototype.onShown=function(){this.fp.clear()},i.prototype.onClickOk=function(){var t=this.fp.checkMandatory(!0)
if(t)return WUX.showWarning("Specificare: "+t),!1
var i=e.toNumber(e.toDate(this.fp.getValue("ad")))
return!(e.toNumber(e.toDate(this.fp.getValue("aa")))<i&&(WUX.showWarning('Data "al" anteriore rispetto alla data "dal".'),1))},i}(WUX.WDialog)
t.DlgAssenze=l
var d=function(i){function n(e){var n=i.call(this,e,"DlgAgenda")||this
return n.title="Orario",n.cmpAgenda=new t.CFAgenda(n.subId("age")),n.fp=new WUX.WFormPanel(n.subId("fp")),n.fp.addRow(),n.fp.addDateField("iv","Inizio Validit&agrave;"),n.fp.addDateField("fv","Fine Validit&agrave;"),n.fp.addTextField("ds","Descrizione"),n.fp.addInternalField("id"),n.fp.setMandatory("iv"),n.body.addRow().addCol("12").add(n.fp).addRow().addCol("12",{a:"center"}).add(n.cmpAgenda),n}return __extends(n,i),n.prototype.getState=function(){if(this.cmpAgenda){var t=e.toDate(this.fp.getValue("iv"))
this.cmpAgenda.setDateRef(t),this.state=this.cmpAgenda.getState(),this.state&&(this.state.id=e.toNumber(this.fp.getValue("id")),this.state.inizioValidita=e.toDate(this.fp.getValue("iv")),this.state.fineValidita=e.toDate(this.fp.getValue("fv")),this.state.descrizione=e.toString(this.fp.getValue("ds")),this.state.descrizione||(this.state.descrizione="PIANO"))}return this.state},n.prototype.onClickOk=function(){var t=this,i=e.toDate(this.fp.getValue("iv"))
if(!i)return WUX.showWarning("Inizio Validit&agrave; non valida"),this.fp.focusOn("iv"),!1
var n=e.toNumber(new Date),a=e.toNumber(i)
if(a<=n)return WUX.showWarning("La variazione deve avere inizio validit&agrave; nel futuro."),this.fp.focusOn("iv"),!1
var s=e.toNumber(e.toDate(this.fp.getValue("fv")))
return s&&s<=a?(this.fp.focusOn("fv"),WUX.showWarning("La data di fine validit&agrave; deve essere posteriore a quella di inizio."),!1):!!this.conf||(!!this.cmpAgenda.isActivated()||(WUX.confirm("Settimana corrente non attiva. Proseguire?",function(e){e&&(t.conf=!0,t.btnOK.trigger("click"))}),!1))},n.prototype.onShown=function(){this.fp.clear(),this.cmpAgenda.clear(),this.conf=!1,this.state?(this.fp.setValue("iv",e.getDate(this.state,"inizioValidita")),this.fp.setValue("fv",e.getDate(this.state,"fineValidita")),this.fp.setValue("ds",e.getString(this.state,"descrizione")),this.fp.setValue("id",e.getNumber(this.state,"id")),this.cmpAgenda.setDateRef(e.getDate(this.state,"inizioValidita")),this.cmpAgenda.setState(this.state)):(this.fp.setValue("iv",e.getCurrDate(1)),this.fp.setValue("ds","PIANO"),this.fp.setValue("id",0),this.cmpAgenda.clear())},n.prototype.componentDidMount=function(){i.prototype.componentDidMount.call(this),$(window).width()>1260?this.cntMain.css({w:1260,h:600}):this.cntMain.css({w:1e3,h:600})},n}(WUX.WDialog)
t.DlgAgenda=d
var c=function(i){function n(e){var n=i.call(this,e,"DlgCliente")||this
return n.title="Cliente",n.fp=new WUX.WFormPanel(n.subId("fp")),n.fp.addRow(),n.fp.addTextField(t.ICliente.sCOGNOME,"Cognome"),n.fp.addRow(),n.fp.addTextField(t.ICliente.sNOME,"Nome"),n.fp.addRow(),n.fp.addTextField(t.ICliente.sTELEFONO1,"Telefono"),n.fp.addRow(),n.fp.addTextField(t.ICliente.sEMAIL,"Email"),n.fp.addRow(),n.fp.addOptionsField(t.ICliente.sSESSO,"Sesso",[{id:"",text:""},{id:"M",text:"Maschio"},{id:"F",text:"Femmina"}]),n.fp.addRow(),n.fp.addDateField(t.ICliente.sDATA_NASCITA,"Data di nascita"),n.fp.addRow(),n.fp.addTextField(t.ICliente.sNOTE,"Note"),n.fp.addInternalField(t.ICliente.sID),n.fp.setMandatory(t.ICliente.sCOGNOME,t.ICliente.sNOME,t.ICliente.sTELEFONO1),n.body.addRow().addCol("12").add(n.fp),n}return __extends(n,i),n.prototype.onShown=function(){var e=this
this.done=!1,this.fp.clear(),this.state&&this.fp.setState(this.state),setTimeout(function(){e.fp.focusOn(t.ICliente.sCOGNOME)},100)},n.prototype.onClickOk=function(){var i=this
if(this.done)return!0
var n=this.fp.checkMandatory(!0,!0)
if(n)return WUX.showWarning("Specificare i seguenti campi: "+n),!1
var a=this.fp.getValues(),s=e.getString(a,t.ICliente.sTELEFONO1)
if(!s||s.length<5)return WUX.showWarning("Numero di telefono non valido"),this.fp.focusOn(t.ICliente.sTELEFONO1),!1
if(a[t.ICliente.sID])jrpc.execute("CLIENTI.update",[a],function(t){if(!t)return void WUX.showWarning("Dati cliente non registrati.")
i.state=t,i.done=!0,i.btnOK.trigger("click"),WUX.showSuccess("Dati cliente registrati con successo.")})
else{var o=a[t.ICliente.sTELEFONO1]
o?jrpc.execute("CLIENTI.exists",[o],function(e){if(e&&e[t.ICliente.sCOGNOME]){var n=e[t.ICliente.sCOGNOME]+" "+e[t.ICliente.sNOME]+" ha il numero di telefono "+e[t.ICliente.sTELEFONO1]+". Proseguire?"
return void WUX.confirm(n,function(t){t&&jrpc.execute("CLIENTI.insert",[a],function(t){if(!t)return void WUX.showWarning("Dati cliente non registrati.")
i.state=t,i.done=!0,i.btnOK.trigger("click"),WUX.showSuccess("Cliente inserito con successo.")})})}jrpc.execute("CLIENTI.insert",[a],function(t){if(!t)return void WUX.showWarning("Dati cliente non registrati.")
i.state=t,i.done=!0,i.btnOK.trigger("click"),WUX.showSuccess("Cliente inserito con successo.")})}):jrpc.execute("CLIENTI.insert",[a],function(t){if(!t)return void WUX.showWarning("Dati cliente non registrati.")
i.state=t,i.done=!0,i.btnOK.trigger("click"),WUX.showSuccess("Cliente inserito con successo.")})}return!1},n.prototype.componentDidMount=function(){i.prototype.componentDidMount.call(this),this.cntMain.css({w:500})},n}(WUX.WDialog)
t.DlgCliente=c
var u=function(i){function n(n){var a=i.call(this,n,"DlgClienti")||this
a.title="Selezionare il cliente",a.fpFilter=new WUX.WFormPanel(a.subId("ff")),a.fpFilter.addRow(),a.fpFilter.addTextField(t.ICliente.sCOGNOME,"Cognome"),a.fpFilter.addTextField(t.ICliente.sNOME,"Nome"),a.fpFilter.addTextField(t.ICliente.sTELEFONO1,"Telefono"),a.fpFilter.addTextField(t.ICliente.sEMAIL,"Email"),a.btnFind=new WUX.WButton(a.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),a.btnFind.on("click",function(i){jrpc.execute("CLIENTI.find",[a.fpFilter.getState()],function(i){if(a.state=null,i){if(a.props){var n=e.indexOf(i,t.ICliente.sID,a.props)
n>=0&&i.splice(n,1)}a.tabResult.setState(i)}else a.tabResult.setState([])})}),a.btnReset=new WUX.WButton(a.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),a.btnReset.on("click",function(t){a.state=null,a.fpFilter.clear(),a.tabResult.setState([])})
var s=[["Cognome",t.ICliente.sCOGNOME,"s"],["Nome",t.ICliente.sNOME,"s"],["Telefono",t.ICliente.sTELEFONO1,"s"],["Email",t.ICliente.sEMAIL,"s"],["Sesso",t.ICliente.sSESSO,"s"],["Data Nascita",t.ICliente.sDATA_NASCITA,"d"]]
return a.tabResult=new WUX.WDXTable(a.subId("tr"),e.col(s,0),e.col(s,1)),a.tabResult.exportFile="clienti",a.tabResult.types=e.col(s,2),a.tabResult.css({h:200}),a.tabResult.widths=[100],a.body.addBox("Filtri di ricerca:","","","",WUX.ATT.BOX_FILTER).addRow().addCol("col-xs-11 b-r").add(a.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},a.btnFind,a.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},a.tabResult).end(),a}return __extends(n,i),n.prototype.onClickOk=function(){var t=this.tabResult.getSelectedRowsData()
return t&&t.length?(this.state=t[0],!0):(WUX.showWarning("Selezionare un cliente"),!1)},n.prototype.onShown=function(){var e=this
this.state=null,this.tabResult.scrollTo(0),this.tabResult.setState([]),setTimeout(function(){e.fpFilter.focusOn(t.ICliente.sCOGNOME),e.tabResult.repaint(),e.fpFilter.isBlank()||e.btnFind.trigger("click")},100)},n}(WUX.WDialog)
t.DlgClienti=u
var h=function(t){function i(i){var n=t.call(this,i,"DlgAttrRis")||this
n.title="Cabine riservate"
var a=[["Cabina","da"],["Collaboratore","dc"],["Giorno","rg"],["Riservata dalle","rd"],["alle","ra"]]
return n.tabAttr=new WUX.WDXTable(n.subId("tpa"),e.col(a,0),e.col(a,1)),n.tabAttr.css({h:328}),n.tabAttr.exportFile="cabine_riservate",n.tabAttr.widths=[240],n.tabAttr.selectionMode="single",n.tabAttr.onRowPrepared(function(t){if(t.data){var i=e.getBoolean(t.data,"at"),n=e.getBoolean(t.data,"sp")
i?n&&WUX.setCss(t.rowElement,WUX.CSS.WARNING):WUX.setCss(t.rowElement,WUX.CSS.ERROR)}}),n.body.addRow().addCol("12").add(n.tabAttr),n}return __extends(i,t),i.prototype.updateState=function(e){t.prototype.updateState.call(this,e),this.tabAttr&&this.tabAttr.setState(this.state)},i.prototype.getState=function(){return this.tabAttr&&(this.state=this.tabAttr.getState()),this.state},i.prototype.onShown=function(){var t=this
this.tabAttr.scrollTo(0),setTimeout(function(){t.state&&t.state.length?t.tabAttr.refresh():t.tabAttr.repaint()},100)},i}(WUX.WDialog)
t.DlgAttrRis=h
var p=function(i){function n(n){var a=i.call(this,n,"DlgStoricoApp")||this
a.title="Storico appuntamenti",a.dataRif=e.toNumber(new Date)
var s=[["Data App.",t.IPrenotazione.sDATA_APP,"d"],["Ora App.",t.IPrenotazione.sORA_APP,"s"],["Durata",t.IPrenotazione.sDURATA,"i"],["Stato",t.IPrenotazione.sSTATO,"s"],["Collaboratore",t.IPrenotazione.sDESC_COLL,"s"],["Trattamento",t.IPrenotazione.sDESC_PREST,"s"],["Cabina",t.IPrenotazione.sDESC_ATTR,"s"],["Data Pren.",t.IPrenotazione.sDATA_PREN,"d"],["Struttura",t.IPrenotazione.sCOD_FAR,"s"],["Note",t.IPrenotazione.sNOTE,"s"],["Coupon",t.IPrenotazione.sCOD_COUPON,"s"],["Forzatura",t.IPrenotazione.sOVERBOOKING,"b"],["On Line",t.IPrenotazione.sPREN_ONLINE,"b"]]
return a.tabStorico=new WUX.WDXTable(a.subId("tps"),e.col(s,0),e.col(s,1)),a.tabStorico.types=e.col(s,2),a.tabStorico.css({h:200,f:10}),a.tabStorico.onRowPrepared(function(i){if(i.data){var n=e.getString(i.data,t.IPrenotazione.sSTATO,"C"),s=e.getInt(i.data,t.IPrenotazione.sDATA_APP)
switch(n){case"F":WUX.setCss(i.rowElement,WUX.CSS.WARNING)
break
case"E":WUX.setCss(i.rowElement,WUX.CSS.SUCCESS)
break
case"N":WUX.setCss(i.rowElement,WUX.CSS.ERROR)
break
case"A":WUX.setCss(i.rowElement,WUX.CSS.COMPLETED)}s==a.dataRif&&i.rowElement.css("font-weight","bold")}}),a.body.addRow().addCol("12").add(a.tabStorico),a}return __extends(n,i),n.prototype.updateState=function(t){i.prototype.updateState.call(this,t),this.tabStorico&&this.tabStorico.setState(this.state)},n.prototype.onShown=function(){var t=this
this.tabStorico.scrollTo(0),setTimeout(function(){t.state&&t.state.length?t.tabStorico.refresh():t.tabStorico.repaint()},100)},n.prototype.componentDidMount=function(){i.prototype.componentDidMount.call(this),$(window).width()>1200?this.cntMain.css({w:1200,h:600}):this.cntMain.css({w:900,h:600})},n}(WUX.WDialog)
t.DlgStoricoApp=p
var b=function(i){function n(n){var a=i.call(this,n,"DlgStoricoColl")||this
a.title="Storico prenotazioni collaboratore",a.dataRif=e.toNumber(new Date)
var s=[["Data App.",t.IPrenotazione.sDATA_APP,"d"],["Ora App.",t.IPrenotazione.sORA_APP,"s"],["Durata",t.IPrenotazione.sDURATA,"i"],["Stato",t.IPrenotazione.sSTATO,"s"],["Cliente",t.IPrenotazione.sDESC_CLIENTE,"s"],["Trattamento",t.IPrenotazione.sDESC_PREST,"s"],["Cabina",t.IPrenotazione.sDESC_ATTR,"s"],["Data Pren.",t.IPrenotazione.sDATA_PREN,"d"],["Data Agg.",t.IPrenotazione.sDATA_UPD,"t"],["Struttura",t.IPrenotazione.sCOD_FAR,"s"],["Note",t.IPrenotazione.sNOTE,"s"],["Forzatura",t.IPrenotazione.sOVERBOOKING,"b"],["On Line",t.IPrenotazione.sPREN_ONLINE,"b"]]
return a.label=new WUX.WLabel(a.subId("lbl")),a.label.css({f:14,fw:"bold"},WUX.CSS.LABEL_INFO),a.tabStorico=new WUX.WDXTable(a.subId("tps"),e.col(s,0),e.col(s,1)),a.tabStorico.filter=!0,a.tabStorico.exportFile="storico_coll",a.tabStorico.types=e.col(s,2),a.tabStorico.css({h:400,f:10}),a.tabStorico.onRowPrepared(function(i){if(i.data){var n=e.getString(i.data,t.IPrenotazione.sSTATO,"C"),s=e.getInt(i.data,t.IPrenotazione.sDATA_APP)
switch(n){case"F":WUX.setCss(i.rowElement,WUX.CSS.WARNING)
break
case"E":WUX.setCss(i.rowElement,WUX.CSS.SUCCESS)
break
case"N":WUX.setCss(i.rowElement,WUX.CSS.ERROR)
break
case"A":WUX.setCss(i.rowElement,WUX.CSS.COMPLETED)}s==a.dataRif&&i.rowElement.css("font-weight","bold")}}),a.body.addRow().addCol("12",{a:"right"}).add(a.label).addRow().addDiv(8).addCol("12").add(a.tabStorico),a}return __extends(n,i),n.prototype.updateState=function(t){i.prototype.updateState.call(this,t),this.tabStorico&&this.tabStorico.setState(this.state)},n.prototype.updateProps=function(t){i.prototype.updateProps.call(this,t),this.mounted&&this.label.setState(this.props)},n.prototype.onShown=function(){var t=this
this.tabStorico.scrollTo(0),this.tabStorico.clearFilter(),setTimeout(function(){t.state&&t.state.length?t.tabStorico.refresh():t.tabStorico.repaint()},100)},n.prototype.componentDidMount=function(){i.prototype.componentDidMount.call(this),$(window).width()>1200?this.cntMain.css({w:1200,h:600}):this.cntMain.css({w:900,h:600})},n}(WUX.WDialog)
t.DlgStoricoColl=b
var I=function(i){function n(n){var a=i.call(this,n,"DlgComunicazione")||this
a.title="Seleziona comunicazione"
var s=[["Oggetto",t.IComunicazione.sOGGETTO,"s"]]
return a.tabCom=new WUX.WDXTable(a.subId("tpr"),e.col(s,0),e.col(s,1)),a.tabCom.types=e.col(s,2),a.tabCom.css({h:350}),a.tabCom.selectionMode="single",a.body.addRow().addCol("12").add(a.tabCom),a}return __extends(n,i),n.prototype.updateState=function(t){i.prototype.updateState.call(this,t),this.tabCom&&this.tabCom.setState(this.state)},n.prototype.getState=function(){return this.tabCom&&(this.state=this.tabCom.getState()),this.state},n.prototype.getProps=function(){if(this.props=null,this.tabCom){var i=this.tabCom.getSelectedRowsData()
i&&i.length&&(this.props={id:e.getNumber(i[0],t.IComunicazione.sID),text:e.getString(i[0],t.IComunicazione.sOGGETTO)})}return this.props},n.prototype.onClickOk=function(){var t=this.tabCom.getSelectedRowsData()
return!(!t||!t.length)||(WUX.showWarning("Comunicazione non selezionata."),!1)},n.prototype.onShown=function(){var t=this
this.tabCom.scrollTo(0),setTimeout(function(){t.state&&t.state.length?t.tabCom.refresh():t.tabCom.repaint()},100)},n}(WUX.WDialog)
t.DlgComunicazione=I
var f=function(t){function i(i){var n=t.call(this,i,"DlgCambioAttr")||this
n.title="Cambio cabina"
var a=[["Cabina","da"],["Collaboratore","dc"],["Giorno","rg"],["Ris. dalle","rd"],["alle","ra"],["Coll.Successivo","nn"],["dalle","nd"],["alle","na"]]
return n.tabAttr=new WUX.WDXTable(n.subId("tpa"),e.col(a,0),e.col(a,1)),n.tabAttr.css({h:350}),n.tabAttr.widths=[240],n.tabAttr.selectionMode="single",n.tabAttr.onRowPrepared(function(t){if(t.data){var i=e.getNumber(t.data,"ia"),a=e.getBoolean(t.data,"rf"),s=e.getBoolean(t.data,"cp")
n.props&&n.props.id==i?WUX.setCss(t.rowElement,WUX.CSS.INFO):a&&WUX.setCss(t.rowElement,WUX.CSS.ERROR),s&&t.rowElement.css("font-weight","bold")}}),n.body.addRow().addCol("12").add(n.tabAttr),n}return __extends(i,t),i.prototype.updateState=function(e){t.prototype.updateState.call(this,e),this.tabAttr&&this.tabAttr.setState(this.state)},i.prototype.getState=function(){return this.tabAttr&&(this.state=this.tabAttr.getState()),this.state},i.prototype.getProps=function(){if(this.props=null,this.tabAttr){var t=this.tabAttr.getSelectedRowsData()
t&&t.length&&(this.props={id:e.getNumber(t[0],"ia"),text:e.getString(t[0],"da")})}return this.props},i.prototype.onClickOk=function(){var t=this.tabAttr.getSelectedRowsData()
return t&&t.length?!e.getBoolean(t[0],"rf")||(WUX.showWarning("Cabina occupata."),!1):(WUX.showWarning("Cabina non selezionata."),!1)},i.prototype.onShown=function(){var t=this
this.tabAttr.scrollTo(0),setTimeout(function(){t.state&&t.state.length?t.tabAttr.refresh():t.tabAttr.repaint()},100)},i}(WUX.WDialog)
t.DlgCambioAttr=f
var S=function(i){function n(n){var a=i.call(this,n,"DlgCambioPrest")||this
a.title="Cambio Trattamento"
var s=[["Descrizione",t.IPrestazione.sDESCRIZIONE,"s",!1],["Durata",t.IPrestazione.sDURATA,"i",!0],["Prezzo",t.IPrestazione.sPREZZO_FINALE,"c",!1]]
return a.tabPrest=new WUX.WDXTable(a.subId("tpr"),e.col(s,0),e.col(s,1)),a.tabPrest.types=e.col(s,2),a.tabPrest.css({h:350}),a.tabPrest.selectionMode="single",a.body.addRow().addCol("12").add(a.tabPrest),a}return __extends(n,i),n.prototype.updateState=function(t){i.prototype.updateState.call(this,t),this.tabPrest&&this.tabPrest.setState(this.state),this.durata=0},n.prototype.getState=function(){return this.tabPrest&&(this.state=this.tabPrest.getState()),this.state},n.prototype.getProps=function(){if(this.props=null,this.tabPrest){var i=this.tabPrest.getSelectedRowsData()
i&&i.length&&(this.props={id:e.getNumber(i[0],t.IPrestazione.sID),text:e.getString(i[0],t.IPrestazione.sDESCRIZIONE),value:e.getNumber(i[0],t.IPrestazione.sPREZZO_FINALE)})}return this.props},n.prototype.onClickOk=function(){if(this.done)return!0
if(this.durata){var i=this.tabPrest.getSelectedRowsData()
if(i&&i.length){var n=e.getNumber(i[0],t.IPrestazione.sDURATA)-10
this.durata<n?(WUX.showWarning("Il trattamento scelto ha una durata superiore."),this.done=!1):this.done=!0}}else this.done=!0
return this.done},n.prototype.onShown=function(){var t=this
this.tabPrest.scrollTo(0),this.done=!1,setTimeout(function(){t.state&&t.state.length?t.tabPrest.refresh():t.tabPrest.repaint()},100)},n}(WUX.WDialog)
t.DlgCambioPrest=S
var g=function(i){function n(n){var a=i.call(this,n,"DlgOrgPrest")||this
a.title="Organizza Prestazioni"
var s=[["Descrizione",t.IPrestazione.sDESCRIZIONE,"s",!1],["Durata",t.IPrestazione.sDURATA,"i",!0],["Prezzo",t.IPrestazione.sPREZZO_FINALE,"c",!1]]
a.tabPrestaz=new WUX.WDXTable(a.subId("tpr"),e.col(s,0),e.col(s,1)),a.tabPrestaz.editable=!0,a.tabPrestaz.types=e.col(s,2),a.tabPrestaz.editables=e.col(s,3),a.tabPrestaz.css({h:328}),a.tabPrestaz.widths=[240],a.tabPrestaz.selectionMode="single",a.btnUp=new WUX.WButton(a.subId("bu"),"",WUX.WIcon.ARROW_CIRCLE_UP,WUX.BTN.ACT_PRIMARY,{p:"3px 6px 3px 6px"}),a.btnUp.tooltip="Sposta su",a.btnUp.on("click",function(i){var n=a.tabPrestaz.getSelectedRowsData()
if(!n||!n.length)return void WUX.showWarning("Selezionare il trattamento da spostare.")
var s=n[0][t.IPrenotazione.sID],o=a.tabPrestaz.getState(),r=e.indexOf(o,t.IPrenotazione.sID,s)
if(!(r<=0)){var l=o[r-1],d=o[r]
o[r-1]=d,o[r]=l,a.tabPrestaz.setState(o),setTimeout(function(){a.tabPrestaz.select([r-1])},100)}}),a.btnDw=new WUX.WButton(a.subId("bd"),"",WUX.WIcon.ARROW_CIRCLE_DOWN,WUX.BTN.ACT_PRIMARY,{p:"3px 6px 3px 6px"}),a.btnDw.tooltip="Sposta giu'",a.btnDw.on("click",function(i){var n=a.tabPrestaz.getSelectedRowsData()
if(!n||!n.length)return void WUX.showWarning("Selezionare il trattamento da spostare.")
var s=n[0][t.IPrenotazione.sID],o=a.tabPrestaz.getState(),r=e.indexOf(o,t.IPrenotazione.sID,s)
if(!(r<0||r==o.length-1)){var l=o[r+1],d=o[r]
o[r+1]=d,o[r]=l,a.tabPrestaz.setState(o),setTimeout(function(){a.tabPrestaz.select([r+1])},100)}})
var o=new WUX.WContainer(a.subId("ct0"),"")
return o.addRow().addCol("11",{p:0}).add(a.tabPrestaz).addCol("1",{p:0}).addStack(WUX.CSS.STACK_BTNS,a.btnUp,a.btnDw),a.body.addRow().addCol("12").add(o),a}return __extends(n,i),n.prototype.updateState=function(t){i.prototype.updateState.call(this,t),this.tabPrestaz&&this.tabPrestaz.setState(this.state)},n.prototype.getState=function(){return this.tabPrestaz&&(this.state=this.tabPrestaz.getState()),this.state},n.prototype.onShown=function(){var t=this
setTimeout(function(){t.tabPrestaz.repaint()},100)},n}(WUX.WDialog)
t.DlgOrgPrest=g
var A=function(i){function n(n){var a=i.call(this,n,"DlgNuovoApp")||this
a.title="Nuovo Appuntamento",a.idCollStart=0,a.idCliente=0,a.dataPren=null,a.appts=[],a.prestAbil=[],a.prestSort=[],a.currDate=e.toNumber(new Date),a.idFar=0,a.idPren=0,a.confCanc=!1,a._sdate=!1,a._idcol=0,a._efind=!1,a._count=0,a.dlgCliente=new c(a.subId("dlc")),a.dlgCliente.onHiddenModal(function(t){if(a.dlgCliente.ok){var e=a.dlgCliente.getState()
e&&(a.tabClienti.setState([e]),a.lblNote.setState(""),setTimeout(function(){a.tabClienti.select([0])},100))}}),a.dlgOrgPres=new g(a.subId("dlp")),a.dlgOrgPres.onHiddenModal(function(t){a.dlgCliente.cancel||(a.prestSort=a.dlgOrgPres.getState())}),a.btnNew=new WUX.WButton(a.subId("bba"),"",t.ICO.ADD,WUX.BTN.PRIMARY,{p:"1px 6px 0px 6px"}),a.btnNew.tooltip="Registra nuovo cliente",a.btnNew.on("click",function(t){a.dlgCliente.setState(null),a.dlgCliente.show(a)}),a.txtSearch=new WUX.WInput("txtTest",WUX.WInputType.Text),a.txtSearch.css({w:"84%"}),a.txtSearch.tooltip="Ricerca cliente",a.txtSearch.placeHolder="Ricerca cliente",a.txtSearch.onEnterPressed(function(e){var i=a.txtSearch.getState()
if(!i)return void WUX.showWarning("Riportare un criterio di ricerca per il cliente")
var n={}
n[t.ICliente.sNOMINATIVO]=i,jrpc.execute("CLIENTI.find",[n],function(t){t&&t.length?(a.tabClienti.setState(t),1==t.length&&setTimeout(function(){a.tabClienti.select([0])},100)):a.tabClienti.setState([])})})
var s=new WUX.WContainer(a.subId("ccl"))
s.add(a.txtSearch).addSpan(8).add(a.btnNew)
var o=[["Cognome",t.ICliente.sCOGNOME],["Nome",t.ICliente.sNOME],["Telefono",t.ICliente.sTELEFONO1]]
a.tabClienti=new WUX.WDXTable(a.subId("tcl"),e.col(o,0),e.col(o,1)),a.tabClienti.css({h:300}),a.tabClienti.widths=[100],a.tabClienti.selectionMode="single",a.tabClienti.onSelectionChanged(function(i){var n=a.tabClienti.getSelectedRowsData()
if(n&&n.length){var s=e.getNumber(n[0],t.ICliente.sID)
s&&(a.idCliente=s,jrpc.execute("CLIENTI.read",[s],function(i){if(!i)return void WUX.showWarning("Dati cliente "+s+" non disponibili.")
var n=e.getArray(i,t.ICliente.sPRENOTAZIONI),o=e.getString(i,t.ICliente.sNOTE)
a.tabStorico.setState(n),a.lblNote.setState(o)}))}}),a.tabClienti.onRowPrepared(function(e){e.data&&e.data[t.ICliente.sREPUTAZIONE]&&WUX.setCss(e.rowElement,WUX.CSS.ERROR)}),a.tabClienti.onDoubleClick(function(t){var e=a.tabClienti.getSelectedRowsData()
e&&e.length&&(a.dlgCliente.setState(e[0]),a.dlgCliente.show())})
var r=[["Descrizione",t.IPrestazione.sDESCRIZIONE,"s",!1],["Durata",t.IPrestazione.sDURATA,"i",!0],["Prezzo",t.IPrestazione.sPREZZO_FINALE,"c",!1]]
a.tabPrestaz=new WUX.WDXTable(a.subId("tpr"),e.col(r,0),e.col(r,1)),a.tabPrestaz.editable=!0,a.tabPrestaz.types=e.col(r,2),a.tabPrestaz.editables=e.col(r,3),a.tabPrestaz.css({h:328}),a.tabPrestaz.widths=[320],a.tabPrestaz.selectionMode="multiple",a.tabPrestaz.filter=!0,a.tabPrestaz.onSelectionChanged(function(i){var n=a.tabPrestaz.getSelectedRowsData()
if(!n||!n.length)return a.fpApp.setValue(t.IPrenotazione.sPREZZO_FINALE,null),a.fpApp.setValue(t.IPrenotazione.sDURATA,null),!1
for(var s=0,o=0,r=0;r<n.length;r++)s+=e.getNumber(n[r],t.IPrestazione.sPREZZO_FINALE),o+=e.getNumber(n[r],t.IPrestazione.sDURATA)
a.fpApp.setValue(t.IPrenotazione.sPREZZO_FINALE,WUX.formatCurr(s)),a.fpApp.setValue(t.IPrenotazione.sDURATA,o)}),a.tabPrestaz.onRowPrepared(function(i){if(i.data&&a.prestAbil&&a.prestAbil.length){var n=e.getNumber(i.data,t.IPrestazione.sID)
a.prestAbil.indexOf(n)>=0&&i.rowElement.css("font-weight","bold")}}),a.tabPrestaz.onRowUpdated(function(i){setTimeout(function(){var i=a.tabPrestaz.getSelectedRowsData()
if(!i||!i.length)return!1
for(var n=0,s=0;s<i.length;s++)n+=e.getNumber(i[s],t.IPrestazione.sDURATA)
a.fpApp.setValue(t.IPrenotazione.sDURATA,n)},100)}),a.lblNote=new WUX.WLabel(a.subId("lbln"),"","",null,WUX.CSS.LABEL_NOTICE)
var l=[["Data App.",t.IPrenotazione.sDATA_APP,"d"],["Ora App.",t.IPrenotazione.sORA_APP,"s"],["Durata",t.IPrenotazione.sDURATA,"i"],["Stato",t.IPrenotazione.sSTATO,"s"],["Collaboratore",t.IPrenotazione.sDESC_COLL,"s"],["Trattamento",t.IPrenotazione.sDESC_PREST,"s"],["Cabina",t.IPrenotazione.sDESC_ATTR,"s"],["Data Pren.",t.IPrenotazione.sDATA_PREN,"d"],["Note",t.IPrenotazione.sNOTE,"s"]]
a.tabStorico=new WUX.WDXTable(a.subId("tps"),e.col(l,0),e.col(l,1)),a.tabStorico.types=e.col(l,2),a.tabStorico.css({h:150,f:10}),a.tabStorico.onRowPrepared(function(i){if(i.data){var n=e.getString(i.data,t.IPrenotazione.sSTATO,"C"),s=e.getNumber(i.data,t.IPrenotazione.sDATA_APP)
switch(n){case"F":WUX.setCss(i.rowElement,WUX.CSS.WARNING)
break
case"E":WUX.setCss(i.rowElement,WUX.CSS.SUCCESS)
break
case"N":WUX.setCss(i.rowElement,WUX.CSS.ERROR)
break
case"A":WUX.setCss(i.rowElement,WUX.CSS.COMPLETED)}s==a.currDate&&i.rowElement.css("font-weight","bold")}}),a.selCol=new t.CFSelectCollab,a.selCol.on("statechange",function(t){var i=e.toNumber(a.selCol.getState())
i?(0==a._count&&(a.idCollStart=i),jrpc.execute("COLLABORATORI.getServices",[i],function(t){t&&(a.prestAbil=t,a.tabPrestaz.repaint())})):(a.prestAbil=[],a.tabPrestaz.repaint()),a.selCol.count&&a._efind&&a._idcol&&i!=a._idcol&&a.doFind()}),a.selCab=new t.CFSelectCabine,a.selTip=new t.CFSelectTipoApp,a.chkOvr=new WUX.WCheck("","Ignora controlli"),a.chkMat=new WUX.WCheck("","fino alle 14:00"),a.chkPom=new WUX.WCheck("","dalle 14:00"),a.btnOrgPr=new WUX.WButton(a.subId("bro"),"Organizza",t.ICO.TOOL,WUX.BTN.SECONDARY),a.btnOrgPr.on("click",function(t){var e=a.getSelectedPrest(!0)
e&&e.length&&(a.dlgOrgPres.setState(e),a.dlgOrgPres.show(a))}),a.btnReset=new WUX.WButton(a.subId("brs"),t.TXT.RESET,t.ICO.RESET,WUX.BTN.DANGER),a.btnReset.on("click",function(e){a.appts=[],a._sdate=!1,a._idcol=0,a._efind=!1,a._count=0,a.fpApp.setValue(t.IPrenotazione.sID_COLL,null),a.fpApp.setValue(t.IPrenotazione.sID_ATTR,null),a.fpApp.setValue(t.IPrenotazione.sDATA_APP,null),a.fpApp.setValue(t.IPrenotazione.sORA_APP,null),a.tabPrestaz.clearSelection(),a.tabPrestaz.clearFilter()}),a.btnFirst=new WUX.WButton(a.subId("bfa"),t.TXT.SEARCH,t.ICO.SEARCH,WUX.BTN.WARNING),a.btnFirst.on("click",function(t){var e=a.tabPrestaz.getSelectedRowsData()
if(!e||!e.length)return void WUX.showWarning("Selezionare uno o pi&ugrave; trattamenti.")
a.doFind()})
var d=new WUX.WContainer(a.subId(),null,{a:"right"})
d.add(a.btnOrgPr).addSpan(5).add(a.btnReset).addSpan(5).add(a.btnFirst)
var u=t.isBookOper()
return a.fpApp=new WUX.WFormPanel(a.subId("fpa")),a.fpApp.addRow(),a.fpApp.addComponent(t.IPrenotazione.sID_COLL,"Collaboratore",a.selCol),a.fpApp.addRow(),a.fpApp.addComponent(t.IPrenotazione.sID_ATTR,"Cabina",a.selCab),a.fpApp.addComponent(t.IPrenotazione.sTIPO,"Tipo",a.selTip),a.fpApp.addRow(),a.fpApp.addDateField(t.IPrenotazione.sDATA_APP,"Data"),a.fpApp.addTextField(t.IPrenotazione.sORA_APP,"Ora"),a.fpApp.addRow(),a.fpApp.addTextField(t.IPrenotazione.sDURATA,"Durata",!0),a.fpApp.addTextField(t.IPrenotazione.sPREZZO_FINALE,"Totale &euro;",!0),a.fpApp.addRow(),a.fpApp.addTextField(t.IPrenotazione.sNOTE,"Note"),a.fpApp.addRow(),u?a.fpApp.addBlankField():a.fpApp.addComponent(t.IPrenotazione.sIGNORE_CHECK,"Forzatura",a.chkOvr.getWrapper()),a.fpApp.addComponent(t.IPrenotazione.sMATTINO,"Mattino",a.chkMat.getWrapper()),a.fpApp.addComponent(t.IPrenotazione.sPOMERIGGIO,"Pomeriggio",a.chkPom.getWrapper()),a.fpApp.addInternalField(t.IPrenotazione.sOVERBOOKING),a.lnkPrev=new WUX.WLink(a.subId("lnkp"),"",t.ICO.LEFT),a.lnkPrev.tooltip="Data precedente",a.lnkPrev.on("click",function(i){a._efind=!1
var n=e.toDate(a.fpApp.getValue(t.IPrenotazione.sDATA_APP))
return n?a._idcol?(a.idCollStart||a.fpApp.setValue(t.IPrenotazione.sID_COLL,null),void a.doFind(null,n)):void WUX.showWarning("Interrogare le disponibilit&agrave;."):void WUX.showWarning("Data non selezionata.")}),a.lnkNext=new WUX.WLink(a.subId("lnkn"),"",t.ICO.RIGHT),a.lnkNext.tooltip="Data successiva",a.lnkNext.on("click",function(i){a._efind=!1
var n=e.toDate(a.fpApp.getValue(t.IPrenotazione.sDATA_APP))
return n?a._idcol?(a.idCollStart||a.fpApp.setValue(t.IPrenotazione.sID_COLL,null),n.setDate(n.getDate()+1),void a.doFind(n)):void WUX.showWarning("Interrogare le disponibilit&agrave;."):void WUX.showWarning("Data non selezionata.")}),a.fpApp.setLabelLinks(t.IPrenotazione.sDATA_APP,[a.lnkPrev,a.lnkNext]),a.fpApp.onChangeDate(function(e){if(WUX.lastSub($(e.target))==t.IPrenotazione.sDATA_APP){if(a._sdate)return void(a._sdate=!1)
if(a.fpApp.isBlank(t.IPrenotazione.sDATA_APP))return
if(!a._efind)return
a.doFind()}}),a.fpApp.onFocus(t.IPrenotazione.sORA_APP,function(e){var i=$(e.target)
i.autocomplete({source:function(t,e){if(a.appts){for(var i=[],n=0;n<a.appts.length;n++){var s=WUX.formatTime(a.appts[n])
i.push({id:a.appts[n],label:s,value:s})}e(i)}},minLength:0,open:function(t){$(".ui-autocomplete").css("width",i.innerWidth()+"px")},select:function(e,i){a.fpApp.setValue(t.IPrenotazione.sORA_APP,i.item.value)}}).keydown()}),a.fpApp.setMandatory(t.IPrenotazione.sDATA_APP,t.IPrenotazione.sORA_APP),a.body.addRow().addCol("3").addStack({pt:2,pb:2,a:"left"},s,a.tabClienti).addCol("5").add(a.tabPrestaz).addCol("4").add(a.fpApp).add(d).addRow().addCol("12").addStack({pt:2,pb:2,a:"left"},a.lblNote,a.tabStorico),a}return __extends(n,i),n.prototype.getSelectedPrest=function(i){var n=this.tabPrestaz.getSelectedRowsData()
if(!n||!n.length)return i&&WUX.showWarning("Selezionare uno o pi&ugrave; trattamenti."),[]
if(this.prestSort&&this.prestSort.length){for(var a=[],s=0;s<this.prestSort.length;s++){var o=this.prestSort[s],r=e.indexOf(n,t.IPrestazione.sID,o.id)
r>=0&&(a.push(n[r]),n.splice(r,1))}for(var s=0;s<n.length;s++)a.push(n[s])
return a}return n},n.prototype.setIdFar=function(e,i){var n=this
this.selCol.setIdFar(e,i),this.selCab.setIdFar(e),e?this.idFar!=e&&(this.idFar=e,jrpc.execute("PRESTAZIONI.getAll",[this.idFar],function(e){if(e){for(var i=0;i<e.length;i++)e[i][t.IPrestazione.sDURATA+"_"]=e[i][t.IPrestazione.sDURATA]
n.tabPrestaz.setState(e)}else n.tabPrestaz.setState([])})):(this.idFar=0,this.tabPrestaz.setState([]),WUX.showWarning("Riferimento alla struttura non presente"))},n.prototype.doFind=function(i,n){var a=this
console.log("doFind fromDate="+WUX.formatDate(i)+",toDate="+WUX.formatDate(n)),console.trace(),this._efind=!1,this._count++
var s=this.getSelectedPrest(!1)
if(!s||!s.length)return this
this.appts=[]
for(var o=[],r=[],l=0;l<s.length;l++)o.push(s[l][t.IPrestazione.sID]),r.push(s[l][t.IPrestazione.sDURATA])
var d=this.fpApp.getValues()
return d[t.IPrenotazione.sPREFERENZE]="",d[t.IPrenotazione.sMATTINO]&&!d[t.IPrenotazione.sPOMERIGGIO]?d[t.IPrenotazione.sPREFERENZE]="M":!d[t.IPrenotazione.sMATTINO]&&d[t.IPrenotazione.sPOMERIGGIO]&&(d[t.IPrenotazione.sPREFERENZE]="P"),i?d[t.IPrenotazione.sCAMBIO_DAL]=i:n?d[t.IPrenotazione.sCAMBIO_AL]=n:d[t.IPrenotazione.sCAMBIO_DATA]=e.toDate(this.fpApp.getValue(t.IPrenotazione.sDATA_APP)),d[t.IPrenotazione.sPRESTAZIONI]=o,d[t.IPrenotazione.sDURATE]=r,d[t.IPrenotazione.sPREN_ONLINE]=!1,this.idFar&&(d[t.IPrenotazione.sID_FAR]=this.idFar),console.log("doFind",d),jrpc.execute("CALENDARIO.getAvailabilities",[d],function(e){if(!e||!e.length)return a._idcol=-1,a.fpApp.setValue(t.IPrenotazione.sORA_APP,""),WUX.showWarning("Non vi sono appuntamenti disponibili."),void(a._efind=!0)
var i=e[0]
if(i.data){var n="Primo appuntamento disponibile:<br><strong>"+WUX.formatDate(i.data,!0)+"</strong> "
n+="alle ore <strong>"+WUX.formatTime(i.oraInizio)+"</strong><br>",n+="con <strong>"+i.nomeCollab+"</strong>",i.altriCollab&&(n+="<br>e con <strong>"+i.altriCollab+"</strong>"),WUX.showSuccess(n),a._sdate=!0,a.fpApp.setValue(t.IPrenotazione.sDATA_APP,i.data),a.fpApp.setValue(t.IPrenotazione.sORA_APP,WUX.formatTime(i.oraInizio)),a._idcol=i.idCollaboratore,a.fpApp.setValue(t.IPrenotazione.sID_COLL,i.idCollaboratore),a.txtSearch.getState()||a.txtSearch.focus()}a.appts=[]
for(var s=0;s<e.length;s++){var o=e[s].oraInizio
a.appts.indexOf(o)<0&&a.appts.push(o)}a.appts.sort(function(t,e){return t-e}),a._efind=!0}),this},n.prototype.onClickOk=function(){var i=this
if(this.idPren)return!0
var n=this.fpApp.checkMandatory(!0,!0)
if(n)return WUX.showWarning("Specificare i seguenti campi: "+n),!1
if(!this.idCliente)return WUX.showWarning("Selezionare prima un cliente per prenotare un appuntamento"),!1
var a=this.getSelectedPrest(!0)
if(!a||!a.length)return!1
for(var s=[],o=[],r=0;r<a.length;r++){var l=e.getNumber(a[r],t.IPrestazione.sDURATA),d=e.getString(a[r],t.IPrestazione.sDESCRIZIONE)
if(!d){d="prestazione num. "+(r+1)}if(l<5)return WUX.showWarning("Durata ("+l+") non valida per "+d),!1
s.push(a[r][t.IPrestazione.sID]),o.push(a[r][t.IPrestazione.sDURATA])}var c=this.fpApp.getValues()
c[t.IPrenotazione.sID_CLIENTE]=this.idCliente,c[t.IPrenotazione.sPRESTAZIONI]=s,c[t.IPrenotazione.sDURATE]=o,this.idFar&&(c[t.IPrenotazione.sID_FAR]=this.idFar)
var u=e.getBoolean(c,t.IPrenotazione.sIGNORE_CHECK),h=e.getBoolean(c,t.IPrenotazione.sOVERBOOKING)
return u?(c[t.IPrenotazione.sOVERBOOKING]=!0,c[t.IPrenotazione.sID_ATTR]||(c[t.IPrenotazione.sID_ATTR]=-1)):h&&c[t.IPrenotazione.sID_ATTR]&&(c[t.IPrenotazione.sID_ATTR]=0),t.chkExecute("PRENOTAZIONI.book",[c],function(n){if(!n)return void WUX.showWarning("Prenotazione NON eseguita.")
var a=e.getString(n,t.IPrenotazione.sMESSAGGIO)
if(a)return void WUX.showWarning(a)
i.idPren=e.getNumber(n,t.IPrenotazione.sID),i.dataPren=e.getDate(n,t.IPrenotazione.sDATA_APP),i.btnOK.trigger("click"),WUX.showSuccess("Prenotazione eseguita con successo.")}),!1},n.prototype.onClickCancel=function(){var t=this
if(this.confCanc)return!0
var e=this.getSelectedPrest(!1)
return!e||!e.length||(WUX.confirm("Si vuole annullare l'inserimento di un nuovo appuntamento?",function(e){e&&(t.confCanc=!0,t.btnCancel.trigger("click"))}),!1)},n.prototype.updateState=function(n){if(i.prototype.updateState.call(this,n),this._sdate=!1,this._idcol=0,this._efind=!1,this._count=0,this.idCollStart=e.getNumber(n,t.IPrenotazione.sID_COLL),this.fpApp){this.fpApp.clear(),this.state[t.IPrenotazione.sDATA_APP]&&(this._sdate=!0),this._idcol=this.idCollStart
var a=e.getNumber(n,t.IPrenotazione.sID_FAR)
a&&this.setIdFar(a,this.idCollStart),this.fpApp.setState(this.state)}},n.prototype.getState=function(){return this.fpApp&&(this.state=this.fpApp.getState()),this.state},n.prototype.onShown=function(){var e=this
this.idCliente=0,this.appts=[],this.prestSort=[],this.idPren=0,this.dataPren=null,this.confCanc=!1,this._sdate=!1,this._efind=!1,this._count=0
var i=this.tabPrestaz.getState()
if(i)for(var n=0;n<i.length;n++)null!=i[n][t.IPrenotazione.sDURATA+"_"]&&(i[n][t.IPrenotazione.sDURATA]=i[n][t.IPrenotazione.sDURATA+"_"])
setTimeout(function(){e.txtSearch.setState(""),e.tabClienti.setState([]),e.tabPrestaz.clearSelection(),e.tabPrestaz.clearFilter(),e.tabStorico.setState([]),e.tabClienti.repaint(),e.tabPrestaz.repaint(),e.tabStorico.repaint(),e.lblNote.setState(""),e.txtSearch.focus()},100)},n.prototype.componentDidMount=function(){i.prototype.componentDidMount.call(this),$(window).width()>1260?this.cntMain.css({w:1260,h:600}):this.cntMain.css({w:1e3,h:600})},n}(WUX.WDialog)
t.DlgNuovoApp=A}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){return i.call(this,t||"*","GUILogOpPren")||this}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(e){if(i.fpFilter.isBlank(t.IPrenotazione.sID_FAR))return void WUX.showWarning("Selezionare la struttura")
var n=i.fpFilter.checkMandatory(!0,!0,!0)
if(n)return void WUX.showWarning("Specificare almeno uno dei seguenti campi: "+n)
var a=WUX.getComponent("boxFilter")
a instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),a.collapse()),jrpc.execute("PRENOTAZIONI.findLog",[i.fpFilter.getState()],function(t){i.tabResult.setState(t),t&&t.length?i.lblResult.setState(t.length+" operazioni trovate."):i.lblResult.setState("Nessuna operazione trovata.")})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(n){i.tabResult.setState([]),i.fpFilter.clear(),i.fpFilter.setValue(t.IPrenotazione.sDATA_APP,e.getCurrDate()),i.fpFilter.setValue(t.IPrenotazione.sALLA_DATA,null),i.tagsFilter.setState({}),i.lblResult.setState("")}),this.tagsFilter=new WUX.WTags("tagsFilter"),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.tabResult.setState([])
var n=e.toNumber(i.selFar.getState())
i.selCol.setIdFar(n),i.selCab.setIdFar(n)}),this.selCol=new t.CFSelectCollab,this.selCab=new t.CFSelectCabine,this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IPrenotazione.sID_FAR,"Struttura",this.selFar),this.fpFilter.addDateField(t.IPrenotazione.sDATA_APP,"Data Operazione"),this.fpFilter.addDateField(t.IPrenotazione.sALLA_DATA,"Al"),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IPrenotazione.sID_CLIENTE,"Cliente",new t.CFSelectClienti),this.fpFilter.addComponent(t.IPrenotazione.sID_COLL,"Collaboratore",this.selCol),this.fpFilter.addTextField(t.IPrenotazione.sDESC_PREST,"Trattamento"),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IPrenotazione.sID_ATTR,"Cabina",this.selCab),this.fpFilter.addComponent(t.IPrenotazione.sSTATO,"Stato",new t.CFSelectStatiPren),this.fpFilter.addTextField(t.IPrenotazione.sUSERDESK,"Operaz. (1a lettera) / Utente Desk"),this.fpFilter.setMandatory(t.IPrenotazione.sID_FAR,t.IPrenotazione.sDATA_APP,t.IPrenotazione.sID_CLIENTE),this.fpFilter.setValue(t.IPrenotazione.sDATA_APP,e.getCurrDate()),this.lblResult=new WUX.WLabel(this.subId("lblr"),"",null,null,WUX.CSS.LABEL_INFO)
var n=[["Data Op.",t.IPrenotazione.sDATA_PREN,"t"],["Utente",t.IPrenotazione.sUSERDESK,"s"],["Operazione",t.IPrenotazione.sMESSAGGIO,"s"],["Id Pren.",t.IPrenotazione.sID,"n"],["Data App.",t.IPrenotazione.sDATA_APP,"d"],["Ora App.",t.IPrenotazione.sORA_APP,"s"],["Durata",t.IPrenotazione.sDURATA,"i"],["Stato",t.IPrenotazione.sSTATO,"s"],["Cliente",t.IPrenotazione.sDESC_CLIENTE,"s"],["Telefono",t.IPrenotazione.sTELEFONO1,"s"],["Collaboratore",t.IPrenotazione.sDESC_COLL,"s"],["Trattamento",t.IPrenotazione.sDESC_PREST,"s"],["Cabina",t.IPrenotazione.sDESC_ATTR,"s"],["Struttura",t.IPrenotazione.sCOD_FAR,"s"],["Forzatura",t.IPrenotazione.sOVERBOOKING,"b"],["On Line",t.IPrenotazione.sPREN_ONLINE,"b"],["Note",t.IPrenotazione.sNOTE,"s"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(n,0),e.col(n,1)),this.tabResult.types=e.col(n,2),this.tabResult.exportFile="prenotazioni",this.tabResult.filter=!0,this.tabResult.css({h:600,f:10}),this.tabResult.onRowPrepared(function(i){if(i.data){switch(e.getString(i.data,t.IPrenotazione.sSTATO,"C")){case"F":WUX.setCss(i.rowElement,WUX.CSS.WARNING)
break
case"E":WUX.setCss(i.rowElement,WUX.CSS.SUCCESS)
break
case"N":WUX.setCss(i.rowElement,WUX.CSS.ERROR)
break
case"A":WUX.setCss(i.rowElement,WUX.CSS.COMPLETED)}}}),this.cntActions=new t.CFTableActions("ta"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").add(this.lblResult),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.componentDidMount=function(){var i=this,n=0
t.strutture&&t.strutture.length&&(n=t.strutture[0].id)
var a=e.toDate(e.getParam("d"))
if(!a)return void(n&&this.selFar.setState(n))
var s=e.toNumber(e.getParam("f"))
s?(this.selFar.setState(s),n=s):n&&this.selFar.setState(n),n&&(this.selCol.setIdFar(n),this.selCab.setIdFar(n)),this.fpFilter.setValue(t.IPrenotazione.sDATA_APP,a),setTimeout(function(){i.btnFind.trigger("click")},200)},n}(WUX.WComponent)
t.GUILogOpPren=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(n,a,s,o){var r=i.call(this,n||"*","CFPlanning",null,a,s,o)||this
return r.COLOR_NA="#dcdcdc",r.COLOR_AV="#f5f5f5",r.COLOR_BK="#bbffbb",r.COLOR_EX="#ddedf6",r.COLOR_NE="#fecccc",r.COLOR_SU="#fefecc",r.COLOR_BK_OL="#aaeeaa",r.COLOR_EX_OL="#ccdcf6",r.COLOR_NE_OL="#edbbbb",r.COLOR_SU_OL="#ededbb",r.COLOR_AP="#6d7295",r.COLOR_HH="#707070",r.COLOR_MM="#808080",r.COLOR_MK="#ff0000",r.forceOnChange=!0,r._sync=!1,r._syncbk=!1,r._lstolb=[],r.resources=[],r.dateCal=new Date,r.appts={},r.slots={},r.alist=[],r.idCliente=0,r.autoScroll=!0,r.dlgPren=new t.DlgPrenotazione(r.subId("dlgp")),r.dlgPren.onHiddenModal(function(i){if(r._sync=r._syncbk,r.dlgPren.ok)if(r.dlgPren.dataPren&&!e.isSameDate(r.dlgPren.dataPren,r.dateCal))r.navCal&&(r.idCliente=r.dlgPren.idCliente,r.navCal.setState(r.dlgPren.dataPren))
else{var n={}
n[t.ICalendario.sDATA]=r.dateCal,n[t.ICalendario.sID_FAR]=r.dlgPren.idFar,jrpc.execute("CALENDARIO.getPlanning",[n],function(t){r.autoScroll=!r.dlgPren.idCliente,r.setState(t)
var e=r.mark(r.dlgPren.idCliente)
e&&e.length||r.scroll(r.dlgPren.oraPren)})}else if(r.dlgPren.refPlan){var n={}
n[t.ICalendario.sDATA]=r.dateCal,n[t.ICalendario.sID_FAR]=r.dlgPren.idFar,jrpc.execute("CALENDARIO.getPlanning",[n],function(t){r.autoScroll=!r.dlgPren.idCliente,r.setState(t)
var e=r.mark(r.dlgPren.idCliente)
e&&e.length||r.scroll(r.dlgPren.oraPren)})}}),r.dlgNApp=new t.DlgNuovoApp(r.subId("dlgn")),r.dlgNApp.onHiddenModal(function(i){if(r._sync=r._syncbk,r.dlgNApp.ok)if(r.dlgNApp.dataPren&&!e.isSameDate(r.dlgNApp.dataPren,r.dateCal))r.navCal&&(r.idCliente=r.dlgNApp.idCliente,r.navCal.setState(r.dlgNApp.dataPren))
else{var n={}
n[t.ICalendario.sDATA]=r.dateCal,n[t.ICalendario.sID_FAR]=r.dlgNApp.idFar,jrpc.execute("CALENDARIO.getPlanning",[n],function(t){r.autoScroll=!r.dlgNApp.idCliente,r.setState(t)
var e=r.mark(r.dlgNApp.idCliente)
e&&e.length||r.scrollFirst()})}}),setInterval(function(){if(console.log(WUX.formatDateTime(new Date,!0)+" _sync="+r._sync),r._sync){var i={}
i[t.ICalendario.sDATA]=r.dateCal,i[t.ICalendario.sID_FAR]=r.idFar,jrpc.execute("CALENDARIO.getOnLineBookings",[i],function(t){console.log("CALENDARIO.getOnLineBookings -> "+JSON.stringify(t))
var n=e.size(r._lstolb),a=e.size(t)
r._lstolb=t
var s=!1
if(a!=n)s=!0
else if(n&&a)for(var o=n-1;o>=0;o--)if(r._lstolb[o]!=t[o]){s=!0
break}if(s){if(a&&WUX.showSuccess(a+" appuntamenti on line"),!r._sync)return void console.log("CALENDARIO.getPlanning not invoked _sync="+r._sync)
console.log("CALENDARIO.getPlanning..."),jrpc.execute("CALENDARIO.getPlanning",[i],function(t){r._sync&&r.setState(t)},function(t){console.error("CALENDARIO.getPlanning: "+t.message)})}},function(t){console.error("CALENDARIO.getOnLineBookings: "+t.message)})}},3e4),r}return __extends(n,i),n.prototype.stopSync=function(){return this._sync=!1,this._syncbk=!1,this},n.prototype.startSync=function(){return this._sync=!0,this._syncbk=!0,this},n.prototype.suspendSync=function(){return this._sync=!1,this},n.prototype.resumeSync=function(t){return this._sync=this._syncbk,this},n.prototype.showPren=function(i){var n=this
i&&(this._sync=!1,jrpc.execute("PRENOTAZIONI.read",[i],function(a){if(!a)return WUX.showWarning("Prenotazione "+i+" non disponibile."),void(n._sync=n._syncbk)
var s=e.getDate(a,t.IPrenotazione.sDATA_APP)
s&&(a[t.IPrenotazione.sDATA_APP]=WUX.formatDate(s,!0))
var o=e.getDate(a,t.IPrenotazione.sDATA_PREN)
o&&(a[t.IPrenotazione.sDATA_PREN]=WUX.formatDateTime(o,!1,!0)),n.dlgPren.setState(a),n.dlgPren.show()}))},n.prototype.onClick=function(e,i){var n=this
if(!(i<0)&&!(e<0||e>2359)&&this.resources&&this.resources.length){if(this.resources.length<=i)return void WUX.showWarning("Risorsa non disponbile.")
var a=WUX.formatTime(e),s=this.resources[i]
if(!s||!s.id)return void WUX.showWarning("Risorsa non identificabile.")
if(this._sync=!1,this.slots){var o=this.slots[s.id+"_"+e]
if(o){if(1==o){var r={}
r[t.IPrenotazione.sID_FAR]=this.idFar,r[t.IPrenotazione.sDATA_APP]=this.dateCal,r[t.IPrenotazione.sORA_APP]=a,r[t.IPrenotazione.sID_COLL]=s.id,r[t.IPrenotazione.sOVERBOOKING]=!1,this.dlgNApp.setState(r),this.dlgNApp.show()}else if(o>1||o<0){if(!this.appts)return void WUX.showWarning("Informazioni prenotazione non disponibili")
for(var l=void 0,d=e;;){if(l=this.appts[s.id+"_"+d])break
var c=Math.floor(d/100),u=d%100
if(u>0?u-=10:(c-=1,u=50),c<0)break
d=100*c+u}if(!l)return void WUX.showWarning("Informazioni prenotazione assenti")
this.showPren(l.id)}}else WUX.confirm("Stai prenotando in un orario fuori lavorativo. Procedere?",function(e){if(e){var i={}
i[t.IPrenotazione.sID_FAR]=n.idFar,i[t.IPrenotazione.sDATA_APP]=n.dateCal,i[t.IPrenotazione.sORA_APP]=a,i[t.IPrenotazione.sID_COLL]=s.id,i[t.IPrenotazione.sOVERBOOKING]=!0,n.dlgNApp.setState(i),n.dlgNApp.show()}})}else WUX.confirm("Stai prenotando in un orario fuori lavorativo. Procedere?",function(e){if(e){var i={}
i[t.IPrenotazione.sID_FAR]=n.idFar,i[t.IPrenotazione.sDATA_APP]=n.dateCal,i[t.IPrenotazione.sORA_APP]=a,i[t.IPrenotazione.sID_COLL]=s.id,i[t.IPrenotazione.sOVERBOOKING]=!0,n.dlgNApp.setState(i),n.dlgNApp.show()}})}},n.prototype.newApp=function(){this._sync=!1
var e={}
return e[t.IPrenotazione.sID_FAR]=this.idFar,e[t.IPrenotazione.sDATA_APP]=new Date,this.dlgNApp.setState(e),this.dlgNApp.show(),this},n.prototype.updateState=function(n){var a
if(i.prototype.updateState.call(this,n),this.idFar=e.getNumber(this.state,t.ICalendario.sID_FAR),this.dateCal=e.getDate(this.state,t.ICalendario.sDATA),t.CFBookCfg.CHECK_USER_DESK=e.getBoolean(this.state,t.ICalendario.sCHECK_USER_DESK),this.mounted)if(this.state){this.resources=e.getArray(this.state,t.ICalendario.sRISORSE),this.appts=e.getObject(this.state,t.ICalendario.sAPPUNTAMENTI),this.slots=e.getObject(this.state,t.ICalendario.sSLOTS),this.resources||(this.resources=[]),this.appts||(this.appts={}),this.slots||(this.slots={}),this.alist=[]
for(var s in this.appts)if(this.appts.hasOwnProperty(s)){var o=e.getArray(this.appts,s);(a=this.alist).push.apply(a,o)}}else this.resources=[],this.appts={},this.slots={},this.alist=[]},n.prototype.componentDidMount=function(){var e=this
if(this._lstolb=[],this.resources&&this.resources.length){var i=$('<div style="overflow-y:scroll;"></div>')
this.root.append(i)
var n=$(window).height(),a=n-150
a<400&&(a=400)
var s=[],o='<table style="table-layout:fixed;width:100%;border-collapse:collapse;">'
o+="<thead><tr>"
for(var r=0;r<this.resources.length;r++){var l=this.resources[r],d=this.subId(l.id)
s.push(d),l.color||(l.color="ffffff"),o+='<td style="border:1px solid #b5b5b5;"><div style="width:100%;text-align:center;height:30px;overflow-x:hidden;font-size:12px;font-weight:bold;"><a href="#" id="'+d+'">'+l.text+'</a></div><div style="width:100%;height:10px;background-color:#'+l.color+'"></div></td>'}o+="</tr></thead>",o+="</table>",i.append(o)
var c=this.subId("db")
this.$body=$('<div id="'+c+'" style="height:'+a+'px;overflow-x:hidden;overflow-y:scroll;"></div>'),this.root.append(this.$body)
var u=this.subId("tb"),h='<table id="'+u+'" style="table-layout:fixed;width:100%;border-collapse:collapse;cursor:pointer;">'
h+="<tbody>"
for(var p=0;p<24;p++)for(var b=p<9?"0"+p:""+p,I=0;I<60;I+=10){var f=I<10?"0"+I:""+I,S=100*p+I
h+="<tr>"
for(var r=0;r<this.resources.length;r++){var l=this.resources[r],g=this.COLOR_NA,A=this.slots[l.id+"_"+S]
switch(A||(A=0),A){case 1:g=this.COLOR_AV
break
case 2:g=this.COLOR_BK
break
case-2:g=this.COLOR_BK_OL
break
case 3:g=this.COLOR_EX
break
case-3:g=this.COLOR_EX_OL
break
case 4:g=this.COLOR_NE
break
case-4:g=this.COLOR_NE_OL
break
case 5:g=this.COLOR_SU
break
case-5:g=this.COLOR_SU_OL}var T=this.appts[l.id+"_"+S]
if(T){T.id&&A<0&&this._lstolb.push(T.id)
var C=T.descCliente
C&&C.length>5&&(C=C.substring(0,5))
var D=T.descPrest
D&&D.length>5&&(D=D.substring(0,5)),C||(C="&nbsp;"),D||(D="&nbsp;")
var U="<br>"+C+"<br>"+D,W=""
"F"==T.tipo?W="background-image:url(/bookme/img/heart.png);background-repeat:no-repeat;":"O"==T.tipo&&(W="background-image:url(/bookme/img/star.png);background-repeat:no-repeat;"),h+='<td style="border:1px solid #b5b5b5;"><div style="line-height:13px;font-size:14px;width:100%;text-align:center;overflow:hidden;background-color:'+g+";color:"+this.COLOR_AP+";font-weight:bold;"+W+'"><span id="a'+T.id+'">'+b+":"+f+U+"</span></div></td>"}else if("00"==f){var P=A<2?b+":"+f:"",U="<br>&nbsp;<br>&nbsp;"
h+='<td style="border:1px solid #b5b5b5;"><div style="line-height:13px;font-size:14px;width:100%;text-align:center;overflow:hidden;background-color:'+g+";color:"+this.COLOR_HH+';font-weight:bold;">'+P+U+"</div></td>"}else{var P=A<2?b+":"+f:"",U="<br>&nbsp;<br>&nbsp;"
h+='<td style="border:1px solid #b5b5b5;"><div style="line-height:13px;font-size:14px;width:100%;text-align:center;overflow:hidden;background-color:'+g+";color:"+this.COLOR_MM+';">'+P+U+"</div></td>"}}h+="</tr>"}h+="</tbody>",h+="</table>",this.$body.append(h)
if(!t.isBookOper())for(var r=0;r<s.length;r++){var E=$("#"+s[r])
E.length&&E.on("click",function(i){t.isDevMode()?WUX.openURL("index.html?c=GUICollaboratori&id="+WUX.lastSub(i.target)+"&idFar="+e.idFar,!0,!0):WUX.openURL("collaboratori?id="+WUX.lastSub(i.target)+"&idFar="+e.idFar,!0,!0)})}if($("#"+u).length){var R=this
this.root.on("click","tbody tr td",function(t){var e=$(this),i=e.parent().index(),n=e.index(),a=Math.floor(10*i/60),s=10*i%60,o=100*a+s
R.onClick(o,n)})}if(this.autoScroll)if(this.idCliente){var l=this.mark(this.idCliente)
l&&l.length||this.scrollFirst(),this.idCliente=0}else setTimeout(function(){var t=e.$body[0].scrollHeight,i=Math.floor(8*t/24)
e.$body.animate({scrollTop:i},"fast")},200)}},n.prototype.mark=function(t){if(console.log("CFPlanning.mark("+t+")"),!this.alist||!this.alist.length)return[]
if(!t)return[]
var i=[],n=-1
if("string"==typeof t)for(var a=0;a<this.alist.length;a++){var s=this.alist[a]
if("!"==t&&0==s.idAttr){i.push(s)
var o=e.toIntTime(s.oraApp);(n<0||n>o)&&(n=o)}else if(s.descCliente.toLowerCase().indexOf(t.toLowerCase().trim())>=0){i.push(s)
var o=e.toIntTime(s.oraApp);(n<0||n>o)&&(n=o)}var r=$("#a"+s.id)
r.length&&r.css("color",this.COLOR_AP)}else for(var a=0;a<this.alist.length;a++){var s=this.alist[a]
if(s.idCliente==t){i.push(s)
var o=e.toIntTime(s.oraApp);(n<0||n>o)&&(n=o)}var r=$("#a"+s.id)
r.length&&r.css("color",this.COLOR_AP)}for(var a=0;a<i.length;a++){var r=$("#a"+i[a].id)
r.length&&r.css("color",this.COLOR_MK)}return n>=0&&this.scroll(n),i},n.prototype.scrollFirst=function(){return this.scroll(800)},n.prototype.scroll=function(t){if(console.log("CFPlanning.scroll("+t+")"),this.$body){var i=0,n=0
if("string"==typeof t){var a=t.indexOf(":")
if(a)i=e.toNumber(t.substring(0,a)),n=e.toNumber(t.substring(a+1))
else{var s=e.toNumber(t)
s>99?(i=Math.floor(s/100),n=s%100):i=s}}else i=Math.floor(t/100),n=t%100
var o=this.$body[0].scrollHeight,r=Math.floor(o*i/24+o*n/1440)
return this.$body.animate({scrollTop:r},"fast"),console.log("CFPlanning.scroll("+t+") -> "+r),r}},n}(WUX.WComponent)
t.CFPlanning=i
var n=function(i){function n(e){var n=i.call(this,e||"*","CFNavCalendar")||this
return n.state=new Date,n.dlgDate=new t.DlgDataCal(n.subId("ddc")),n.dlgDate.onHiddenModal(function(t){if(!n.dlgDate.cancel){var e=n.dlgDate.getState()
e&&(n.setState(e),setTimeout(function(){$.get("/wrapp/api/nop")},0))}}),n.dlgAttr=new t.DlgAttrRis(n.subId("dda")),n}return __extends(n,i),n.prototype.onClickPrev=function(t){this.handlers._clickprev||(this.handlers._clickprev=[]),this.handlers._clickprev.push(t)},n.prototype.onClickNext=function(t){this.handlers._clicknext||(this.handlers._clicknext=[]),this.handlers._clicknext.push(t)},n.prototype.prev=function(){this.lnkPrev&&this.lnkPrev.trigger("click")},n.prototype.next=function(){this.lnkNext&&this.lnkNext.trigger("click")},n.prototype.render=function(){var i=this
this.lnkDate=new WUX.WLink(this.subId("lt")),this.lnkDate.css({f:16,fw:"600"}),this.lnkDate.setState(this.formatDate(this.state)),this.lnkDate.on("click",function(t){i.dlgDate.setState(i.state),i.dlgDate.show()}),this.lnkPrev=new WUX.WLink(this.subId("lp"),"",WUX.WIcon.LARGE+WUX.WIcon.ANGLE_LEFT),this.lnkPrev.css({f:18,fw:"600",pr:16}),this.lnkPrev.tooltip="F7",this.lnkPrev.on("click",function(t){if(i.state||(i.state=new Date),i.state.setDate(i.state.getDate()-1),i.lnkDate.setState(i.formatDate(i.state,!0)),i.handlers._clickprev)for(var e=0,n=i.handlers._clickprev;e<n.length;e++){var a=n[e]
a(t)}}),this.lnkNext=new WUX.WLink(this.subId("ln"),"",WUX.WIcon.LARGE+WUX.WIcon.ANGLE_RIGHT),this.lnkNext.css({f:18,fw:"600",pl:16}),this.lnkNext.tooltip="F8",this.lnkNext.on("click",function(t){if(i.state||(i.state=new Date),i.state.setDate(i.state.getDate()+1),i.lnkDate.setState(i.formatDate(i.state,!0)),i.handlers._clicknext)for(var e=0,n=i.handlers._clicknext;e<n.length;e++){var a=n[e]
a(t)}}),this.lnkAttr=new WUX.WLink(this.subId("la"),"Cabine riservate",t.ICO.WORK),this.lnkAttr.tooltip="Cabine riservate",this.lnkAttr.on("click",function(t){if(!i.state)return void WUX.showWarning("Data non selezionata")
var n=e.toNumber(i.selFar.getState())
if(!n)return void WUX.showWarning("Struttura non selezionata")
jrpc.execute("ATTREZZATURE.getRiservate",[n,i.state],function(t){t&&t.length||WUX.showWarning("Non vi sono cabine riservate"),i.dlgAttr.setProps(i.state),i.dlgAttr.setState(t),i.dlgAttr.show()})}),this.chkSel=new WUX.WCheck(this.subId("sc"),""),this.chkSel.on("statechange",function(t){i.chkSel.checked&&!i.selFar.enabled?WUX.confirm("Si vuole abilitare la selezione della struttura?",function(t){if(!t)return void setTimeout(function(){i.chkSel.checked=!1},100)
i.selFar.enabled=!0}):i.selFar.enabled=!1}),this.selFar=new t.CFSelectStruture,this.selFar.enabled=!1,this.selFar.on("statechange",function(t){var n=e.toString(i.selFar.getState())
if(n){switch(n.charAt(n.length-1)){case"1":WUX.setCss($("#"+i.c0),WUX.CSS.SUCCESS),WUX.setCss($("#"+i.c1),WUX.CSS.SUCCESS),WUX.setCss($("#"+i.c2),WUX.CSS.SUCCESS)
break
case"3":WUX.setCss($("#"+i.c0),WUX.CSS.INFO),WUX.setCss($("#"+i.c1),WUX.CSS.INFO),WUX.setCss($("#"+i.c2),WUX.CSS.INFO)
break
case"5":WUX.setCss($("#"+i.c0),WUX.CSS.WARNING),WUX.setCss($("#"+i.c1),WUX.CSS.WARNING),WUX.setCss($("#"+i.c2),WUX.CSS.WARNING)
break
case"9":WUX.setCss($("#"+i.c0),WUX.CSS.ERROR),WUX.setCss($("#"+i.c1),WUX.CSS.ERROR),WUX.setCss($("#"+i.c2),WUX.CSS.ERROR)
break
default:WUX.setCss($("#"+i.c0),{bg:"white"}),WUX.setCss($("#"+i.c1),{bg:"white"}),WUX.setCss($("#"+i.c2),{bg:"white"})}}i.trigger("propschange",e.toNumber(i.selFar.getState()))})
var n=new WUX.WContainer(this.subId("cnf"))
return n.addRow().addCol("1").add(this.chkSel).addCol("11").add(this.selFar),this.c0=this.subId("c0"),this.c1=this.subId("c1"),this.c2=this.subId("c2"),this.container=new WUX.WContainer,this.container.addRow().addCol("3",{bg:"white",a:"left",pt:5,pb:6,pl:8},this.c0).add(n).addCol("6",{bg:"white",a:"center",pt:5,pb:6},this.c1).addLine(WUX.CSS.LINE_BTNS,this.lnkPrev,this.lnkDate,this.lnkNext).addCol("3",{bg:"white",a:"right",pt:10,pb:10,pr:8},this.c2).add(this.lnkAttr),this.container},n.prototype.getProps=function(){return this.selFar&&(this.props=e.toNumber(this.selFar.getState())),this.props},n.prototype.updateState=function(t){i.prototype.updateState.call(this,t),this.mounted&&this.updateView()},n.prototype.updateProps=function(t){i.prototype.updateProps.call(this,t),this.selFar&&this.selFar.setState(this.props)},n.prototype.updateView=function(){this.state?(this.lnkDate.setState(this.formatDate(this.state,!0)),this.lnkPrev.visible=!0,this.lnkNext.visible=!0):(this.lnkDate.setState(""),this.lnkPrev.visible=!1,this.lnkNext.visible=!1)},n.prototype.isToday=function(){return e.isSameDate(this.state,new Date)},n.prototype.formatDate=function(t,e){if(void 0===e&&(e=!0),!t)return""
var i=new Date,n=""
if(e){var a=WUX.WUtil.getCurrDate(-2),s=WUX.WUtil.getCurrDate(-1),o=WUX.WUtil.getCurrDate(1),r=WUX.WUtil.getCurrDate(2),l=1e4*t.getFullYear()+100*(t.getMonth()+1)+t.getDate(),d=1e4*i.getFullYear()+100*(i.getMonth()+1)+i.getDate(),c=1e4*s.getFullYear()+100*(s.getMonth()+1)+s.getDate(),u=1e4*a.getFullYear()+100*(a.getMonth()+1)+a.getDate(),h=1e4*o.getFullYear()+100*(o.getMonth()+1)+o.getDate(),p=1e4*r.getFullYear()+100*(r.getMonth()+1)+r.getDate()
l==d?n="<strong>Oggi</strong> ":l==c?n="<strong>Ieri</strong> ":l==u?n="<strong>Ieri l'altro</strong> ":l==h?n="<strong>Domani</strong> ":l==p&&(n="<strong>Dopodomani</strong> ")}return n+WUX.formatDay(t.getDay())+", "+t.getDate()+" "+WUX.formatMonth(t.getMonth()+1,!0)+", "+t.getFullYear()},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.CFNavCalendar=n}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(e){var n=i.call(this,e||"*","GUIPrenotazioni")||this
return n.dlgPren=new t.DlgPrenotazione(n.subId("dlgp")),n}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(e){if(i.fpFilter.isBlank(t.IPrenotazione.sID_FAR))return void WUX.showWarning("Selezionare la struttura")
var n=i.fpFilter.checkMandatory(!0,!0,!0)
if(n)return void WUX.showWarning("Specificare almeno uno dei seguenti campi: "+n)
var a=WUX.getComponent("boxFilter")
a instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),a.collapse()),jrpc.execute("PRENOTAZIONI.find",[i.fpFilter.getState()],function(t){i.tabResult.setState(t),t&&t.length?i.lblResult.setState(t.length+" prenotazioni trovate."):i.lblResult.setState("Nessuna prenotazione trovata.")})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(n){i.tabResult.setState([]),i.fpFilter.clear(),i.fpFilter.setValue(t.IPrenotazione.sDATA_APP,e.getCurrDate()),i.fpFilter.setValue(t.IPrenotazione.sALLA_DATA,null),i.tagsFilter.setState({}),i.lblResult.setState("")}),this.tagsFilter=new WUX.WTags("tagsFilter"),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.tabResult.setState([])
var n=e.toNumber(i.selFar.getState())
i.selCol.setIdFar(n),i.selCab.setIdFar(n)}),this.selCol=new t.CFSelectCollab,this.selCol.onlyVis=!1,this.selCab=new t.CFSelectCabine,this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IPrenotazione.sID_FAR,"Struttura",this.selFar),this.fpFilter.addDateField(t.IPrenotazione.sDATA_APP,"Data Appuntamento"),this.fpFilter.addDateField(t.IPrenotazione.sALLA_DATA,"Al"),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IPrenotazione.sID_CLIENTE,"Cliente",new t.CFSelectClienti),this.fpFilter.addComponent(t.IPrenotazione.sID_COLL,"Collaboratore",this.selCol),this.fpFilter.addTextField(t.IPrenotazione.sDESC_PREST,"Trattamento"),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IPrenotazione.sID_ATTR,"Cabina",this.selCab),this.fpFilter.addComponent(t.IPrenotazione.sSTATO,"Stato",new t.CFSelectStatiPren),this.fpFilter.addDateField(t.IPrenotazione.sDATA_PREN,"Data Prenotazione"),this.fpFilter.setMandatory(t.IPrenotazione.sID_FAR,t.IPrenotazione.sDATA_APP,t.IPrenotazione.sID_CLIENTE),this.fpFilter.setValue(t.IPrenotazione.sDATA_APP,e.getCurrDate()),this.lblResult=new WUX.WLabel(this.subId("lblr"),"",null,null,WUX.CSS.LABEL_INFO)
var n=[["Data App.",t.IPrenotazione.sDATA_APP,"d"],["Ora App.",t.IPrenotazione.sORA_APP,"s"],["Durata",t.IPrenotazione.sDURATA,"i"],["Stato",t.IPrenotazione.sSTATO,"s"],["Cliente",t.IPrenotazione.sDESC_CLIENTE,"s"],["Telefono",t.IPrenotazione.sTELEFONO1,"s"],["Email",t.IPrenotazione.sEMAIL,"s"],["Collaboratore",t.IPrenotazione.sDESC_COLL,"s"],["Trattamento",t.IPrenotazione.sDESC_PREST,"s"],["Cabina",t.IPrenotazione.sDESC_ATTR,"s"],["Data Pren.",t.IPrenotazione.sDATA_PREN,"d"],["Data Agg.",t.IPrenotazione.sDATA_UPD,"t"],["Struttura",t.IPrenotazione.sCOD_FAR,"s"],["Forzatura",t.IPrenotazione.sOVERBOOKING,"b"],["On Line",t.IPrenotazione.sPREN_ONLINE,"b"],["Utente",t.IPrenotazione.sUSERDESK,"s"],["Note",t.IPrenotazione.sNOTE,"s"],["Coupon",t.IPrenotazione.sCOD_COUPON,"s"],["Causale",t.IPrenotazione.sCAUSALE,"s"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(n,0),e.col(n,1)),this.tabResult.types=e.col(n,2),this.tabResult.exportFile="prenotazioni",this.tabResult.filter=!0,this.tabResult.css({h:600,f:10}),this.tabResult.onRowPrepared(function(i){if(i.data){switch(e.getString(i.data,t.IPrenotazione.sSTATO,"C")){case"F":WUX.setCss(i.rowElement,WUX.CSS.WARNING)
break
case"E":WUX.setCss(i.rowElement,WUX.CSS.SUCCESS)
break
case"N":WUX.setCss(i.rowElement,WUX.CSS.ERROR)
break
case"A":WUX.setCss(i.rowElement,WUX.CSS.COMPLETED)}}}),this.tabResult.onDoubleClick(function(n){var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getNumber(a[0],t.IPrenotazione.sID)
jrpc.execute("PRENOTAZIONI.read",[s],function(n){if(!n)return void WUX.showWarning("Prenotazione "+s+" non disponibile.")
var a=e.getDate(n,t.IPrenotazione.sDATA_APP)
a&&(n[t.IPrenotazione.sDATA_APP]=WUX.formatDate(a,!0))
var o=e.getDate(n,t.IPrenotazione.sDATA_PREN)
o&&(n[t.IPrenotazione.sDATA_PREN]=WUX.formatDateTime(o,!1,!0)),i.dlgPren.setState(n),i.dlgPren.show()})}}),this.cntActions=new t.CFTableActions("ta"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").add(this.lblResult),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.componentDidMount=function(){var i=this,n=0
t.strutture&&t.strutture.length&&(n=t.strutture[0].id)
var a=e.toDate(e.getParam("d"))
if(!a)return void(n&&this.selFar.setState(n))
var s=e.toNumber(e.getParam("f"))
s?(this.selFar.setState(s),n=s):n&&this.selFar.setState(n),n&&(this.selCol.setIdFar(n),this.selCab.setIdFar(n)),this.fpFilter.setValue(t.IPrenotazione.sDATA_APP,a),setTimeout(function(){i.btnFind.trigger("click")},200)},n}(WUX.WComponent)
t.GUIPrenotazioni=i}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(e){var n=i.call(this,e||"*","GUIRepPro")||this
return n.dlgDet=new t.DlgStoricoColl(n.subId("dlgd")),n}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(t){var e=i.fpFilter.checkMandatory(!0,!0)
if(e)return WUX.showWarning("Occorre valorizzare i seguenti campi: "+e),!1
var n=WUX.getComponent("boxFilter")
n instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),n.collapse()),jrpc.execute("REPORT.getProduttivita",[i.fpFilter.getState()],function(t){i.tabResult.setState(t)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.tabResult.setState([]),i.fpFilter.clear(),i.tagsFilter.setState({})}),this.tagsFilter=new WUX.WTags("tagsFilter"),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.tabResult.setState([])}),this.selMese=new t.CFSelectMesi,this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addComponent("idFar","Struttura",this.selFar),this.fpFilter.addComponent("mese","Mese",this.selMese),this.fpFilter.setMandatory("mese"),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")})
var n=[["Collaboratore","col","s"],["Trattamenti","pre","i"],["Eseguiti","ese","i"],["Annullati","ann","i"],["Non Eseguiti","nes","i"],["Clienti","cli","i"],["Ese./Cli.","rec","n"],["Tempo Eseguiti","dur","n"],["Tempo Libero","tli","n"],["Tempo Totale","tmi","n"],["Perc. Libero","ptl","i"],["Perc. Eseguiti","pte","i"],["Produttivita'","val","i"],["Indice Prod.","ipo","n"],["Punteggio","pti","i"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(n,0),e.col(n,1)),this.tabResult.css({f:12}),this.tabResult.types=e.col(n,2),this.tabResult.filter=!0,this.tabResult.exportFile="prod_collaboratori",this.tabResult.onCellPrepared(function(t){"col"==t.column.dataField&&t.cellElement.addClass("clickable")}),this.tabResult.onCellClick(function(t){var n=t.row
if(null!=n&&"data"==n.rowType){if("col"==t.column.dataField){var a=i.fpFilter.getState(),s={}
s.preferenze=e.getString(a,"mese"),s.idColl=e.getNumber(t.data,"ico"),s.idFar=e.getNumber(t.data,"idf"),s.stato="*",jrpc.execute("PRENOTAZIONI.find",[s],function(e){i.dlgDet.setProps("Collaboratore: "+t.value),i.dlgDet.setState(e),i.dlgDet.show(i)})}}}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addRow().addCol("12").section("Risultato").add(this.tabResult),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUIRepPro=i
var n=function(i){function n(t){return i.call(this,t||"*","GUIRepMsg")||this}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(t){var e=i.fpFilter.checkMandatory(!0,!0)
if(e)return WUX.showWarning("Occorre valorizzare i seguenti campi: "+e),!1
var n=WUX.getComponent("boxFilter")
n instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),n.collapse()),jrpc.execute("REPORT.getMessaggi",[i.fpFilter.getState()],function(t){i.tabResult.setState(t)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.tabResult.setState([]),i.fpFilter.clear(),i.fpFilter.setValue("dal",e.getCurrDate(0,-1,0)),i.fpFilter.setValue("al",e.getCurrDate()),i.tagsFilter.setState({})}),this.tagsFilter=new WUX.WTags("tagsFilter"),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.tabResult.setState([])}),this.selMese=new t.CFSelectMesi,this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addComponent("idFar","Struttura",this.selFar),this.fpFilter.addComponent("mese","Mese",this.selMese),this.fpFilter.setMandatory("idFar","mese"),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")})
var n=[["Data","dat","d"],["Clienti","cli","i"],["Messaggi","msg","i"],["Non Inviati","err","i"]]
return this.tabResult=new WUX.WDXTable(this.subId("tab"),e.col(n,0),e.col(n,1)),this.tabResult.types=e.col(n,2),this.tabResult.filter=!0,this.tabResult.exportFile="messaggi",this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addRow().addCol("12").section("Risultato").add(this.tabResult),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUIRepMsg=n
var a=function(i){function n(t){return i.call(this,t||"*","GUIRepPro")||this}return __extends(n,i),n.prototype.render=function(){var i=this
return this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(t){var n=i.fpFilter.checkMandatory(!0,!0)
if(n)return WUX.showWarning("Occorre valorizzare i seguenti campi: "+n),!1
var a=WUX.getComponent("boxFilter")
a instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),a.collapse()),jrpc.execute("REPORT.getGrafici",[i.fpFilter.getState()],function(t){if(e.isEmpty(t))return void WUX.showWarning("Non vi sono dati rappresentabili")
i.chrCE.setState(t.ce),i.chrCV.setState(t.cv),i.chrPE.setState(t.pe),i.chrPV.setState(t.pv),i.chrPP.setState(t.pp),i.chrGV.setState(t.gv),setTimeout(function(){i.fix()},200)})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){i.chrCE.setState(null),i.chrCV.setState(null),i.chrPE.setState(null),i.chrPV.setState(null),i.chrPP.setState(null),i.chrGV.setState(null),i.fpFilter.clear(),i.tagsFilter.setState({})}),this.tagsFilter=new WUX.WTags("tagsFilter"),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.chrCE.setState(null),i.chrCV.setState(null),i.chrPE.setState(null),i.chrPV.setState(null),i.chrPP.setState(null),i.chrGV.setState(null)}),this.selMese=new t.CFSelectMesi,this.fpFilter=new WUX.WFormPanel(this.subId("fpf")),this.fpFilter.addRow(),this.fpFilter.addComponent("idFar","Struttura",this.selFar),this.fpFilter.addComponent("mese","Mese",this.selMese),this.fpFilter.setMandatory("idFar","mese"),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.chrCE=new WUX.WChartJS("chrce","bar"),this.chrCV=new WUX.WChartJS("chrcv","bar"),this.chrPE=new WUX.WChartJS("chrpe","bar"),this.chrPV=new WUX.WChartJS("chrpv","bar"),this.chrPP=new WUX.WChartJS("chrpp","pie"),this.chrGV=new WUX.WChartJS("chrgv","line"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addRow().addCol("6").section("Trattamenti eseguiti collaboratore").add(this.chrCE).addCol("6").section("Produttivit&agrave; collaboratori").add(this.chrCV).addRow().addCol("6").section("Trattamenti eseguiti").add(this.chrPE).addCol("6").section("Valore trattamenti").add(this.chrPV).addRow().addCol("6").section("Composizione trattamenti").add(this.chrPP).addCol("6").section("Andamento valore").add(this.chrGV),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.fix=function(){var t=this.chrCE.getRoot(),e=t.height()
e&&(this.chrCE.css({h:e,maxh:e}),this.chrCV.css({h:e,maxh:e}),this.chrPE.css({h:e,maxh:e}),this.chrPV.css({h:e,maxh:e}),this.chrPP.css({h:e,maxh:e}),this.chrGV.css({h:e,maxh:e}))},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUIChartsPro=a}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){var e=i.call(this,t||"*","GUIGruppiTrat")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.fpFilter.checkMandatory(!0,!0,!0)
if(a)return void WUX.showWarning("Specificare i seguenti campi: "+a)
var s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("GRUPPI_PREST.find",[t.CFUtil.putUserInfo(i.fpFilter.getState())],function(n){if(i.tabResult.setState(n),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.IPrestazione.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},100),i.selId=null}})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addTextField(t.IGruppoPrest.sCODICE,"Codice"),this.fpFilter.addTextField(t.IGruppoPrest.sDESCRIZIONE,"Descrizione"),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave.blur()
var n=i.fpDetail.checkMandatory(!0,!0,!1)
if(n)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+n)
var a=i.fpDetail.getState()
i.isNew?jrpc.execute("GRUPPI_PREST.insert",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess("Gruppo inserito con successo."),i.selId=e[t.IGruppoPrest.sID],i.btnFind.trigger("click")}):jrpc.execute("GRUPPI_PREST.update",[a],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,WUX.showSuccess("Gruppo aggiornato con successo."),i.selId=e[t.IGruppoPrest.sID]
var n=i.tabResult.getSelectedRows()
n&&n.length||i.btnFind.trigger("click")})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew&&i.fpDetail.clear(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IGruppoPrest.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("GRUPPI_PREST.delete",[s],function(t){i.btnFind.trigger("click")})})}})
var n=[["Codice",t.IGruppoPrest.sCODICE,100,"s"],["Descrizione",t.IGruppoPrest.sDESCRIZIONE,0,"s"]]
return this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(n,0),e.col(n,1)),this.tabResult.css({h:220}),this.tabResult.widths=e.col(n,2),this.tabResult.types=e.col(n,3),this.tabResult.exportFile="trattamenti",this.tabResult.onSelectionChanged(function(t){var e=i.tabResult.getSelectedRowsData()
e&&e.length&&(i.fpDetail.setState(e[0]),i.status=i.iSTATUS_VIEW)}),this.fpDetail=new WUX.WFormPanel(this.subId("fd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.IGruppoPrest.sCODICE,"Codice"),this.fpDetail.addTextField(t.IGruppoPrest.sDESCRIZIONE,"Descrizione"),this.fpDetail.addInternalField(t.IGruppoPrest.sID),this.fpDetail.enabled=!1,this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew),this.tagsFilter=new WUX.WTags("tf"),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult).end().addRow().addCol("12").section("Dettaglio").add(this.fpDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n}(WUX.WComponent)
t.GUIGruppiTrat=i
var n=function(i){function n(t){var e=i.call(this,t||"*","GUITrattamenti")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.fpFilter.checkMandatory(!0,!0,!1)
if(a)return void WUX.showWarning("Specificare i seguenti campi: "+a)
var s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("PRESTAZIONI.find",[t.CFUtil.putUserInfo(i.fpFilter.getState())],function(n){if(i.tabResult.setState(n),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.IPrestazione.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},100),i.selId=null}})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.tabSelA.setState([]),i.tabAllA.clearSelection(),i.tabAllA.clearFilter(),i.tabSelC.setState([]),i.tabAllC.clearSelection(),i.tabAllC.clearFilter(),i.status=i.iSTATUS_STARTUP}),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(n){i.tabResult.setState([]),i.fpDetail.clear(),i.tabSelA.setState([]),i.tabAllA.clearSelection(),i.tabAllA.clearFilter(),i.tabSelC.setState([]),i.tabAllC.clearSelection(),i.tabAllC.clearFilter(),t.cp_attrz=null,t.cp_collb=null
var a=e.toNumber(i.selFar.getState(),0)
jrpc.execute("ATTREZZATURE.getAll",[a],function(t){i.tabAllA.setState(t)}),jrpc.execute("COLLABORATORI.getAll",[a],function(t){i.tabAllC.setState(t)})}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IPrestazione.sID_FAR,"Struttura",this.selFar),this.fpFilter.addComponent(t.IPrestazione.sGRUPPO,"Gruppo",new t.CFSelectGruppiPre),this.fpFilter.addTextField(t.IPrestazione.sDESCRIZIONE,"Descrizione"),this.fpFilter.setMandatory(t.IPrestazione.sID_FAR),this.selGruppo=new t.CFSelectGruppiPre,this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.IPrestazione.sDESCRIZIONE,"Descrizione"),this.fpDetail.addComponent(t.IPrestazione.sGRUPPO,"Gruppo",this.selGruppo),this.fpDetail.addIntegerField(t.IPrestazione.sDURATA,"Durata (min.)"),this.fpDetail.addBooleanField(t.IPrestazione.sPREN_ONLINE,"Pren. On Line"),this.fpDetail.addRow(),this.fpDetail.addComponent(t.IPrestazione.sTIPO_PREZZO,"Tipo prezzo",new t.CFSelectTipoPrezzo),this.fpDetail.addCurrencyField(t.IPrestazione.sPREZZO_LISTINO,"Prezzo Listino"),this.fpDetail.addCurrencyField(t.IPrestazione.sSCONTO_ASS,"Sconto &euro;"),this.fpDetail.addIntegerField(t.IPrestazione.sSCONTO_PERC,"Sconto %"),this.fpDetail.addCurrencyField(t.IPrestazione.sPREZZO_FINALE,"Prezzo Finale"),this.fpDetail.addIntegerField(t.IPrestazione.sPUNTI_COLL,"Punti Coll."),this.fpDetail.addRow(),this.fpDetail.addTextField(t.IPrestazione.sCODICE,"Cod.Servizio"),this.fpDetail.addTextField(t.IPrestazione.sAVVERTENZE,"Avvertenze"),this.fpDetail.addTextField(t.IPrestazione.sINDICAZIONI,"Indicazioni"),this.fpDetail.addInternalField(t.IPrestazione.sID),this.fpDetail.enabled=!1,this.fpDetail.onBlur(t.IPrestazione.sPREZZO_LISTINO,function(t){i.calcPrezzi()}),this.fpDetail.onBlur(t.IPrestazione.sSCONTO_ASS,function(t){i.calcPrezzi()}),this.fpDetail.onBlur(t.IPrestazione.sSCONTO_PERC,function(t){i.calcPrezzi()}),this.fpDetail.onBlur(t.IPrestazione.sPREZZO_FINALE,function(t){i.calcPrezzi()}),this.fpDetail.setSpanField(t.IPrestazione.sDESCRIZIONE,3),this.fpDetail.setSpanField(t.IPrestazione.sCODICE,2),this.fpDetail.setSpanField(t.IPrestazione.sAVVERTENZE,2),this.fpDetail.setSpanField(t.IPrestazione.sINDICAZIONI,2),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.btnDxA.enabled=!0,i.btnSxA.enabled=!0,i.btnPaA.enabled=!0,i.btnDxC.enabled=!0,i.btnSxC.enabled=!0,i.btnPaC.enabled=!0,i.fpDetail.clear(),i.tabSelA.setState([]),i.tabAllA.clearSelection(),i.tabSelC.setState([]),i.tabAllC.clearSelection(),i.tcoDetail.setState(0),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,i.btnDxA.enabled=!0,i.btnSxA.enabled=!0,i.btnPaA.enabled=!0,i.btnDxC.enabled=!0,i.btnSxC.enabled=!0,i.btnPaC.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState(),r=e.getNumber(o,t.IPrestazione.sDURATA)
return r<5?void WUX.showWarning("Durata non valida."):r>600?void WUX.showWarning("Durata non valida: massimo 600 minuti."):(o[t.IPrestazione.sID_FAR]=s,o[t.IPrestazione.sATTREZZATURE]=i.tabSelA.getState(),o[t.IPrestazione.sCOLLABORATORI]=i.tabSelC.getState(),void(i.isNew?jrpc.execute("PRESTAZIONI.insert",[o],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDxA.enabled=!1,i.btnSxA.enabled=!1,i.btnPaA.enabled=!1,i.btnDxC.enabled=!1,i.btnSxC.enabled=!1,i.btnPaC.enabled=!1,WUX.showSuccess("Trattamento inserito con successo."),i.selId=e[t.IPrestazione.sID],i.btnFind.trigger("click")}):jrpc.execute("PRESTAZIONI.update",[o],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDxA.enabled=!1,i.btnSxA.enabled=!1,i.btnPaA.enabled=!1,i.btnDxC.enabled=!1,i.btnSxC.enabled=!1,i.btnPaC.enabled=!1,WUX.showSuccess("Trattamento aggiornato con successo."),i.selId=e[t.IPrestazione.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0],s=i.tabResult.getState()
s[a]=e,s[a][t.IPrestazione.sDESC_GRUPPO]=i.selGruppo.getProps(),i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})))}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?(i.fpDetail.clear(),i.tabSelA.setState([]),i.tabAllA.clearSelection(),i.tabSelC.setState([]),i.tabAllC.clearSelection()):i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDxA.enabled=!1,i.btnSxA.enabled=!1,i.btnPaA.enabled=!1,i.btnDxC.enabled=!1,i.btnSxC.enabled=!1,i.btnPaC.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IPrestazione.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("PRESTAZIONI.delete",[s],function(t){i.btnFind.trigger("click")})})}}),this.btnOpen2=new WUX.WButton(this.subId("bo2"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen2.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen2.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen2.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,i.btnDxA.enabled=!0,i.btnSxA.enabled=!0,i.btnPaA.enabled=!0,i.btnDxC.enabled=!0,i.btnSxC.enabled=!0,i.btnPaC.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave2=new WUX.WButton(this.subId("bs2"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave2.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave2.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave2.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState(),r=e.getNumber(o,t.IPrestazione.sDURATA)
return r<5?void WUX.showWarning("Durata non valida."):r>600?void WUX.showWarning("Durata non valida: massimo 600 minuti."):(o[t.IPrestazione.sID_FAR]=s,o[t.IPrestazione.sATTREZZATURE]=i.tabSelA.getState(),o[t.IPrestazione.sCOLLABORATORI]=i.tabSelC.getState(),void(i.isNew?jrpc.execute("PRESTAZIONI.insert",[o],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDxA.enabled=!1,i.btnSxA.enabled=!1,i.btnPaA.enabled=!1,i.btnDxC.enabled=!1,i.btnSxC.enabled=!1,i.btnPaC.enabled=!1,WUX.showSuccess("Trattamento inserito con successo."),i.selId=e[t.IPrestazione.sID],i.btnFind.trigger("click")}):jrpc.execute("PRESTAZIONI.update",[o],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDxA.enabled=!1,i.btnSxA.enabled=!1,i.btnPaA.enabled=!1,i.btnDxC.enabled=!1,i.btnSxC.enabled=!1,i.btnPaC.enabled=!1,WUX.showSuccess("Trattamento aggiornato con successo."),i.selId=e[t.IPrestazione.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0],s=i.tabResult.getState()
s[a]=e,s[a][t.IPrestazione.sDESC_GRUPPO]=i.selGruppo.getProps(),i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})))}),this.btnCancel2=new WUX.WButton(this.subId("bc2"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel2.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel2.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?(i.fpDetail.clear(),i.tabSelA.setState([]),i.tabAllA.clearSelection(),i.tabSelC.setState([]),i.tabAllC.clearSelection()):i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.btnDxA.enabled=!1,i.btnSxA.enabled=!1,i.btnPaA.enabled=!1,i.btnDxC.enabled=!1,i.btnSxC.enabled=!1,i.btnPaC.enabled=!1,i.selId=null)})}),this.btnDelete2=new WUX.WButton(this.subId("bd2"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete2.on("click",function(n){if(i.selId=null,i.btnDelete2.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IPrestazione.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("PRESTAZIONI.delete",[s],function(t){i.btnFind.trigger("click")})})}})
var n=[["Gruppo",t.IPrestazione.sDESC_GRUPPO,"s"],["Descrizione",t.IPrestazione.sDESCRIZIONE,"s"],["Durata",t.IPrestazione.sDURATA,"i"],["Tipo prezzo",t.IPrestazione.sTIPO_PREZZO,"s"],["Prezzo Listino",t.IPrestazione.sPREZZO_LISTINO,"c"],["Sconto Ass.",t.IPrestazione.sSCONTO_ASS,"c"],["Sconto Perc.",t.IPrestazione.sSCONTO_PERC,"i"],["Prezzo Finale",t.IPrestazione.sPREZZO_FINALE,"c"],["Punti Coll.",t.IPrestazione.sPUNTI_COLL,"i"],["Pren. On Line",t.IPrestazione.sPREN_ONLINE,"b"]]
this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(n,0),e.col(n,1)),this.tabResult.css({h:220}),this.tabResult.types=e.col(n,2),this.tabResult.exportFile="trattamenti",this.tabResult.onSelectionChanged(function(t){i.onSelect()}),this.tabSelA=new WUX.WDXTable(this.subId("tbs"),["Codice","Descrizione"],[t.IAttrezzatura.sCODICE,t.IAttrezzatura.sDESCRIZIONE]),this.tabSelA.selectionMode="multiple",this.tabSelA.css({h:200}),this.tabSelA.widths=[100],this.tabAllA=new WUX.WDXTable(this.subId("tba"),["Codice","Descrizione"],[t.IAttrezzatura.sCODICE,t.IAttrezzatura.sDESCRIZIONE]),this.tabAllA.selectionMode="multiple",this.tabAllA.css({h:200}),this.tabAllA.widths=[100],this.btnSxA=new WUX.WButton(this.subId("bba"),"",t.ICO.LEFT,WUX.BTN.PRIMARY,{p:"1px 6px 1px 6px"}),this.btnSxA.tooltip="Aggiungi cabine",this.btnSxA.enabled=!1,this.btnSxA.on("click",function(e){var n=i.tabSelA.getState()
n||(n=[])
var a=i.tabAllA.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare una o pi&ugrave; cabine dall'elenco disponibile.")
for(var s=!1,o=0;o<a.length;o++){for(var r=a[o],l=r[t.IAttrezzatura.sID],d=!1,c=0;c<n.length;c++){if(n[c][t.IAttrezzatura.sID]==l){d=!0
break}}d||(n.push(r),s=!0)}i.tabSelA.setState(n),s&&setTimeout(function(){i.tabSelA.scrollTo(999999)},250)}),this.btnDxA=new WUX.WButton(this.subId("bbd"),"",t.ICO.DELETE,WUX.BTN.DANGER,{p:"1px 7px 1px 7px"}),this.btnDxA.tooltip="Rimuovi cabine",this.btnDxA.enabled=!1,this.btnDxA.on("click",function(e){var n=i.tabSelA.getState()
n||(n=[])
var a=i.tabSelA.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare una o pi&ugrave; cabine dall'elenco delle assegnate.")
for(var s=[],o=0;o<n.length;o++){for(var r=n[o],l=r[t.IAttrezzatura.sID],d=!1,c=0;c<a.length;c++){if(a[c][t.IAttrezzatura.sID]==l){d=!0
break}}d||s.push(r)}i.tabSelA.setState(s)}),this.btnCpA=new WUX.WButton(this.subId("bbc"),"",t.ICO.COPY,WUX.BTN.SECONDARY,{p:"1px 7px 1px 7px"}),this.btnCpA.tooltip="Copia cabine",this.btnCpA.on("click",function(e){var n=i.tabSelA.getState()
if(!n||!n.length)return void WUX.showSuccess("Nessun elemento selezionato")
t.cp_attrz=n,WUX.showSuccess("Cabine copiate nella clipboard")}),this.btnPaA=new WUX.WButton(this.subId("bbp"),"",t.ICO.PASTE,WUX.BTN.WARNING,{p:"1px 7px 1px 7px"}),this.btnPaA.tooltip="Incolla cabine",this.btnPaA.enabled=!1,this.btnPaA.on("click",function(e){if(!t.cp_attrz)return void WUX.showWarning("Non vi sono cabine nella clipboard")
i.tabSelA.setState(t.cp_attrz)}),this.tabSelC=new WUX.WDXTable(this.subId("tbsc"),["Nome"],[t.ICollaboratore.sNOME]),this.tabSelC.selectionMode="multiple",this.tabSelC.css({h:200}),this.tabAllC=new WUX.WDXTable(this.subId("tbac"),["Nome"],[t.ICollaboratore.sNOME]),this.tabAllC.selectionMode="multiple",this.tabAllC.css({h:200}),this.btnSxC=new WUX.WButton(this.subId("bbac"),"",t.ICO.LEFT,WUX.BTN.PRIMARY,{p:"1px 6px 1px 6px"}),this.btnSxC.tooltip="Aggiungi collaboratore",this.btnSxC.enabled=!1,this.btnSxC.on("click",function(e){var n=i.tabSelC.getState()
n||(n=[])
var a=i.tabAllC.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare uno o pi&ugrave; collaboratori dall'elenco disponibile.")
for(var s=!1,o=0;o<a.length;o++){for(var r=a[o],l=r[t.ICollaboratore.sID],d=!1,c=0;c<n.length;c++){if(n[c][t.ICollaboratore.sID]==l){d=!0
break}}d||(n.push(r),s=!0)}i.tabSelC.setState(n),s&&setTimeout(function(){i.tabSelC.scrollTo(999999)},250)}),this.btnDxC=new WUX.WButton(this.subId("bbdc"),"",t.ICO.DELETE,WUX.BTN.DANGER,{p:"1px 7px 1px 7px"}),this.btnDxC.tooltip="Rimuovi collaboratori",this.btnDxC.enabled=!1,this.btnDxC.on("click",function(e){var n=i.tabSelC.getState()
n||(n=[])
var a=i.tabSelC.getSelectedRowsData()
if(!a||!a.length)return void WUX.showWarning("Selezionare una o pi&ugrave; cabine dall'elenco delle assegnate.")
for(var s=[],o=0;o<n.length;o++){for(var r=n[o],l=r[t.IAttrezzatura.sID],d=!1,c=0;c<a.length;c++){if(a[c][t.IAttrezzatura.sID]==l){d=!0
break}}d||s.push(r)}i.tabSelC.setState(s)}),this.btnCpC=new WUX.WButton(this.subId("bbcc"),"",t.ICO.COPY,WUX.BTN.SECONDARY,{p:"1px 7px 1px 7px"}),this.btnCpC.tooltip="Copia collaboratori",this.btnCpC.on("click",function(e){var n=i.tabSelC.getState()
if(!n||!n.length)return void WUX.showSuccess("Nessun elemento selezionato")
t.cp_collb=n,WUX.showSuccess("Collaboratori copiati nella clipboard")}),this.btnPaC=new WUX.WButton(this.subId("bbpc"),"",t.ICO.PASTE,WUX.BTN.WARNING,{p:"1px 7px 1px 7px"}),this.btnPaC.tooltip="Incolla collaboratori",this.btnPaC.enabled=!1,this.btnPaC.on("click",function(e){if(!t.cp_collb)return void WUX.showWarning("Non vi sono collaboratori nella clipboard")
i.tabSelC.setState(t.cp_collb)}),this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew),this.cntActions2=new t.CFTableActions("ta2"),this.cntActions2.left.add(this.btnOpen2),this.cntActions2.left.add(this.btnDelete2),this.cntActions2.left.add(this.btnSave2),this.cntActions2.left.add(this.btnCancel2),this.tagsFilter=new WUX.WTags("tf")
var a=new WUX.WContainer(this.subId("ct0a"),"")
a.addRow().addCol("11",{p:0}).add(this.tabSelA).addCol("1",{p:0}).addStack(WUX.CSS.STACK_BTNS,this.btnSxA,this.btnDxA,this.btnCpA,this.btnPaA)
var s=new WUX.WContainer(this.subId("ct0c"),"")
return s.addRow().addCol("11",{p:0}).add(this.tabSelC).addCol("1",{p:0}).addStack(WUX.CSS.STACK_BTNS,this.btnSxC,this.btnDxC,this.btnCpC,this.btnPaC),this.tcoDetail=new WUX.WTab("tcod"),this.tcoDetail.addTab("Anagrafica",WUX.WIcon.ADDRESS_CARD).addRow().addCol("12",{h:260}).add(this.fpDetail),this.tcoDetail.addTab("Cabine",WUX.WIcon.COG).addRow().addCol("6").section("Assegnate",{h:260}).add(a).addCol("6").section("Disponibili",{h:260}).add(this.tabAllA),this.tcoDetail.addTab("Collaboratori",WUX.WIcon.USERS).addRow().addCol("6").section("Assegnati",{h:260}).add(s).addCol("6").section("Disponibili",{h:260}).add(this.tabAllC),this.tcoDetail.on("statechange",function(t){switch(i.tcoDetail.getState()){case 0:break
case 1:i.tabSelA.refresh(),i.tabAllA.refresh()
break
case 2:i.tabSelC.refresh(),i.tabAllC.refresh()}}),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult,this.cntActions2).end().addRow().addCol("12").section("Dettaglio").add(this.tcoDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.onSelect=function(){var i=this,n=e.getItem(this.tabResult.getSelectedRowsData(),0)
if(n){var a=e.getNumber(n,t.IPrestazione.sID)
if(a){this.fpDetail.clear(),this.tabSelA.setState([]),this.tabAllA.clearSelection(),this.tabAllA.clearFilter(),this.tabSelC.setState([]),this.tabAllC.clearSelection(),this.tabAllC.clearFilter(),this.status==this.iSTATUS_EDITING&&(WUX.showWarning("Modifiche annullate"),this.fpDetail.enabled=!1,this.btnDxA.enabled=!1,this.btnSxA.enabled=!1,this.btnPaA.enabled=!1,this.btnDxC.enabled=!1,this.btnSxC.enabled=!1,this.btnPaC.enabled=!1)
var s=e.toNumber(this.selFar.getState(),0)
jrpc.execute("PRESTAZIONI.read",[a,s],function(n){i.fpDetail.setState(n),i.tabSelA.setState(e.getArray(n,t.IPrestazione.sATTREZZATURE)),i.tabSelC.setState(e.getArray(n,t.IPrestazione.sCOLLABORATORI)),i.status=i.iSTATUS_VIEW})}}},n.prototype.calcPrezzi=function(){var i=e.toNumber(this.fpDetail.getValue(t.IPrestazione.sPREZZO_LISTINO)),n=e.toNumber(this.fpDetail.getValue(t.IPrestazione.sSCONTO_ASS)),a=e.toNumber(this.fpDetail.getValue(t.IPrestazione.sSCONTO_PERC)),s=0;(s=n?i-n:t.CFUtil.scontato(i,a))<0&&(s=0)
var o=Math.floor(2.5*Math.floor(s/5))
this.fpDetail.setValue(t.IPrestazione.sPREZZO_FINALE,WUX.formatCurr(s)),this.fpDetail.setValue(t.IPrestazione.sPUNTI_COLL,o)},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUITrattamenti=n}(GUI||(GUI={}))
var GUI
!function(t){var e=WUX.WUtil,i=function(i){function n(t){var e=i.call(this,t||"*","GUIUtentiDesk")||this
return e.iSTATUS_STARTUP=0,e.iSTATUS_VIEW=1,e.iSTATUS_EDITING=2,e.status=e.iSTATUS_STARTUP,e}return __extends(n,i),n.prototype.render=function(){var i=this
this.btnFind=new WUX.WButton(this.subId("bf"),t.TXT.FIND,"",WUX.BTN.SM_PRIMARY),this.btnFind.on("click",function(n){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.fpFilter.checkMandatory(!0,!0,!1)
if(a)return void WUX.showWarning("Specificare i seguenti campi: "+a)
var s=WUX.getComponent("boxFilter")
s instanceof WUX.WBox&&(i.tagsFilter.setState(i.fpFilter.getValues(!0)),s.collapse()),jrpc.execute("UTENTI_DESK.find",[t.CFUtil.putUserInfo(i.fpFilter.getState())],function(n){if(i.tabResult.setState(n),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP,i.selId){var a=e.indexOf(n,t.IUtenteDesk.sID,i.selId)
a>=0&&setTimeout(function(){i.tabResult.select([a])},100),i.selId=null}})}),this.btnReset=new WUX.WButton(this.subId("br"),t.TXT.RESET,"",WUX.BTN.SM_SECONDARY),this.btnReset.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void WUX.showWarning("Elemento in fase di modifica.")
i.fpFilter.clear(),i.tagsFilter.setState({}),i.tabResult.setState([]),i.fpDetail.clear(),i.status=i.iSTATUS_STARTUP}),this.selFar=new t.CFSelectStruture,this.selFar.on("statechange",function(t){i.tabResult.setState([]),i.fpDetail.clear()}),this.fpFilter=new WUX.WFormPanel(this.subId("ff")),this.fpFilter.addRow(),this.fpFilter.addComponent(t.IUtenteDesk.sID_FAR,"Struttura",this.selFar),this.fpFilter.addTextField(t.IUtenteDesk.sUSERNAME,"Username"),this.fpFilter.setMandatory(t.IUtenteDesk.sID_FAR),this.fpDetail=new WUX.WFormPanel(this.subId("fpd")),this.fpDetail.addRow(),this.fpDetail.addTextField(t.IUtenteDesk.sUSERNAME,"Username"),this.fpDetail.addTextField(t.IUtenteDesk.sPASSWORD,"Password"),this.fpDetail.addTextField(t.IUtenteDesk.sNOTE,"Note"),this.fpDetail.addBooleanField(t.IUtenteDesk.sABILITATO,"Abilitato"),this.fpDetail.addInternalField(t.IUtenteDesk.sID),this.fpDetail.enabled=!1,this.fpDetail.setMandatory(t.IUtenteDesk.sUSERNAME,t.IUtenteDesk.sPASSWORD),this.fpFilter.onEnterPressed(function(t){i.btnFind.trigger("click")}),this.btnNew=new WUX.WButton(this.subId("bn"),t.TXT.NEW,"",WUX.BTN.SM_INFO),this.btnNew.on("click",function(t){if(i.status==i.iSTATUS_EDITING)return void i.btnNew.blur()
i.isNew=!0,i.status=i.iSTATUS_EDITING,i.selId=null,i.tabResult.clearSelection(),i.fpDetail.enabled=!0,i.fpDetail.clear(),setTimeout(function(){i.fpDetail.focus()},100)}),this.btnOpen=new WUX.WButton(this.subId("bo"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave=new WUX.WButton(this.subId("bs"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState()
o[t.IUtenteDesk.sID_FAR]=s
var r=jrpc.executeSync("UTENTI_DESK.exists",[o])
if(r)return void WUX.showWarning(r+" gi&agrave; utilizzata.")
i.isNew?jrpc.execute("UTENTI_DESK.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IUtenteDesk.sID],i.btnFind.trigger("click")}):jrpc.execute("UTENTI_DESK.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IUtenteDesk.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel=new WUX.WButton(this.subId("bc"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?i.fpDetail.clear():i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.btnDelete=new WUX.WButton(this.subId("bd"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete.on("click",function(n){if(i.selId=null,i.btnDelete.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IUtenteDesk.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("UTENTI_DESK.delete",[s],function(t){i.btnFind.trigger("click")})})}}),this.btnOpen2=new WUX.WButton(this.subId("bo2"),t.TXT.OPEN,t.ICO.OPEN,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnOpen2.on("click",function(t){if(i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void i.btnOpen2.blur()
var e=i.tabResult.getSelectedRows()
if(!e||!e.length)return WUX.showWarning("Seleziona l'elemento da modificare"),void i.btnOpen2.blur()
i.isNew=!1,i.status=i.iSTATUS_EDITING,i.selId=null,i.fpDetail.enabled=!0,setTimeout(function(){i.fpDetail.focus()},100)}),this.btnSave2=new WUX.WButton(this.subId("bs2"),t.TXT.SAVE,t.ICO.SAVE,WUX.BTN.ACT_OUTLINE_PRIMARY),this.btnSave2.on("click",function(n){if(i.status!=i.iSTATUS_EDITING)return WUX.showWarning("Cliccare su Modifica."),void i.btnSave2.blur()
var a=i.fpDetail.checkMandatory(!0)
if(a)return i.btnSave2.blur(),void WUX.showWarning("Specificare: "+a)
var s=e.toNumber(i.selFar.getState())
if(!s)return void WUX.showWarning("Selezionare la struttura di competenza")
var o=i.fpDetail.getState()
o[t.IUtenteDesk.sID_FAR]=s
var r=jrpc.executeSync("UTENTI_DESK.exists",[o])
if(r)return void WUX.showWarning(r+" gi&agrave; utilizzata.")
i.isNew?jrpc.execute("UTENTI_DESK.insert",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IUtenteDesk.sID],i.btnFind.trigger("click")}):jrpc.execute("UTENTI_DESK.update",[t.CFUtil.putUserInfo(o)],function(e){i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=e[t.IUtenteDesk.sID]
var n=i.tabResult.getSelectedRows()
if(n&&n.length){var a=n[0]
i.tabResult.getState()[a]=e,i.tabResult.refresh(),setTimeout(function(){i.tabResult.select([a])},100)}else i.btnFind.trigger("click")})}),this.btnCancel2=new WUX.WButton(this.subId("bc2"),t.TXT.CANCEL,t.ICO.CANCEL,WUX.BTN.ACT_OUTLINE_INFO),this.btnCancel2.on("click",function(e){if(i.status!=i.iSTATUS_EDITING)return void i.btnCancel2.blur()
WUX.confirm(t.MSG.CONF_CANCEL,function(t){t&&(i.isNew?i.fpDetail.clear():i.onSelect(),i.status=i.iSTATUS_VIEW,i.fpDetail.enabled=!1,i.selId=null)})}),this.btnDelete2=new WUX.WButton(this.subId("bd2"),t.TXT.DELETE,t.ICO.DELETE,WUX.BTN.ACT_OUTLINE_DANGER),this.btnDelete2.on("click",function(n){if(i.selId=null,i.btnDelete2.blur(),i.status==i.iSTATUS_EDITING||i.status==i.iSTATUS_STARTUP)return void WUX.showWarning("Elemento in fase di modifica.")
var a=i.tabResult.getSelectedRowsData()
if(a&&a.length){var s=e.getInt(a[0],t.IUtenteDesk.sID)
WUX.confirm(t.MSG.CONF_DELETE,function(t){t&&jrpc.execute("UTENTI_DESK.delete",[s],function(t){i.btnFind.trigger("click")})})}})
var n=[["Username",t.IUtenteDesk.sUSERNAME,"s"],["Note",t.IUtenteDesk.sNOTE,"s"],["Abilitato",t.IUtenteDesk.sABILITATO,"b"]]
return this.tabResult=new WUX.WDXTable(this.subId("tr"),e.col(n,0),e.col(n,1)),this.tabResult.types=e.col(n,2),this.tabResult.css({h:220}),this.tabResult.widths=[100],this.tabResult.onSelectionChanged(function(t){i.onSelect()}),this.cntActions=new t.CFTableActions("ta"),this.cntActions.left.add(this.btnOpen),this.cntActions.left.add(this.btnDelete),this.cntActions.left.add(this.btnSave),this.cntActions.left.add(this.btnCancel),this.cntActions.right.add(this.btnNew),this.cntActions2=new t.CFTableActions("ta2"),this.cntActions2.left.add(this.btnOpen2),this.cntActions2.left.add(this.btnDelete2),this.cntActions2.left.add(this.btnSave2),this.cntActions2.left.add(this.btnCancel2),this.tagsFilter=new WUX.WTags("tf"),this.tcoDetail=new WUX.WTab("tcod"),this.tcoDetail.addTab("Attributi",WUX.WIcon.ADDRESS_CARD).addRow().addCol("12",{h:300}).add(this.fpDetail),this.container=new WUX.WContainer,this.container.attributes=WUX.ATT.STICKY_CONTAINER,this.container.addBox("Filtri di ricerca:","","","boxFilter",WUX.ATT.BOX_FILTER).addTool(this.tagsFilter).addCollapse(this.collapseHandler.bind(this)).addRow().addCol("col-xs-11 b-r").add(this.fpFilter).addCol("col-xs-1 b-l").addGroup({classStyle:"form-group text-right"},this.btnFind,this.btnReset).end().addBox().addGroup({classStyle:"search-actions-and-results-wrapper"},this.cntActions,this.tabResult,this.cntActions2).end().addRow().addCol("12").section("Dettaglio").add(this.tcoDetail),this.container},n.prototype.collapseHandler=function(t){e.getBoolean(t.data,"collapsed")?this.tagsFilter.setState({}):this.tagsFilter.setState(this.fpFilter.getValues(!0))},n.prototype.onSelect=function(){var i=this,n=e.getItem(this.tabResult.getSelectedRowsData(),0)
if(n){var a=e.getNumber(n,t.IUtenteDesk.sID)
a&&(this.fpDetail.clear(),this.status==this.iSTATUS_EDITING&&(WUX.showWarning("Modifiche annullate"),this.fpDetail.enabled=!1),jrpc.execute("UTENTI_DESK.read",[a],function(t){i.fpDetail.setState(t),i.status=i.iSTATUS_VIEW}))}},n.prototype.componentDidMount=function(){var e=0
t.strutture&&t.strutture.length&&(e=t.strutture[0].id),e&&this.selFar.setState(e)},n}(WUX.WComponent)
t.GUIUtentiDesk=i}(GUI||(GUI={}))
